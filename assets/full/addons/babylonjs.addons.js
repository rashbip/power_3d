!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("babylonjs")):"function"==typeof define&&define.amd?define("babylonjs-addons",["babylonjs"],t):"object"==typeof exports?exports["babylonjs-addons"]=t(require("babylonjs")):e.ADDONS=t(e.BABYLON)}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this,(e=>(()=>{"use strict";var t={554(e,t,i){var n=i(597),r="atmosphereFragmentDeclaration";n.ShaderStore.IncludesShadersStore[r]||(n.ShaderStore.IncludesShadersStore[r]="uniform vec3 peakRayleighScattering;uniform float planetRadius;uniform vec3 peakMieScattering;uniform float atmosphereThickness;uniform vec3 peakMieAbsorption;uniform float planetRadiusSquared;uniform vec3 peakMieExtinction;uniform float atmosphereRadius;uniform vec3 peakOzoneAbsorption;uniform float atmosphereRadiusSquared;uniform float horizonDistanceToAtmosphereEdge;uniform float horizonDistanceToAtmosphereEdgeSquared;uniform float planetRadiusWithOffset;uniform float planetRadiusOffset;uniform float atmosphereExposure;uniform float aerialPerspectiveRadianceBias;uniform float inverseAtmosphereThickness;uniform float aerialPerspectiveTransmittanceScale;uniform mat4 inverseViewProjectionWithoutTranslation;uniform vec3 directionToLight;uniform float multiScatteringIntensity;uniform vec3 directionToLightRelativeToCameraGeocentricNormal;uniform float cameraRadius;uniform vec3 lightRadianceAtCamera;uniform float diffuseSkyIrradianceDesaturationFactor;uniform vec3 groundAlbedo;uniform float aerialPerspectiveSaturation;uniform vec3 minMultiScattering;uniform float diffuseSkyIrradianceIntensity;uniform vec3 cameraPositionGlobal;uniform float lightIntensity;uniform vec3 clampedCameraPositionGlobal;uniform float aerialPerspectiveIntensity;uniform vec3 cameraGeocentricNormal;uniform float clampedCameraRadius;uniform vec3 cameraForward;uniform float clampedCameraHeight;uniform vec3 cameraPosition;uniform float cosCameraHorizonAngleFromZenith;uniform vec4 viewport;uniform vec3 additionalDiffuseSkyIrradiance;uniform float cameraHeight;uniform float cameraNearPlane;uniform float originHeight;uniform float sinCameraAtmosphereHorizonAngleFromNadir;\n")},415(e,t,i){var n=i(597),r="atmosphereFunctions";n.ShaderStore.IncludesShadersStore[r]||(n.ShaderStore.IncludesShadersStore[r]="#include<intersectionFunctions>\nconst vec2 MultiScatteringLutSize=vec2(32.0,32.0);const vec2 MultiScatteringLutDomainInUVSpace=(MultiScatteringLutSize-vec2(1.0))/MultiScatteringLutSize;const vec2 MultiScatteringLutHalfTexelSize=vec2(0.5)/MultiScatteringLutSize;const float NumAerialPerspectiveLutLayers=32.0;const vec3 AerialPerspectiveLutSize=vec3(16.0,64.0,NumAerialPerspectiveLutLayers);const vec2 DiffuseSkyIrradianceLutSize=vec2(64.0,16.0);const vec2 DiffuseSkyIrradianceLutDomainInUVSpace=(DiffuseSkyIrradianceLutSize-vec2(1.0))/DiffuseSkyIrradianceLutSize;const vec2 DiffuseSkyIrradianceLutHalfTexelSize=vec2(0.5)/DiffuseSkyIrradianceLutSize;const vec2 SkyViewLutSize=vec2(128.0,128.0);const vec2 SkyViewLutDomainInUVSpace=(SkyViewLutSize-vec2(1.0))/SkyViewLutSize;const vec2 SkyViewLutHalfTexelSize=vec2(0.5)/SkyViewLutSize;const float AerialPerspectiveLutKMPerSlice=4.0;const float AerialPerspectiveLutRangeKM=AerialPerspectiveLutKMPerSlice*NumAerialPerspectiveLutLayers;const float TransmittanceSampleCount=128.0;const float SkyViewLutSampleCount=30.0;const vec2 TransmittanceLutSize=vec2(256.,64.);const vec2 TransmittanceLutDomainInUVSpace=(TransmittanceLutSize-vec2(1.))/TransmittanceLutSize;const vec2 TransmittanceLutHalfTexelSize=vec2(0.5)/TransmittanceLutSize;const float TransmittanceHorizonRange=2.*TransmittanceLutHalfTexelSize.x;const float TransmittanceMaxUnoccludedU=1.-0.5*TransmittanceHorizonRange;const float TransmittanceMinOccludedU=1.+0.5*TransmittanceHorizonRange;vec2 uvToUnit(vec2 uv,vec2 domainInUVSpace,vec2 halfTexelSize) {return (uv-halfTexelSize)/domainInUVSpace;}\nvec2 unitToUV(vec2 unit,vec2 domainInUVSpace,vec2 halfTexelSize) {return unit*domainInUVSpace+halfTexelSize;}\nfloat sphereIntersectNearest(vec3 rayOrigin,vec3 rayDirection,float sphereRadius) {vec2 result=sphereIntersectFromOrigin(rayOrigin,rayDirection,sphereRadius);float c=dot(rayOrigin,rayOrigin)-sphereRadius*sphereRadius;return c>=0.0 ?\nresult.y :\nresult.x;}\nvoid moveToTopAtmosphere(\nvec3 cameraPosition,\nfloat positionRadius,\nvec3 positionGeocentricNormal,\nvec3 rayDirection,\nout bool intersectsAtmosphere,\nout vec3 cameraPositionClampedToTopOfAtmosphere) {intersectsAtmosphere=true;cameraPositionClampedToTopOfAtmosphere=cameraPosition;if (positionRadius>atmosphereRadius) {float tTop=sphereIntersectNearest(cameraPosition,rayDirection,atmosphereRadius);if (tTop>=0.0) {vec3 upOffset=-planetRadiusOffset*positionGeocentricNormal;cameraPositionClampedToTopOfAtmosphere=cameraPosition+rayDirection*tTop+upOffset;} else {intersectsAtmosphere=false;}}}\nvoid getSkyViewUVFromParameters(\nbool intersectsGround,\nfloat cosHorizonAngleFromZenith,\nfloat cosAngleBetweenViewAndZenith,\nfloat cosAngleBetweenViewAndLightOnPlane,\nout vec2 uv)\n{vec2 unit=vec2(0.);if (intersectsGround) {float coord=(cosAngleBetweenViewAndZenith+1.)/(cosHorizonAngleFromZenith+1.);coord=sqrtClamped(coord); \nunit.y=0.5*coord; } else {float coord=(cosAngleBetweenViewAndZenith-cosHorizonAngleFromZenith)/(1.-cosHorizonAngleFromZenith);coord=sqrtClamped(coord); \nunit.y=0.5*coord+0.5; }\n{float coord=0.5-0.5*cosAngleBetweenViewAndLightOnPlane;unit.x=coord;}\nuv=unitToUV(unit,SkyViewLutDomainInUVSpace,SkyViewLutHalfTexelSize);}\n#if USE_SKY_VIEW_LUT && SAMPLE_SKY_VIEW_LUT\n#define inline\nvec4 sampleSkyViewLut(\nsampler2D skyViewLut,\nfloat positionRadius,\nvec3 geocentricNormal,\nvec3 rayDirection,\nvec3 directionToLight,\nfloat cosHorizonAngleFromZenith,\nout float cosAngleBetweenViewAndZenith,\nout bool isRayIntersectingGround) {cosAngleBetweenViewAndZenith=dot(rayDirection,geocentricNormal);if (positionRadius>atmosphereRadius) {float sinAngleBetweenViewAndNadir=sqrtClamped(1.-cosAngleBetweenViewAndZenith*cosAngleBetweenViewAndZenith);if (sinAngleBetweenViewAndNadir>sinCameraAtmosphereHorizonAngleFromNadir) {isRayIntersectingGround=false;return vec4(0.);}}\nvec3 sideVector=normalize(cross(geocentricNormal,rayDirection));vec3 forwardVector=normalize(cross(sideVector,geocentricNormal));vec2 lightOnPlane=normalize(vec2(dot(directionToLight,forwardVector),dot(directionToLight,sideVector)));float cosAngleBetweenViewAndLightOnPlane=lightOnPlane.x;float rayIntersectionScale=mix(0.95,1.,saturate((positionRadius-planetRadius)/atmosphereThickness));isRayIntersectingGround =\npositionRadius>planetRadius &&\n(rayIntersectionScale*cosAngleBetweenViewAndZenith)<=cosHorizonAngleFromZenith;vec2 uv;getSkyViewUVFromParameters(\nisRayIntersectingGround,\ncosHorizonAngleFromZenith,\ncosAngleBetweenViewAndZenith,\ncosAngleBetweenViewAndLightOnPlane,\nuv);return textureLod(skyViewLut,uv,0.);}\n#endif\nfloat computeRayleighPhase(float onePlusCosThetaSq) {return 0.0596831037*onePlusCosThetaSq;}\nfloat computeMiePhaseCornetteShanks(float cosTheta,float onePlusCosThetaSq) {const float g=0.8;const float gSquared=g*g;const float oneMinusGSquared=1.-gSquared;const float onePlusGSquared=1.+gSquared;const float twoPlusGSquared=2.+gSquared;const float twoG=2.*g;const float threeOverEightPi=3./(8.*PI);return threeOverEightPi*oneMinusGSquared*onePlusCosThetaSq/(twoPlusGSquared*pow(onePlusGSquared-twoG*cosTheta,1.5));}\nfloat computeOzoneDensity(float normalizedViewHeight) {const float MinOzoneDensity=0.135;const float OneMinusMinOzoneDensity=1.-MinOzoneDensity;const float OzoneStartHeight=.15; \nconst float PeakOzoneHeight=.25;const float MaxOzoneHeight=0.6;const float InverseRampupDistance=1./(PeakOzoneHeight-OzoneStartHeight);const float InverseRampdownDistance=1./(MaxOzoneHeight-PeakOzoneHeight);float lowerAtmosphereDensity=MinOzoneDensity+OneMinusMinOzoneDensity*max(0.,normalizedViewHeight-OzoneStartHeight)*InverseRampupDistance;float sqrtUpperAtmosphereDensity=max(0.,1.-(normalizedViewHeight-PeakOzoneHeight)*InverseRampdownDistance);float upperAtmosphereDensity=sqrtUpperAtmosphereDensity*sqrtUpperAtmosphereDensity;float densityOzone=normalizedViewHeight<PeakOzoneHeight ? lowerAtmosphereDensity : upperAtmosphereDensity;return densityOzone;}\nvoid sampleMediumRGB(\nfloat viewHeight,\nout vec3 scatteringRayleigh,\nout vec3 scatteringMie,\nout vec3 extinction,\nout vec3 scattering) {float normalizedViewHeight=saturate(viewHeight*inverseAtmosphereThickness);float densityMie=exp(-83.333*normalizedViewHeight);float densityRayleigh=exp(-12.5*normalizedViewHeight);float densityOzone=computeOzoneDensity(normalizedViewHeight);scatteringRayleigh=densityRayleigh*peakRayleighScattering;scatteringMie=densityMie*peakMieScattering;scattering=scatteringMie+scatteringRayleigh;vec3 extinctionRayleigh=scatteringRayleigh;vec3 extinctionMie=densityMie*peakMieExtinction;vec3 extinctionOzone=densityOzone*peakOzoneAbsorption;extinction=extinctionRayleigh+extinctionMie+extinctionOzone;}\nvec3 computeTransmittance(vec3 rayOriginGlobal,vec3 rayDirection,float tMax,float sampleCount) {vec3 opticalDepth=vec3(0.);float t=0.;float sampleSegmentWeight=tMax/sampleCount;const float sampleSegmentT=0.3;for (float s=0.; s<sampleCount; s+=1.) {float newT=sampleSegmentWeight*(s+sampleSegmentT);float dt=newT-t;t=newT;vec3 scatteringRayleigh,scatteringMie,extinction,scattering;vec3 samplePositionGlobal=rayOriginGlobal+t*rayDirection;sampleMediumRGB(length(samplePositionGlobal)-planetRadius,scatteringRayleigh,scatteringMie,extinction,scattering);opticalDepth+=extinction*dt;}\nreturn exp(-opticalDepth);}\n#if defined(SAMPLE_TRANSMITTANCE_LUT) || !defined(EXCLUDE_RAY_MARCHING_FUNCTIONS)\nvec2 getTransmittanceUV(float radius,float cosAngleLightToZenith,out float distanceToHorizon) {float radiusSquared=radius*radius;distanceToHorizon=sqrtClamped(radiusSquared-planetRadiusSquared);float cosAngleLightToZenithSquared=cosAngleLightToZenith*cosAngleLightToZenith;float discriminant=radiusSquared*(cosAngleLightToZenithSquared-1.)+atmosphereRadiusSquared;float distanceToAtmosphereEdge=max(0.,-radius*cosAngleLightToZenith+sqrtClamped(discriminant));float minDistanceToAtmosphereEdge=max(0.,atmosphereRadius-radius);float maxDistanceToAtmosphereEdge=distanceToHorizon+horizonDistanceToAtmosphereEdge;float cosAngleLightToZenithCoordinate=(distanceToAtmosphereEdge-minDistanceToAtmosphereEdge)/max(0.000001,maxDistanceToAtmosphereEdge-minDistanceToAtmosphereEdge);float distanceToHorizonCoordinate=distanceToHorizon/max(0.000001,horizonDistanceToAtmosphereEdge);vec2 unit=vec2(cosAngleLightToZenithCoordinate,distanceToHorizonCoordinate);return unit*TransmittanceLutDomainInUVSpace+TransmittanceLutHalfTexelSize; }\n#define inline\nvec4 sampleTransmittanceLut(sampler2D transmittanceLut,float positionRadius,float cosAngleLightToZenith) {float distanceToHorizon;vec2 uv=getTransmittanceUV(positionRadius,cosAngleLightToZenith,distanceToHorizon);float weight=smoothstep(TransmittanceMinOccludedU,TransmittanceMaxUnoccludedU,uv.x);return weight*textureLod(transmittanceLut,uv,0.);}\n#endif\n#ifndef EXCLUDE_RAY_MARCHING_FUNCTIONS\n#ifndef COMPUTE_MULTI_SCATTERING\n#define inline\nvec3 sampleMultiScatteringLut(sampler2D multiScatteringLut,float radius,float cosAngleLightToZenith) {vec2 unit=vec2(0.5+0.5*cosAngleLightToZenith,(radius-planetRadius)/atmosphereThickness);vec2 uv=unitToUV(unit,MultiScatteringLutDomainInUVSpace,MultiScatteringLutHalfTexelSize);vec3 multiScattering=textureLod(multiScatteringLut,uv,0.).rgb;return max(minMultiScattering,multiScattering);}\n#endif\nconst float uniformPhase=RECIPROCAL_PI4;\n#define inline\nvec3 integrateScatteredRadiance(\nbool isAerialPerspectiveLut,\nfloat lightIntensity,\nsampler2D transmittanceLut,\n#ifndef COMPUTE_MULTI_SCATTERING\nsampler2D multiScatteringLut,\nfloat multiScatteringIntensity,\n#endif\nvec3 rayOriginGlobal,\nvec3 rayDirection,\nvec3 directionToLight,\nfloat tMaxMax,\nfloat sampleCount,\nfloat distanceToSurface,\nout vec3 transmittance\n#if COMPUTE_MULTI_SCATTERING\n,out vec3 multiScattering\n#endif\n) {vec3 radiance=vec3(0.);transmittance=vec3(1.);\n#if COMPUTE_MULTI_SCATTERING\nmultiScattering=vec3(0.);\n#endif\nfloat tBottom=sphereIntersectNearest(rayOriginGlobal,rayDirection,planetRadius);float tTop=sphereIntersectNearest(rayOriginGlobal,rayDirection,atmosphereRadius);float tMax=0.;if (tBottom<0.) {if (tTop<0.) {return radiance;} else {tMax=tTop;}} else {if (tTop>0.) {if (isAerialPerspectiveLut) {tMax=tTop;} else {tMax=min(tBottom,tTop);}}}\nif (distanceToSurface>0. && distanceToSurface<tMax) {tMax=distanceToSurface;}\ntMax=min(tMax,tMaxMax);\n#ifndef COMPUTE_MULTI_SCATTERING\nfloat cosTheta=dot(rayDirection,directionToLight);float onePlusCosThetaSq=1.+cosTheta*cosTheta;float rayleighPhase=computeRayleighPhase(onePlusCosThetaSq);float miePhase=computeMiePhaseCornetteShanks(cosTheta,onePlusCosThetaSq);\n#endif\nfloat transmittanceScale=isAerialPerspectiveLut ? aerialPerspectiveTransmittanceScale : 1.;float t=0.;float sampleSegmentWeight=tMax/sampleCount;const float sampleSegmentT=0.3;for (float s=0.; s<sampleCount; s+=1.) {float newT=sampleSegmentWeight*(s+sampleSegmentT);float dt=newT-t;t=newT;vec3 samplePositionGlobal=rayOriginGlobal+t*rayDirection;float sampleRadiusGlobal=length(samplePositionGlobal);vec3 sampleGeocentricNormal=samplePositionGlobal/sampleRadiusGlobal;float sampleCosAngleLightToZenith=dot(directionToLight,sampleGeocentricNormal);vec3 scatteringRayleigh,scatteringMie,extinction,scattering;sampleMediumRGB(sampleRadiusGlobal-planetRadius,scatteringRayleigh,scatteringMie,extinction,scattering);vec3 transmittanceToLight=sampleTransmittanceLut(transmittanceLut,sampleRadiusGlobal,sampleCosAngleLightToZenith).rgb;\n#if COMPUTE_MULTI_SCATTERING\nvec3 phaseTimesScattering=uniformPhase*scattering;vec3 S=transmittanceToLight*phaseTimesScattering;\n#else\nvec3 phaseTimesScattering=scatteringMie*miePhase+scatteringRayleigh*rayleighPhase;vec3 multiScatteredRadiance=sampleMultiScatteringLut(multiScatteringLut,sampleRadiusGlobal,sampleCosAngleLightToZenith);vec3 S=transmittanceScale*transmittanceToLight*phaseTimesScattering+multiScatteringIntensity*multiScatteredRadiance*scattering;\n#endif\nvec3 sampleOpticalDepth=extinction*dt;vec3 sampleTransmittance=exp(-sampleOpticalDepth);vec3 clampedExtinction=max(vec3(0.0000001),extinction);vec3 SInt=(S-S*sampleTransmittance)/clampedExtinction;radiance+=transmittance*SInt;\n#if COMPUTE_MULTI_SCATTERING\nvec3 MSInt=(scattering-scattering*sampleTransmittance)/clampedExtinction;multiScattering+=transmittance*MSInt;\n#endif\ntransmittance*=sampleTransmittance;}\n#if USE_GROUND_ALBEDO\nif (tMax==tBottom && tBottom>0.) {vec3 planetPos=rayOriginGlobal+tBottom*rayDirection;float planetPosRadius=length(planetPos);vec3 planetPosGeocentricNormal=planetPos/planetPosRadius;float nDotL=dot(directionToLight,planetPosGeocentricNormal);vec3 lightTransmittance=sampleTransmittanceLut(transmittanceLut,planetPosRadius,nDotL).rgb;const float diffuseBrdf=RECIPROCAL_PI;radiance+=lightTransmittance*transmittance*groundAlbedo*(nDotL*diffuseBrdf);}\n#endif\nradiance*=lightIntensity;return radiance;}\n#endif\nfloat layerIdxToAerialPerspectiveLayer(float layerIdx) {float layer=(layerIdx+1.)/NumAerialPerspectiveLutLayers;layer*=layer; \nlayer*=NumAerialPerspectiveLutLayers;return layer;}\nfloat toAerialPerspectiveDepth(float layer) {return layer*AerialPerspectiveLutKMPerSlice;}\nfloat toAerialPerspectiveLayer(float distance,float aerialPerspectiveLutDistancePerSlice) {return distance/aerialPerspectiveLutDistancePerSlice;}\nvec4 applyAerialPerspectiveSaturation(vec4 aerialPerspective) {float previousRadiance=getLuminance(aerialPerspective.rgb);aerialPerspective.rgb=mix(vec3(previousRadiance),aerialPerspective.rgb,aerialPerspectiveSaturation);return aerialPerspective;}\nvec4 applyAerialPerspectiveIntensity(vec4 aerialPerspective) {\n#if APPLY_AERIAL_PERSPECTIVE_INTENSITY\nif (aerialPerspectiveIntensity==0.) {aerialPerspective=vec4(0.);} else {float previousAlpha=aerialPerspective.a;aerialPerspective/=max(0.00001,previousAlpha);aerialPerspective*=pow(previousAlpha,1./aerialPerspectiveIntensity);}\n#endif\nreturn aerialPerspective;}\nvec4 applyAerialPerspectiveRadianceBias(vec4 aerialPerspective) {\n#if APPLY_AERIAL_PERSPECTIVE_RADIANCE_BIAS\nfloat originalRadiance=dot(aerialPerspective.rgb,LuminanceEncodeApprox);float targetRadiance=originalRadiance+aerialPerspectiveRadianceBias;if (originalRadiance>0.) {aerialPerspective*=max(0.,targetRadiance/originalRadiance);} else {aerialPerspective=max(vec4(0.),vec4(aerialPerspectiveRadianceBias));}\naerialPerspective.a=min(aerialPerspective.a,1.);\n#endif\nreturn aerialPerspective;}\nbool sampleAerialPerspectiveLut(\nvec2 screenUV,\nbool clampToLutRange,\nfloat distanceFromCamera,\nfloat numAerialPerspectiveLutLayers,\nfloat aerialPerspectiveLutKMPerSlice,\nfloat aerialPerspectiveLutRangeKM,\nout vec4 aerialPerspective) {aerialPerspective=vec4(0.);\n#if USE_AERIAL_PERSPECTIVE_LUT\nif (distanceFromCamera>0. &&\n(clampToLutRange || distanceFromCamera<aerialPerspectiveLutRangeKM) &&\nclampedCameraRadius<=atmosphereRadius) {float layer=toAerialPerspectiveLayer(distanceFromCamera,aerialPerspectiveLutKMPerSlice);float normalizedLayer=sqrt(layer/numAerialPerspectiveLutLayers); \nlayer=min(normalizedLayer*numAerialPerspectiveLutLayers,numAerialPerspectiveLutLayers);float weight=min(layer,1.);float layerIdx=max(0.,layer-1.);float floorLayerIdx=floor(layerIdx);vec4 aerialPerspectiveLayer0=textureLod(aerialPerspectiveLut,vec3(screenUV,floorLayerIdx),0.);vec4 aerialPerspectiveLayer1=textureLod(aerialPerspectiveLut,vec3(screenUV,floorLayerIdx+1.),0.);aerialPerspective=mix(aerialPerspectiveLayer0,aerialPerspectiveLayer1,layerIdx-floorLayerIdx);aerialPerspective.rgb*=atmosphereExposure;aerialPerspective=applyAerialPerspectiveSaturation(aerialPerspective);aerialPerspective=weight*applyAerialPerspectiveIntensity(aerialPerspective);aerialPerspective=applyAerialPerspectiveRadianceBias(aerialPerspective);return true;}\n#endif\nreturn false;}\n#if RENDER_TRANSMITTANCE\nvoid getTransmittanceParameters(vec2 uv,out float radius,out float cosAngleLightToZenith,out float distanceToAtmosphereEdge) {vec2 unit=uvToUnit(uv,TransmittanceLutDomainInUVSpace,TransmittanceLutHalfTexelSize);float distanceToHorizon=unit.y*horizonDistanceToAtmosphereEdge;float distanceToHorizonSquared=distanceToHorizon*distanceToHorizon;radius=sqrtClamped(distanceToHorizonSquared+planetRadiusSquared);float minDistanceToAtmosphereEdge=atmosphereRadius-radius;float maxDistanceToAtmosphereEdge=distanceToHorizon+horizonDistanceToAtmosphereEdge;distanceToAtmosphereEdge=minDistanceToAtmosphereEdge+unit.x*(maxDistanceToAtmosphereEdge-minDistanceToAtmosphereEdge);float distanceToAtmosphereEdgeSquared=distanceToAtmosphereEdge*distanceToAtmosphereEdge;cosAngleLightToZenith =\ndistanceToAtmosphereEdge<=0. ?\n1. :\n(horizonDistanceToAtmosphereEdgeSquared-distanceToAtmosphereEdgeSquared-distanceToHorizonSquared)/(2.*radius*distanceToAtmosphereEdge);cosAngleLightToZenith=clamp(cosAngleLightToZenith,-1.,1.);}\nvec4 renderTransmittance(vec2 uv) {float radius,cosAngleLightToZenith,distanceToAtmosphereEdgeAlongAngle;getTransmittanceParameters(uv,radius,cosAngleLightToZenith,distanceToAtmosphereEdgeAlongAngle);float sinAngleLightToZenith=sqrtClamped(1.-cosAngleLightToZenith*cosAngleLightToZenith);vec3 directionToLight=normalize(vec3(0.,cosAngleLightToZenith,sinAngleLightToZenith));vec3 transmittance=computeTransmittance(vec3(0.,radius,0.),directionToLight,distanceToAtmosphereEdgeAlongAngle,TransmittanceSampleCount);return vec4(transmittance,avg(transmittance));}\n#endif\n#if RENDER_MULTI_SCATTERING\nvec3 getSphereSample(float azimuth,float inclination,out float sinInclination) {sinInclination=sin(inclination);return vec3(sinInclination*sin(azimuth),cos(inclination),sinInclination*cos(azimuth));}\nconst float MultiScatteringInclinationSampleCount=8.;const float MultiScatteringAzimuthSampleCount=2.*MultiScatteringInclinationSampleCount;const float MultiScatteringLutSampleCount=64.;const float MultiScatteringAzimuthIterationAngle=TWO_PI/MultiScatteringAzimuthSampleCount;const float MultiScatteringInclinationIterationAngle=PI/MultiScatteringInclinationSampleCount;const float MultiScatteringAngleStepProduct=MultiScatteringAzimuthIterationAngle*MultiScatteringInclinationIterationAngle;\n#define inline\nvec4 renderMultiScattering(vec2 uv,sampler2D transmittanceLut) {vec2 unit=uvToUnit(uv,MultiScatteringLutDomainInUVSpace,MultiScatteringLutHalfTexelSize);float cosAngleLightToZenith=2.*unit.x-1.;float sinAngleLightToZenith=sqrtClamped(1.-cosAngleLightToZenith*cosAngleLightToZenith);vec3 directionToLight=normalize(vec3(0.,cosAngleLightToZenith,sinAngleLightToZenith));float rayOriginRadius=planetRadius+max(unit.y,0.001)*atmosphereThickness;vec3 rayOrigin=vec3(0.,rayOriginRadius,0.);vec3 inscattered=vec3(0.);vec3 multiScatteringTotal=vec3(0.);for (float i=0.5; i<MultiScatteringAzimuthSampleCount; ++i) {float azimuth=MultiScatteringAzimuthIterationAngle*i;for (float j=0.5; j<MultiScatteringInclinationSampleCount; ++j) {float inclination=MultiScatteringInclinationIterationAngle*j;float sinInclination;vec3 rayDirection=getSphereSample(azimuth,inclination,sinInclination);vec3 transmittance;vec3 multiScattering;vec3 radiance=integrateScatteredRadiance(\nfalse,\n1.,\ntransmittanceLut,\nrayOrigin,\nrayDirection,\ndirectionToLight,\n100000000.,\nMultiScatteringLutSampleCount,\n-1.,\ntransmittance,\nmultiScattering);float weight=RECIPROCAL_PI4*abs(sinInclination)*MultiScatteringAngleStepProduct;multiScatteringTotal+=multiScattering*weight;inscattered+=radiance*weight;}}\nvec3 multiScattering=inscattered/max(vec3(0.000001),vec3(1.)-multiScatteringTotal);return vec4(multiScattering,1.);}\n#endif\nfloat computeCosHorizonAngleFromZenith(float radius) {float sinAngleBetweenHorizonAndNadir=min(1.,planetRadius/radius);float cosHorizonAngleFromNadir=sqrt(1.-sinAngleBetweenHorizonAndNadir*sinAngleBetweenHorizonAndNadir);float cosHorizonAngleFromZenith=-cosHorizonAngleFromNadir;return cosHorizonAngleFromZenith;}\n#if RENDER_SKY_VIEW\nvoid getSkyViewParametersFromUV(\nfloat radius,\nvec2 uv,\nout float cosAngleBetweenViewAndZenith,\nout float cosAngleBetweenViewAndLightOnPlane) {vec2 unit=uvToUnit(uv,SkyViewLutDomainInUVSpace,SkyViewLutHalfTexelSize);float cosHorizonAngleFromZenith=computeCosHorizonAngleFromZenith(radius);if (unit.y<0.5) {float coord=2.*unit.y; \ncoord*=coord; \ncosAngleBetweenViewAndZenith=mix(-1.,cosHorizonAngleFromZenith,coord); } else {float coord=2.*unit.y-1.; \ncoord*=coord; \ncosAngleBetweenViewAndZenith=mix(cosHorizonAngleFromZenith,1.,coord); }\n{float coord=unit.x;cosAngleBetweenViewAndLightOnPlane=1.-2.*coord;}}\n#define inline\nvec4 renderSkyView(vec2 uv,sampler2D transmittanceLut,sampler2D multiScatteringLut) {float cosAngleBetweenViewAndZenith;float cosAngleBetweenViewAndLightOnPlane;getSkyViewParametersFromUV(clampedCameraRadius,uv,cosAngleBetweenViewAndZenith,cosAngleBetweenViewAndLightOnPlane);float sinAngleBetweenViewAndZenith=sqrtClamped(1.-cosAngleBetweenViewAndZenith*cosAngleBetweenViewAndZenith);float sinAngleBetweenViewAndLightOnPlane=sqrtClamped(1.-cosAngleBetweenViewAndLightOnPlane*cosAngleBetweenViewAndLightOnPlane);vec3 rayDirection =\nvec3(\nsinAngleBetweenViewAndZenith*cosAngleBetweenViewAndLightOnPlane,\ncosAngleBetweenViewAndZenith,\nsinAngleBetweenViewAndZenith*sinAngleBetweenViewAndLightOnPlane);bool intersectsAtmosphere=false;vec3 cameraPositionGlobalClampedToTopOfAtmosphere=vec3(0.);moveToTopAtmosphere(\nvec3(0.,clampedCameraRadius,0.),\nclampedCameraRadius,\nvec3(0.,1.,0.),\nrayDirection,\nintersectsAtmosphere,\ncameraPositionGlobalClampedToTopOfAtmosphere);if (!intersectsAtmosphere) {return vec4(0.);}\nvec3 transmittance;vec3 radiance=integrateScatteredRadiance(\nfalse,\natmosphereExposure*lightIntensity,\ntransmittanceLut,\nmultiScatteringLut,\nmultiScatteringIntensity,\ncameraPositionGlobalClampedToTopOfAtmosphere,\nrayDirection,\ndirectionToLightRelativeToCameraGeocentricNormal,\n100000000.,\nSkyViewLutSampleCount,\n-1.,\ntransmittance);float transparency=1.-avg(transmittance);return vec4(radiance,transparency);}\n#endif\n#if RENDER_CAMERA_VOLUME\n#define inline\nvec4 renderCameraVolume(\nvec3 positionOnNearPlane,\nfloat layerIdx,\nsampler2D transmittanceLut,\nsampler2D multiScatteringLut) {vec4 result=vec4(0.);vec3 rayDirection=normalize(positionOnNearPlane);float layer=layerIdxToAerialPerspectiveLayer(layerIdx);float tMax=toAerialPerspectiveDepth(layer);float tMaxMax=tMax;vec3 cameraPositionGlobalClampedToTopOfAtmosphere=clampedCameraPositionGlobal;if (clampedCameraRadius>=atmosphereRadius) {bool intersectsAtmosphere=false;moveToTopAtmosphere(\nclampedCameraPositionGlobal,\nclampedCameraRadius,\ncameraGeocentricNormal,\nrayDirection,\nintersectsAtmosphere,\ncameraPositionGlobalClampedToTopOfAtmosphere);if (!intersectsAtmosphere) {return result;}\nfloat distanceToAtmosphere=distance(clampedCameraPositionGlobal,cameraPositionGlobalClampedToTopOfAtmosphere);if (tMaxMax<distanceToAtmosphere) {return result;}\ntMaxMax=max(0.,tMaxMax-distanceToAtmosphere);}\nfloat sampleCount=min(SkyViewLutSampleCount,2.*layer+2.);vec3 transmittance;vec3 radiance=integrateScatteredRadiance(\ntrue,\nlightIntensity,\ntransmittanceLut,\nmultiScatteringLut,\nmultiScatteringIntensity,\ncameraPositionGlobalClampedToTopOfAtmosphere,\nrayDirection,\ndirectionToLight,\ntMaxMax,\nsampleCount,\n-1.,\ntransmittance);float transparency=1.-avg(transmittance);result=vec4(radiance,transparency);return result;}\n#endif\n")},684(e,t,i){var n=i(597),r="atmosphereUboDeclaration";n.ShaderStore.IncludesShadersStore[r]||(n.ShaderStore.IncludesShadersStore[r]="layout(std140,column_major) uniform;uniform Atmosphere {vec3 peakRayleighScattering;float planetRadius;vec3 peakMieScattering;float atmosphereThickness;vec3 peakMieAbsorption;float planetRadiusSquared;vec3 peakMieExtinction;float atmosphereRadius;vec3 peakOzoneAbsorption;float atmosphereRadiusSquared;float horizonDistanceToAtmosphereEdge;float horizonDistanceToAtmosphereEdgeSquared;float planetRadiusWithOffset;float planetRadiusOffset;float atmosphereExposure;float aerialPerspectiveRadianceBias;float inverseAtmosphereThickness;float aerialPerspectiveTransmittanceScale;mat4 inverseViewProjectionWithoutTranslation;vec3 directionToLight;float multiScatteringIntensity;vec3 directionToLightRelativeToCameraGeocentricNormal;float cameraRadius;vec3 lightRadianceAtCamera;float diffuseSkyIrradianceDesaturationFactor;vec3 groundAlbedo;float aerialPerspectiveSaturation;vec3 minMultiScattering;float diffuseSkyIrradianceIntensity;vec3 cameraPositionGlobal;float lightIntensity;vec3 clampedCameraPositionGlobal;float aerialPerspectiveIntensity;vec3 cameraGeocentricNormal;float clampedCameraRadius;vec3 cameraForward;float clampedCameraHeight;vec3 cameraPosition;float cosCameraHorizonAngleFromZenith;vec4 viewport;vec3 additionalDiffuseSkyIrradiance;float cameraHeight;float cameraNearPlane;float originHeight;float sinCameraAtmosphereHorizonAngleFromNadir;};\n")},926(e,t,i){var n=i(597),r="depthFunctions";n.ShaderStore.IncludesShadersStore[r]||(n.ShaderStore.IncludesShadersStore[r]="float reconstructDistanceFromCameraPlane(float depth,float cameraNearPlane) {return cameraNearPlane/(1.-depth);}\nfloat sampleDistanceFromCameraPlane(sampler2D depthTexture,vec2 uv,float cameraNearPlane) {float depth=textureLod(depthTexture,uv,0.).r;return depth>=1. ? 0. : reconstructDistanceFromCameraPlane(depth,cameraNearPlane);}\nfloat reconstructDistanceFromCamera(float depth,vec3 cameraRayDirection,vec3 cameraForward,float cameraNearPlane) {float distanceFromCameraPlane=reconstructDistanceFromCameraPlane(depth,cameraNearPlane);return distanceFromCameraPlane/max(0.00001,dot(cameraForward,cameraRayDirection));}\nfloat reconstructDistanceFromCamera(\nsampler2D depthTexture,\nvec2 uv,\nvec3 cameraRayDirection,\nvec3 cameraForward,\nfloat cameraNearPlane) {float depth=textureLod(depthTexture,uv,0.).r;return depth>=1. ? 0. : reconstructDistanceFromCamera(depth,cameraRayDirection,cameraForward,cameraNearPlane);}")},229(e,t,i){i.r(t),i.d(t,{aerialPerspectivePixelShader:()=>o});var n=i(597),r=(i(554),i(684),i(415),"aerialPerspectivePixelShader"),a="#define RENDER_CAMERA_VOLUME\nprecision highp float;\n#include<__decl__atmosphereFragment>\nuniform sampler2D transmittanceLut;uniform sampler2D multiScatteringLut;\n#include<helperFunctions>\n#include<atmosphereFunctions>\nvarying vec3 positionOnNearPlane;uniform float layerIdx;void main() {gl_FragColor=renderCameraVolume(\npositionOnNearPlane,\nlayerIdx,\ntransmittanceLut,\nmultiScatteringLut\n);}";n.ShaderStore.ShadersStore[r]||(n.ShaderStore.ShadersStore[r]=a);var o={name:r,shader:a}},674(e,t,i){i.r(t),i.d(t,{compositeAerialPerspectivePixelShader:()=>o});var n=i(597),r=(i(554),i(684),i(926),i(415),"compositeAerialPerspectivePixelShader"),a="precision highp float;precision highp sampler2D;precision highp sampler2DArray;\n#include<__decl__atmosphereFragment>\n#if USE_AERIAL_PERSPECTIVE_LUT\nuniform sampler2DArray aerialPerspectiveLut;\n#endif\nuniform sampler2D depthTexture;uniform sampler2D transmittanceLut;uniform sampler2D multiScatteringLut;\n#include<helperFunctions>\n#include<depthFunctions>\n#include<atmosphereFunctions>\nvarying vec2 uv;varying vec3 positionOnNearPlane;void main() {gl_FragColor=vec4(0.);float depth=textureLod(depthTexture,uv,0.).r;if (depth>=1.) {discard;}\nvec3 rayDirection=normalize(positionOnNearPlane);float distanceFromCamera =\nreconstructDistanceFromCamera(\ndepth,\nrayDirection,\ncameraForward,\ncameraNearPlane);float distanceToSurface=distanceFromCamera/1000.;vec4 aerialPerspective=vec4(0.);if (sampleAerialPerspectiveLut(\nuv,\nfalse,\ndistanceToSurface,\nNumAerialPerspectiveLutLayers,\nAerialPerspectiveLutKMPerSlice,\nAerialPerspectiveLutRangeKM,\naerialPerspective)) {\n#ifndef APPLY_TRANSMITTANCE_BLENDING\naerialPerspective.a=0.;\n#endif\ngl_FragColor=aerialPerspective;} else {bool intersectsAtmosphere=false;vec3 cameraPositionGlobalClampedToTopOfAtmosphere=vec3(0.);moveToTopAtmosphere(\nclampedCameraPositionGlobal,\nclampedCameraRadius,\ncameraGeocentricNormal,\nrayDirection,\nintersectsAtmosphere,\ncameraPositionGlobalClampedToTopOfAtmosphere);if (!intersectsAtmosphere) {gl_FragColor=vec4(0.);return;}\nbool isAerialPerspectiveLut=clampedCameraRadius<atmosphereRadius;vec3 transmittance;vec3 radiance=integrateScatteredRadiance(\nisAerialPerspectiveLut,\natmosphereExposure*lightIntensity,\ntransmittanceLut,\nmultiScatteringLut,\nmultiScatteringIntensity,\ncameraPositionGlobalClampedToTopOfAtmosphere,\nrayDirection,\ndirectionToLight,\n100000000.,\nSkyViewLutSampleCount,\ndistanceToSurface,\ntransmittance);float transparency=1.-avg(transmittance);gl_FragColor =\napplyAerialPerspectiveRadianceBias(\napplyAerialPerspectiveIntensity(\napplyAerialPerspectiveSaturation(vec4(radiance,transparency))));\n#ifndef APPLY_TRANSMITTANCE_BLENDING\ngl_FragColor.a=0.;\n#endif\n}\n#if OUTPUT_TO_SRGB\ngl_FragColor=toGammaSpace(gl_FragColor);\n#endif\n}";n.ShaderStore.ShadersStore[r]||(n.ShaderStore.ShadersStore[r]=a);var o={name:r,shader:a}},657(e,t,i){i.r(t),i.d(t,{compositeGlobeAtmospherePixelShader:()=>o});var n=i(597),r=(i(554),i(684),i(926),i(415),"compositeGlobeAtmospherePixelShader"),a="#define SAMPLE_SKY_VIEW_LUT\n#if USE_SKY_VIEW_LUT\n#define EXCLUDE_RAY_MARCHING_FUNCTIONS\n#endif\nprecision highp float;precision highp sampler2D;\n#include<__decl__atmosphereFragment>\n#if HAS_DEPTH_TEXTURE\nuniform sampler2D depthTexture;\n#endif\n#if USE_SKY_VIEW_LUT\nuniform sampler2D skyViewLut;\n#else\nuniform sampler2D transmittanceLut;uniform sampler2D multiScatteringLut;\n#endif\n#include<helperFunctions>\n#include<depthFunctions>\n#include<atmosphereFunctions>\nvarying vec2 uv;varying vec3 positionOnNearPlane;void main() {gl_FragColor=vec4(0.);\n#if HAS_DEPTH_TEXTURE\nfloat depth=textureLod(depthTexture,uv,0.).r;\n#endif\nvec3 rayDirection=normalize(positionOnNearPlane);\n#if USE_SKY_VIEW_LUT\nfloat cosAngleBetweenViewAndZenith;bool isRayIntersectingGround;vec4 skyColor=sampleSkyViewLut(\nskyViewLut,\nclampedCameraRadius,\ncameraGeocentricNormal,\nrayDirection,\ndirectionToLight,\ncosCameraHorizonAngleFromZenith,\ncosAngleBetweenViewAndZenith,\nisRayIntersectingGround);gl_FragColor=skyColor;if (isRayIntersectingGround) {gl_FragColor =\napplyAerialPerspectiveRadianceBias(\napplyAerialPerspectiveIntensity(\napplyAerialPerspectiveSaturation(gl_FragColor)));\n#if HAS_DEPTH_TEXTURE\ngl_FragColor.a=depth>=1. ? 1. : gl_FragColor.a;\n#endif\n}\n#else\nbool intersectsAtmosphere=false;vec3 cameraPositionGlobalClampedToTopOfAtmosphere=vec3(0.);moveToTopAtmosphere(\nclampedCameraPositionGlobal,\nclampedCameraRadius,\ncameraGeocentricNormal,\nrayDirection,\nintersectsAtmosphere,\ncameraPositionGlobalClampedToTopOfAtmosphere);if (!intersectsAtmosphere) {return;}\n#if HAS_DEPTH_TEXTURE\nfloat distanceFromCamera =\nreconstructDistanceFromCamera(\ndepth,\nrayDirection,\ncameraForward,\ncameraNearPlane);float distanceToSurface=distanceFromCamera/1000.;\n#else\nfloat distanceToSurface=0.;\n#endif\nvec3 transmittance;vec3 radiance=integrateScatteredRadiance(\nfalse,\natmosphereExposure*lightIntensity,\ntransmittanceLut,\nmultiScatteringLut,\nmultiScatteringIntensity,\ncameraPositionGlobalClampedToTopOfAtmosphere,\nrayDirection,\ndirectionToLight,\n100000000.,\nSkyViewLutSampleCount,\ndistanceToSurface,\ntransmittance);float transparency=1.-avg(transmittance);gl_FragColor=vec4(radiance,transparency);if (distanceToSurface>0.) {gl_FragColor =\napplyAerialPerspectiveRadianceBias(\napplyAerialPerspectiveIntensity(\napplyAerialPerspectiveSaturation(gl_FragColor)));\n#if HAS_DEPTH_TEXTURE\ngl_FragColor.a=depth>=1. ? 1. : gl_FragColor.a;\n#endif\n}\n#endif\n#if OUTPUT_TO_SRGB\ngl_FragColor=toGammaSpace(gl_FragColor);\n#endif\n}";n.ShaderStore.ShadersStore[r]||(n.ShaderStore.ShadersStore[r]=a);var o={name:r,shader:a}},209(e,t,i){i.r(t),i.d(t,{compositeSkyPixelShader:()=>o});var n=i(597),r=(i(554),i(684),i(415),"compositeSkyPixelShader"),a="#define SAMPLE_SKY_VIEW_LUT\n#if USE_SKY_VIEW_LUT\n#define EXCLUDE_RAY_MARCHING_FUNCTIONS\n#endif\nprecision highp float;precision highp sampler2D;\n#include<__decl__atmosphereFragment>\n#if USE_SKY_VIEW_LUT\nuniform sampler2D skyViewLut;\n#else\nuniform sampler2D transmittanceLut;uniform sampler2D multiScatteringLut;\n#endif\n#include<helperFunctions>\n#include<atmosphereFunctions>\nvarying vec2 uv;varying vec3 positionOnNearPlane;void main() {gl_FragColor=vec4(0.);vec3 rayDirection=normalize(positionOnNearPlane);\n#if USE_SKY_VIEW_LUT\nfloat cosAngleBetweenViewAndZenith;bool isRayIntersectingGround;vec4 skyColor=sampleSkyViewLut(\nskyViewLut,\nclampedCameraRadius,\ncameraGeocentricNormal,\nrayDirection,\ndirectionToLight,\ncosCameraHorizonAngleFromZenith,\ncosAngleBetweenViewAndZenith,\nisRayIntersectingGround);\n#ifndef APPLY_TRANSMITTANCE_BLENDING\nskyColor.a=0.;\n#endif\ngl_FragColor=skyColor;gl_FragColor.a=isRayIntersectingGround ? 1. : gl_FragColor.a;\n#else\nbool intersectsAtmosphere=false;vec3 cameraPositionGlobalClampedToTopOfAtmosphere=vec3(0.);moveToTopAtmosphere(\nclampedCameraPositionGlobal,\nclampedCameraRadius,\ncameraGeocentricNormal,\nrayDirection,\nintersectsAtmosphere,\ncameraPositionGlobalClampedToTopOfAtmosphere);if (!intersectsAtmosphere) {return;}\nvec3 transmittance;vec3 radiance=integrateScatteredRadiance(\nfalse,\natmosphereExposure*lightIntensity,\ntransmittanceLut,\nmultiScatteringLut,\nmultiScatteringIntensity,\ncameraPositionGlobalClampedToTopOfAtmosphere,\nrayDirection,\ndirectionToLight,\n100000000.,\nSkyViewLutSampleCount,\n-1.,\ntransmittance);\n#if APPLY_TRANSMITTANCE_BLENDING\nfloat transparency=1.-avg(transmittance);\n#else\nfloat transparency=0.;\n#endif\ngl_FragColor=vec4(radiance,transparency);\n#endif\n#if OUTPUT_TO_SRGB\ngl_FragColor=toGammaSpace(gl_FragColor);\n#endif\n}";n.ShaderStore.ShadersStore[r]||(n.ShaderStore.ShadersStore[r]=a);var o={name:r,shader:a}},62(e,t,i){i.r(t),i.d(t,{diffuseSkyIrradiancePixelShader:()=>o});var n=i(597),r=(i(554),i(684),i(415),"diffuseSkyIrradiancePixelShader"),a="precision highp float;const float DiffuseSkyIrradianceLutSampleCount=32.0;\n#include<__decl__atmosphereFragment>\nuniform sampler2D transmittanceLut;uniform sampler2D multiScatteringLut;\n#include<helperFunctions>\n#include<atmosphereFunctions>\nvec3 integrateForIrradiance(vec3 directionToLight,vec3 rayDirection,vec3 rayOrigin) {vec3 transmittance;vec3 radiance=integrateScatteredRadiance(\nfalse,\n1.,\ntransmittanceLut,\nmultiScatteringLut,\nmultiScatteringIntensity,\nrayOrigin,\nrayDirection.xzy,\ndirectionToLight.xzy,\n100000000.,\nDiffuseSkyIrradianceLutSampleCount,\n-1.,\ntransmittance);return radiance;}\n#include<importanceSampling>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\nvarying vec2 uv;void main() {vec2 unit=uvToUnit(uv,DiffuseSkyIrradianceLutDomainInUVSpace,DiffuseSkyIrradianceLutHalfTexelSize);float cosLightInclination=2.*unit.x-1.;float sinLightInclination=sqrtClamped(1.-cosLightInclination*cosLightInclination);vec3 directionToLight=normalize(vec3(0.,cosLightInclination,sinLightInclination));float radius=max(planetRadiusWithOffset,unit.y*atmosphereThickness+planetRadius);vec3 swappedDirectionToLight=vec3(directionToLight.x,directionToLight.z,directionToLight.y); \nvec3 irradiance=PI*irradiance(\nswappedDirectionToLight,\nvec2(radius,0.),\n1.,\nvec3(1.),\nvec3(1.));float averageIrradiance=getLuminance(irradiance);vec3 newIrradiance=mix(irradiance,vec3(averageIrradiance),diffuseSkyIrradianceDesaturationFactor);float newIrradianceScale=getLuminance(newIrradiance);float rescaling=averageIrradiance/max(0.000001,newIrradianceScale);irradiance=newIrradiance*rescaling;gl_FragColor=vec4(irradiance,1.);}";n.ShaderStore.ShadersStore[r]||(n.ShaderStore.ShadersStore[r]=a);var o={name:r,shader:a}},788(e,t,i){i.r(t),i.d(t,{fullscreenTriangleVertexShader:()=>o});var n=i(597),r=(i(554),i(684),"fullscreenTriangleVertexShader"),a="precision highp float;\n#include<__decl__atmosphereFragment>\n#if POSITION_VEC2\nattribute vec2 position;\n#else\nattribute vec3 position;\n#endif\nuniform float depth;varying vec2 uv;\n#if COMPUTE_WORLD_RAY\nvarying vec3 positionOnNearPlane;\n#endif\n#if COMPUTE_WORLD_RAY\nconst float nearPlaneNDC=-1.;\n#endif\nvoid main() {gl_Position=vec4(position.xy,depth,1.);uv=0.5*position.xy+vec2(0.5);\n#if COMPUTE_WORLD_RAY\npositionOnNearPlane=(inverseViewProjectionWithoutTranslation*vec4(position.xy,nearPlaneNDC,1.)).xyz;\n#endif\n}";n.ShaderStore.ShadersStore[r]||(n.ShaderStore.ShadersStore[r]=a);var o={name:r,shader:a}},264(e,t,i){i.r(t),i.d(t,{multiScatteringPixelShader:()=>o});var n=i(597),r=(i(554),i(684),i(415),"multiScatteringPixelShader"),a="#define RENDER_MULTI_SCATTERING\n#define COMPUTE_MULTI_SCATTERING\nprecision highp float;\n#include<__decl__atmosphereFragment>\nuniform sampler2D transmittanceLut;\n#include<helperFunctions>\n#include<atmosphereFunctions>\nvarying vec2 uv;void main() {gl_FragColor=renderMultiScattering(uv,transmittanceLut);}";n.ShaderStore.ShadersStore[r]||(n.ShaderStore.ShadersStore[r]=a);var o={name:r,shader:a}},429(e,t,i){i.r(t),i.d(t,{skyViewPixelShader:()=>o});var n=i(597),r=(i(554),i(684),i(415),"skyViewPixelShader"),a="#define RENDER_SKY_VIEW\nprecision highp float;precision highp sampler2D;\n#include<__decl__atmosphereFragment>\nuniform sampler2D transmittanceLut;uniform sampler2D multiScatteringLut;\n#include<helperFunctions>\n#include<atmosphereFunctions>\nvarying vec2 uv;void main() {gl_FragColor=renderSkyView(uv,transmittanceLut,multiScatteringLut);}";n.ShaderStore.ShadersStore[r]||(n.ShaderStore.ShadersStore[r]=a);var o={name:r,shader:a}},416(e,t,i){i.r(t),i.d(t,{transmittancePixelShader:()=>o});var n=i(597),r=(i(554),i(684),i(415),"transmittancePixelShader"),a="#define RENDER_TRANSMITTANCE\n#define EXCLUDE_RAY_MARCHING_FUNCTIONS\nprecision highp float;\n#include<__decl__atmosphereFragment>\n#include<helperFunctions>\n#include<atmosphereFunctions>\nvarying vec2 uv;void main() {gl_FragColor=renderTransmittance(uv);}";n.ShaderStore.ShadersStore[r]||(n.ShaderStore.ShadersStore[r]=a);var o={name:r,shader:a}},744(e,t,i){var n=i(597),r="atmosphereFunctions";n.ShaderStore.IncludesShadersStoreWGSL[r]||(n.ShaderStore.IncludesShadersStoreWGSL[r]="#include<intersectionFunctions>\nconst MultiScatteringLutSize=vec2f(32.,32.);const MultiScatteringLutDomainInUVSpace=(MultiScatteringLutSize-vec2f(1.))/MultiScatteringLutSize;const MultiScatteringLutHalfTexelSize=vec2f(.5)/MultiScatteringLutSize;const NumAerialPerspectiveLutLayers=32.;const AerialPerspectiveLutSize=vec3f(16.,64.,NumAerialPerspectiveLutLayers);const DiffuseSkyIrradianceLutSize=vec2f(64.,16.);const DiffuseSkyIrradianceLutDomainInUVSpace=(DiffuseSkyIrradianceLutSize-vec2f(1.))/DiffuseSkyIrradianceLutSize;const DiffuseSkyIrradianceLutHalfTexelSize=vec2f(.5)/DiffuseSkyIrradianceLutSize;const SkyViewLutSize=vec2f(128.,128.);const SkyViewLutDomainInUVSpace=(SkyViewLutSize-vec2f(1.))/SkyViewLutSize;const SkyViewLutHalfTexelSize=vec2f(.5)/SkyViewLutSize;const SkyViewLutSampleCount=30;const AerialPerspectiveLutKMPerSlice=4.;const AerialPerspectiveLutRangeKM=AerialPerspectiveLutKMPerSlice*NumAerialPerspectiveLutLayers;const TransmittanceSampleCount=128;const TransmittanceLutSize=vec2f(256.,64.);const TransmittanceLutDomainInUVSpace=(TransmittanceLutSize-vec2f(1.))/TransmittanceLutSize;const TransmittanceLutHalfTexelSize=vec2f(.5)/TransmittanceLutSize;const TransmittanceHorizonRange=2.*TransmittanceLutHalfTexelSize.x;const TransmittanceMaxUnoccludedU=1.-.5*TransmittanceHorizonRange;const TransmittanceMinOccludedU=1.+.5*TransmittanceHorizonRange;fn uvToUnit(uv: vec2f,domainInUVSpace: vec2f,halfTexelSize: vec2f)->vec2f {return (uv-halfTexelSize)/domainInUVSpace;}\nfn unitToUV(unit: vec2f,domainInUVSpace: vec2f,halfTexelSize: vec2f)->vec2f {return unit*domainInUVSpace+halfTexelSize;}\nfn sphereIntersectNearest(rayOrigin: vec3f,rayDirection: vec3f,sphereRadius: f32)->f32 {let result=sphereIntersectFromOrigin(rayOrigin,rayDirection,sphereRadius);let c=dot(rayOrigin,rayOrigin)-sphereRadius*sphereRadius;return select(result.x,result.y,c>=0.);}\nfn moveToTopAtmosphere(\ncameraPosition: vec3f,\npositionRadius: f32,\npositionGeocentricNormal: vec3f,\nrayDirection: vec3f,\nintersectsAtmosphere: ptr<function,bool>,\ncameraPositionClampedToTopOfAtmosphere: ptr<function,vec3f>\n) {*intersectsAtmosphere=true;*cameraPositionClampedToTopOfAtmosphere=cameraPosition;if (positionRadius>atmosphere.atmosphereRadius) {let tTop=sphereIntersectNearest(cameraPosition,rayDirection,atmosphere.atmosphereRadius);if (tTop>=0.) {let upOffset=-atmosphere.planetRadiusOffset*positionGeocentricNormal;*cameraPositionClampedToTopOfAtmosphere=cameraPosition+rayDirection*tTop+upOffset;} else {*intersectsAtmosphere=false;}}}\nfn getSkyViewUVFromParameters(\nintersectsGround: bool,\ncosHorizonAngleFromZenith: f32,\ncosAngleBetweenViewAndZenith: f32,\ncosAngleBetweenViewAndLightOnPlane: f32,\nuv: ptr<function,vec2f>\n) {var unit=vec2f(0.);if (intersectsGround) {var coord=(cosAngleBetweenViewAndZenith+1.)/(cosHorizonAngleFromZenith+1.);coord=sqrtClamped(coord); \nunit.y=.5*coord; } else {var coord=(cosAngleBetweenViewAndZenith-cosHorizonAngleFromZenith)/(1.-cosHorizonAngleFromZenith);coord=sqrtClamped(coord); \nunit.y=.5*coord+.5; }\nunit.x=.5-.5*cosAngleBetweenViewAndLightOnPlane;*uv=unitToUV(unit,SkyViewLutDomainInUVSpace,SkyViewLutHalfTexelSize);}\n#if USE_SKY_VIEW_LUT && SAMPLE_SKY_VIEW_LUT\nfn sampleSkyViewLut(\nskyViewLut: texture_2d<f32>,\npositionRadius: f32,\ngeocentricNormal: vec3f,\nrayDirection: vec3f,\ndirectionToLight: vec3f,\ncosHorizonAngleFromZenith: f32,\ncosAngleBetweenViewAndZenith: ptr<function,f32>,\nisRayIntersectingGround: ptr<function,bool>\n)->vec4f {*cosAngleBetweenViewAndZenith=dot(rayDirection,geocentricNormal);if (positionRadius>atmosphere.atmosphereRadius) {let sinAngleBetweenViewAndNadir=sqrtClamped(1.-*cosAngleBetweenViewAndZenith**cosAngleBetweenViewAndZenith);if (sinAngleBetweenViewAndNadir>atmosphere.sinCameraAtmosphereHorizonAngleFromNadir) {*isRayIntersectingGround=false;return vec4f(0.);}}\nlet sideVector=normalize(cross(geocentricNormal,rayDirection));let forwardVector=normalize(cross(sideVector,geocentricNormal));let lightOnPlane=normalize(vec2f(dot(directionToLight,forwardVector),dot(directionToLight,sideVector)));let cosAngleBetweenViewAndLightOnPlane=lightOnPlane.x;let rayIntersectionScale=mix(.95,1.,saturate((positionRadius-atmosphere.planetRadius)/atmosphere.atmosphereThickness));*isRayIntersectingGround =\npositionRadius>atmosphere.planetRadius &&\n(rayIntersectionScale**cosAngleBetweenViewAndZenith)<=cosHorizonAngleFromZenith;var uv: vec2f;getSkyViewUVFromParameters(\n*isRayIntersectingGround,\ncosHorizonAngleFromZenith,\n*cosAngleBetweenViewAndZenith,\ncosAngleBetweenViewAndLightOnPlane,\n&uv);return textureSampleLevel(skyViewLut,skyViewLutSampler,uv,0.);}\n#endif\nfn computeRayleighPhase(onePlusCosThetaSq: f32)->f32 {return 0.0596831037*onePlusCosThetaSq;}\nfn computeMiePhaseCornetteShanks(cosTheta: f32,onePlusCosThetaSq: f32)->f32 {const g=.8;const gSquared=g*g;const oneMinusGSquared=1.-gSquared;const onePlusGSquared=1.+gSquared;const twoPlusGSquared=2.+gSquared;const twoG=2.*g;const threeOverEightPi=3./(8.*PI);return threeOverEightPi*oneMinusGSquared*onePlusCosThetaSq/(twoPlusGSquared*pow(onePlusGSquared-twoG*cosTheta,1.5));}\nfn computeOzoneDensity(normalizedViewHeight: f32)->f32 {const MinOzoneDensity=.135;const OneMinusMinOzoneDensity=1.-MinOzoneDensity;const OzoneStartHeight=.15; \nconst PeakOzoneHeight=.25;const MaxOzoneHeight=.6;const InverseRampupDistance=1./(PeakOzoneHeight-OzoneStartHeight);const InverseRampdownDistance=1./(MaxOzoneHeight-PeakOzoneHeight);let lowerAtmosphereDensity=MinOzoneDensity+OneMinusMinOzoneDensity*max(0.,normalizedViewHeight-OzoneStartHeight)*InverseRampupDistance;let sqrtUpperAtmosphereDensity=max(0.,1.-(normalizedViewHeight-PeakOzoneHeight)*InverseRampdownDistance);let upperAtmosphereDensity=sqrtUpperAtmosphereDensity*sqrtUpperAtmosphereDensity;let densityOzone=select(upperAtmosphereDensity,lowerAtmosphereDensity,normalizedViewHeight<PeakOzoneHeight);return densityOzone;}\nfn sampleMediumRGB(\nviewHeight: f32,\nscatteringRayleigh: ptr<function,vec3f>,\nscatteringMie: ptr<function,vec3f>,\nextinction: ptr<function,vec3f>,\nscattering: ptr<function,vec3f>\n) {let normalizedViewHeight=saturate(viewHeight*atmosphere.inverseAtmosphereThickness);let densityMie=exp(-83.333*normalizedViewHeight);let densityRayleigh=exp(-12.5*normalizedViewHeight);let densityOzone=computeOzoneDensity(normalizedViewHeight);*scatteringRayleigh=densityRayleigh*atmosphere.peakRayleighScattering;*scatteringMie=densityMie*atmosphere.peakMieScattering;*scattering=*scatteringMie+*scatteringRayleigh;let extinctionRayleigh=*scatteringRayleigh;let extinctionMie=densityMie*atmosphere.peakMieExtinction;let extinctionOzone=densityOzone*atmosphere.peakOzoneAbsorption;*extinction=extinctionRayleigh+extinctionMie+extinctionOzone;}\nfn computeTransmittance(rayOriginGlobal: vec3f,rayDirection: vec3f,tMax: f32,sampleCount: i32)->vec3f {var opticalDepth=vec3f(0.);var t=0.;let sampleSegmentWeight=tMax/f32(sampleCount);const sampleSegmentT=.3;for (var s=0; s<sampleCount; s+=1) {let newT=sampleSegmentWeight*(f32(s)+sampleSegmentT);let dt=newT-t;t=newT;var scatteringRayleigh: vec3f;var scatteringMie: vec3f;var extinction: vec3f;var scattering: vec3f;let samplePositionGlobal=rayOriginGlobal+t*rayDirection;sampleMediumRGB(length(samplePositionGlobal)-atmosphere.planetRadius,&scatteringRayleigh,&scatteringMie,&extinction,&scattering);opticalDepth+=extinction*dt;}\nreturn exp(-opticalDepth);}\n#if defined(SAMPLE_TRANSMITTANCE_LUT) || !defined(EXCLUDE_RAY_MARCHING_FUNCTIONS)\nfn getTransmittanceUV(radius: f32,cosAngleLightToZenith: f32,distanceToHorizon: ptr<function,f32>)->vec2f {let radiusSquared=radius*radius;let horizonDistance=sqrtClamped(radiusSquared-atmosphere.planetRadiusSquared);*distanceToHorizon=horizonDistance;let cosAngleLightToZenithSquared=cosAngleLightToZenith*cosAngleLightToZenith;let discriminant=radiusSquared*(cosAngleLightToZenithSquared-1.)+atmosphere.atmosphereRadiusSquared;let distanceToAtmosphereEdge=max(0.,-radius*cosAngleLightToZenith+sqrtClamped(discriminant));let minDistanceToAtmosphereEdge=max(0.,atmosphere.atmosphereRadius-radius);let maxDistanceToAtmosphereEdge=horizonDistance+atmosphere.horizonDistanceToAtmosphereEdge;let cosAngleLightToZenithCoordinate=(distanceToAtmosphereEdge-minDistanceToAtmosphereEdge)/max(.000001,maxDistanceToAtmosphereEdge-minDistanceToAtmosphereEdge);let distanceToHorizonCoordinate=horizonDistance/max(.000001,atmosphere.horizonDistanceToAtmosphereEdge);let unit=vec2f(cosAngleLightToZenithCoordinate,distanceToHorizonCoordinate);return unit*TransmittanceLutDomainInUVSpace+TransmittanceLutHalfTexelSize; }\nfn sampleTransmittanceLut(transmittanceLut: texture_2d<f32>,positionRadius: f32,cosAngleLightToZenith: f32)->vec4f {var distanceToHorizon=0.;let uv=getTransmittanceUV(positionRadius,cosAngleLightToZenith,&distanceToHorizon);let weight=smoothstep(TransmittanceMinOccludedU,TransmittanceMaxUnoccludedU,uv.x);return weight*textureSampleLevel(transmittanceLut,transmittanceLutSampler,uv,0.);}\n#endif\n#ifndef EXCLUDE_RAY_MARCHING_FUNCTIONS\n#ifndef COMPUTE_MULTI_SCATTERING\nfn sampleMultiScatteringLut(multiScatteringLut: texture_2d<f32>,radius: f32,cosAngleLightToZenith: f32)->vec3f {let unit=vec2f(.5+.5*cosAngleLightToZenith,(radius-atmosphere.planetRadius)/atmosphere.atmosphereThickness);let uv=unitToUV(unit,MultiScatteringLutDomainInUVSpace,MultiScatteringLutHalfTexelSize);let multiScattering=textureSampleLevel(multiScatteringLut,multiScatteringLutSampler,uv,0.).rgb;return max(atmosphere.minMultiScattering,multiScattering);}\n#endif\nconst uniformPhase=RECIPROCAL_PI4;fn integrateScatteredRadiance(\nisAerialPerspectiveLut: bool,\nlightIntensityParam: f32,\ntransmittanceLut: texture_2d<f32>,\n#ifndef COMPUTE_MULTI_SCATTERING\nmultiScatteringLut: texture_2d<f32>,\nmultiScatteringIntensityParam: f32,\n#endif\nrayOriginGlobal: vec3f,\nrayDirection: vec3f,\ndirectionToLightParam: vec3f,\ntMaxMax: f32,\nsampleCount: i32,\ndistanceToSurface: f32,\ntransmittance: ptr<function,vec3f>\n#if COMPUTE_MULTI_SCATTERING\n,multiScattering: ptr<function,vec3f>\n#endif\n)->vec3f {var radiance=vec3f(0.);*transmittance=vec3f(1.);\n#if COMPUTE_MULTI_SCATTERING\n*multiScattering=vec3f(0.);\n#endif\nlet tBottom=sphereIntersectNearest(rayOriginGlobal,rayDirection,atmosphere.planetRadius);let tTop=sphereIntersectNearest(rayOriginGlobal,rayDirection,atmosphere.atmosphereRadius);var tMax=0.;if (tBottom<0.) {if (tTop<0.) {return radiance;} else {tMax=tTop;}} else {if (tTop>0.) {if (isAerialPerspectiveLut) {tMax=tTop;} else {tMax=min(tBottom,tTop);}}}\nif (distanceToSurface>0. && distanceToSurface<tMax) {tMax=distanceToSurface;}\ntMax=min(tMax,tMaxMax);\n#ifndef COMPUTE_MULTI_SCATTERING\nlet cosTheta=dot(rayDirection,directionToLightParam);let onePlusCosThetaSq=1.+cosTheta*cosTheta;let rayleighPhase=computeRayleighPhase(onePlusCosThetaSq);let miePhase=computeMiePhaseCornetteShanks(cosTheta,onePlusCosThetaSq);\n#endif\nlet transmittanceScale=select(1.,atmosphere.aerialPerspectiveTransmittanceScale,isAerialPerspectiveLut);var t=0.;let sampleSegmentWeight=tMax/f32(sampleCount);const sampleSegmentT=.3;for (var s=0; s<sampleCount; s+=1) {let newT=sampleSegmentWeight*(f32(s)+sampleSegmentT);let dt=newT-t;t=newT;let samplePositionGlobal=rayOriginGlobal+t*rayDirection;let sampleRadiusGlobal=length(samplePositionGlobal);let sampleGeocentricNormal=samplePositionGlobal/sampleRadiusGlobal;let sampleCosAngleLightToZenith=dot(directionToLightParam,sampleGeocentricNormal);var scatteringRayleigh: vec3f;var scatteringMie: vec3f;var extinction: vec3f;var scattering: vec3f;sampleMediumRGB(sampleRadiusGlobal-atmosphere.planetRadius,&scatteringRayleigh,&scatteringMie,&extinction,&scattering);let transmittanceToLight=sampleTransmittanceLut(transmittanceLut,sampleRadiusGlobal,sampleCosAngleLightToZenith).rgb;\n#if COMPUTE_MULTI_SCATTERING\nlet phaseTimesScattering=uniformPhase*scattering;let S=transmittanceToLight*phaseTimesScattering;\n#else\nlet phaseTimesScattering=scatteringMie*miePhase+scatteringRayleigh*rayleighPhase;let multiScatteredRadiance=sampleMultiScatteringLut(multiScatteringLut,sampleRadiusGlobal,sampleCosAngleLightToZenith);let S=transmittanceScale*transmittanceToLight*phaseTimesScattering+multiScatteringIntensityParam*multiScatteredRadiance*scattering;\n#endif\nlet sampleOpticalDepth=extinction*dt;let sampleTransmittanceVal=exp(-sampleOpticalDepth);let clampedExtinction=max(vec3f(.0000001),extinction);let SInt=(S-S*sampleTransmittanceVal)/clampedExtinction;radiance+=*transmittance*SInt;\n#if COMPUTE_MULTI_SCATTERING\nlet MSInt=(scattering-scattering*sampleTransmittanceVal)/clampedExtinction;*multiScattering+=*transmittance*MSInt;\n#endif\n*transmittance*=sampleTransmittanceVal;}\n#if USE_GROUND_ALBEDO\nif (tMax==tBottom && tBottom>0.) {let planetPos=rayOriginGlobal+tBottom*rayDirection;let planetPosRadius=length(planetPos);let planetPosGeocentricNormal=planetPos/planetPosRadius;let nDotL=dot(directionToLightParam,planetPosGeocentricNormal);let lightTransmittance=sampleTransmittanceLut(transmittanceLut,planetPosRadius,nDotL).rgb;const diffuseBrdf=RECIPROCAL_PI;radiance+=lightTransmittance**transmittance*atmosphere.groundAlbedo*(nDotL*diffuseBrdf);}\n#endif\nradiance*=lightIntensityParam;return radiance;}\n#endif\nfn layerIdxToAerialPerspectiveLayer(layerIdx: f32)->f32 {var layer=(layerIdx+1.)/NumAerialPerspectiveLutLayers;layer*=layer; \nlayer*=NumAerialPerspectiveLutLayers;return layer;}\nfn toAerialPerspectiveDepth(layer: f32)->f32 {return layer*AerialPerspectiveLutKMPerSlice;}\nfn toAerialPerspectiveLayer(distance: f32,aerialPerspectiveLutDistancePerSlice: f32)->f32 {return distance/aerialPerspectiveLutDistancePerSlice;}\nfn applyAerialPerspectiveSaturation(aerialPerspective: vec4f)->vec4f {let previousRadiance=getLuminance(aerialPerspective.rgb);let mixed=mix(vec3f(previousRadiance),aerialPerspective.rgb,atmosphere.aerialPerspectiveSaturation);return vec4f(mixed,aerialPerspective.a);}\nfn applyAerialPerspectiveIntensity(aerialPerspective: vec4f)->vec4f {var result=aerialPerspective;\n#if APPLY_AERIAL_PERSPECTIVE_INTENSITY\nif (atmosphere.aerialPerspectiveIntensity==0.) {result=vec4f(0.);} else {let previousAlpha=result.a;result=result/max(.00001,previousAlpha);result=result*pow(previousAlpha,1./atmosphere.aerialPerspectiveIntensity);}\n#endif\nreturn result;}\nfn applyAerialPerspectiveRadianceBias(aerialPerspective: vec4f)->vec4f {var result=aerialPerspective;\n#if APPLY_AERIAL_PERSPECTIVE_RADIANCE_BIAS\nlet originalRadiance=dot(result.rgb,LuminanceEncodeApprox);let targetRadiance=originalRadiance+atmosphere.aerialPerspectiveRadianceBias;if (originalRadiance>0.) {result=result*max(0.,targetRadiance/originalRadiance);} else {result=max(vec4f(0.),vec4f(atmosphere.aerialPerspectiveRadianceBias));}\nresult.a=min(result.a,1.);\n#endif\nreturn result;}\nfn sampleAerialPerspectiveLut(\nscreenUV: vec2f,\nclampToLutRange: bool,\ndistanceFromCamera: f32,\nnumAerialPerspectiveLutLayers: f32,\naerialPerspectiveLutKMPerSlice: f32,\naerialPerspectiveLutRangeKM: f32,\naerialPerspective: ptr<function,vec4f>\n)->bool {*aerialPerspective=vec4f(0.);\n#if USE_AERIAL_PERSPECTIVE_LUT\nif (distanceFromCamera>0. &&\n(clampToLutRange || distanceFromCamera<aerialPerspectiveLutRangeKM) &&\natmosphere.clampedCameraRadius<=atmosphere.atmosphereRadius) {var layer=toAerialPerspectiveLayer(distanceFromCamera,aerialPerspectiveLutKMPerSlice);let normalizedLayer=sqrt(layer/numAerialPerspectiveLutLayers); \nlayer=min(normalizedLayer*numAerialPerspectiveLutLayers,numAerialPerspectiveLutLayers);let weight=min(layer,1.);let layerIdx=max(0.,layer-1.);let floorLayerIdx=floor(layerIdx);let aerialPerspectiveLayer0=textureSampleLevel(aerialPerspectiveLut,aerialPerspectiveLutSampler,screenUV,i32(floorLayerIdx),0.);let aerialPerspectiveLayer1=textureSampleLevel(aerialPerspectiveLut,aerialPerspectiveLutSampler,screenUV,i32(floorLayerIdx+1.),0.);var interpolated=mix(aerialPerspectiveLayer0,aerialPerspectiveLayer1,layerIdx-floorLayerIdx);interpolated=vec4f(interpolated.rgb*atmosphere.atmosphereExposure,interpolated.a);interpolated=applyAerialPerspectiveSaturation(interpolated);interpolated=weight*applyAerialPerspectiveIntensity(interpolated);interpolated=applyAerialPerspectiveRadianceBias(interpolated);*aerialPerspective=interpolated;return true;}\n#endif\nreturn false;}\n#if RENDER_TRANSMITTANCE\nfn getTransmittanceParameters(uv: vec2f,radius: ptr<function,f32>,cosAngleLightToZenith: ptr<function,f32>,distanceToAtmosphereEdge: ptr<function,f32>) {let unit=uvToUnit(uv,TransmittanceLutDomainInUVSpace,TransmittanceLutHalfTexelSize);let distanceToHorizon=unit.y*atmosphere.horizonDistanceToAtmosphereEdge;let distanceToHorizonSquared=distanceToHorizon*distanceToHorizon;*radius=sqrtClamped(distanceToHorizonSquared+atmosphere.planetRadiusSquared);let minDistanceToAtmosphereEdge=atmosphere.atmosphereRadius-*radius;let maxDistanceToAtmosphereEdge=distanceToHorizon+atmosphere.horizonDistanceToAtmosphereEdge;*distanceToAtmosphereEdge=minDistanceToAtmosphereEdge+unit.x*(maxDistanceToAtmosphereEdge-minDistanceToAtmosphereEdge);let distanceToAtmosphereEdgeSquared=*distanceToAtmosphereEdge**distanceToAtmosphereEdge;*cosAngleLightToZenith=select(\n(atmosphere.horizonDistanceToAtmosphereEdgeSquared-distanceToAtmosphereEdgeSquared-distanceToHorizonSquared)/(2.**radius**distanceToAtmosphereEdge),\n1.,\n*distanceToAtmosphereEdge<=0.\n);*cosAngleLightToZenith=clamp(*cosAngleLightToZenith,-1.,1.);}\nfn renderTransmittance(uv: vec2f)->vec4f {var radius: f32;var cosAngleLightToZenith: f32;var distanceToAtmosphereEdgeAlongAngle: f32;getTransmittanceParameters(uv,&radius,&cosAngleLightToZenith,&distanceToAtmosphereEdgeAlongAngle);let sinAngleLightToZenith=sqrtClamped(1.-cosAngleLightToZenith*cosAngleLightToZenith);let directionToLight=normalize(vec3f(0.,cosAngleLightToZenith,sinAngleLightToZenith));let transmittance=computeTransmittance(vec3f(0.,radius,0.),directionToLight,distanceToAtmosphereEdgeAlongAngle,TransmittanceSampleCount);return vec4f(transmittance,avg(transmittance));}\n#endif\n#if RENDER_MULTI_SCATTERING\nfn getSphereSample(azimuth: f32,inclination: f32,sinInclination: ptr<function,f32>)->vec3f {*sinInclination=sin(inclination);return vec3f(*sinInclination*sin(azimuth),cos(inclination),*sinInclination*cos(azimuth));}\nconst MultiScatteringInclinationSampleCount=8.;const MultiScatteringAzimuthSampleCount=2.*MultiScatteringInclinationSampleCount;const MultiScatteringSampleCount=64;const MultiScatteringAzimuthIterationAngle=TWO_PI/MultiScatteringAzimuthSampleCount;const MultiScatteringInclinationIterationAngle=PI/MultiScatteringInclinationSampleCount;const MultiScatteringAngleStepProduct=MultiScatteringAzimuthIterationAngle*MultiScatteringInclinationIterationAngle;fn renderMultiScattering(uv: vec2f,transmittanceLut: texture_2d<f32>)->vec4f {let unit=uvToUnit(uv,MultiScatteringLutDomainInUVSpace,MultiScatteringLutHalfTexelSize);let cosAngleLightToZenith=2.*unit.x-1.;let sinAngleLightToZenith=sqrtClamped(1.-cosAngleLightToZenith*cosAngleLightToZenith);let directionToLightLocal=normalize(vec3f(0.,cosAngleLightToZenith,sinAngleLightToZenith));let rayOriginRadius=atmosphere.planetRadius+max(unit.y,.001)*atmosphere.atmosphereThickness;let rayOrigin=vec3f(0.,rayOriginRadius,0.);var inscattered=vec3f(0.);var multiScatteringTotal=vec3f(0.);for (var i=.5; i<MultiScatteringAzimuthSampleCount; i+=1.) {let azimuth=MultiScatteringAzimuthIterationAngle*i;for (var j=.5; j<MultiScatteringInclinationSampleCount; j+=1.) {let inclination=MultiScatteringInclinationIterationAngle*j;var sinInclination: f32;let rayDirection=getSphereSample(azimuth,inclination,&sinInclination);var transmittanceVal: vec3f;var multiScatteringVal: vec3f;let radianceVal=integrateScatteredRadiance(\nfalse,\n1.,\ntransmittanceLut,\nrayOrigin,\nrayDirection,\ndirectionToLightLocal,\n100000000.,\nMultiScatteringSampleCount,\n-1.,\n&transmittanceVal,\n&multiScatteringVal);let weight=RECIPROCAL_PI4*abs(sinInclination)*MultiScatteringAngleStepProduct;multiScatteringTotal+=multiScatteringVal*weight;inscattered+=radianceVal*weight;}}\nlet multiScatteringResult=inscattered/max(vec3f(.000001),vec3f(1.)-multiScatteringTotal);return vec4f(multiScatteringResult,1.);}\n#endif\nfn computeCosHorizonAngleFromZenith(radius: f32)->f32 {let sinAngleBetweenHorizonAndNadir=min(1.,atmosphere.planetRadius/radius);let cosHorizonAngleFromNadir=sqrt(1.-sinAngleBetweenHorizonAndNadir*sinAngleBetweenHorizonAndNadir);let cosHorizonAngleFromZenith=-cosHorizonAngleFromNadir;return cosHorizonAngleFromZenith;}\n#if RENDER_SKY_VIEW\nfn getSkyViewParametersFromUV(\nradius: f32,\nuv: vec2f,\ncosAngleBetweenViewAndZenith: ptr<function,f32>,\ncosAngleBetweenViewAndLightOnPlane: ptr<function,f32>\n) {let unit=uvToUnit(uv,SkyViewLutDomainInUVSpace,SkyViewLutHalfTexelSize);let cosHorizonAngleFromZenith=computeCosHorizonAngleFromZenith(radius);if (unit.y<.5) {var coord=2.*unit.y; \ncoord*=coord; \n*cosAngleBetweenViewAndZenith=mix(-1.,cosHorizonAngleFromZenith,coord); } else {var coord=2.*unit.y-1.; \ncoord*=coord; \n*cosAngleBetweenViewAndZenith=mix(cosHorizonAngleFromZenith,1.,coord); }\n*cosAngleBetweenViewAndLightOnPlane=1.-2.*unit.x;}\nfn renderSkyView(uv: vec2f,transmittanceLut: texture_2d<f32>,multiScatteringLut: texture_2d<f32>)->vec4f {var cosAngleBetweenViewAndZenith: f32;var cosAngleBetweenViewAndLightOnPlane: f32;getSkyViewParametersFromUV(atmosphere.clampedCameraRadius,uv,&cosAngleBetweenViewAndZenith,&cosAngleBetweenViewAndLightOnPlane);let sinAngleBetweenViewAndZenith=sqrtClamped(1.-cosAngleBetweenViewAndZenith*cosAngleBetweenViewAndZenith);let sinAngleBetweenViewAndLightOnPlane=sqrtClamped(1.-cosAngleBetweenViewAndLightOnPlane*cosAngleBetweenViewAndLightOnPlane);let rayDirection =\nvec3f(\nsinAngleBetweenViewAndZenith*cosAngleBetweenViewAndLightOnPlane,\ncosAngleBetweenViewAndZenith,\nsinAngleBetweenViewAndZenith*sinAngleBetweenViewAndLightOnPlane);var intersectsAtmosphere=false;var cameraPositionGlobalClampedToTopOfAtmosphere=vec3f(0.);moveToTopAtmosphere(\nvec3f(0.,atmosphere.clampedCameraRadius,0.),\natmosphere.clampedCameraRadius,\nvec3f(0.,1.,0.),\nrayDirection,\n&intersectsAtmosphere,\n&cameraPositionGlobalClampedToTopOfAtmosphere\n);if (!intersectsAtmosphere) {return vec4f(0.);}\nvar transmittanceVal: vec3f;let radiance=integrateScatteredRadiance(\nfalse,\natmosphere.atmosphereExposure*atmosphere.lightIntensity,\ntransmittanceLut,\nmultiScatteringLut,\natmosphere.multiScatteringIntensity,\ncameraPositionGlobalClampedToTopOfAtmosphere,\nrayDirection,\natmosphere.directionToLightRelativeToCameraGeocentricNormal,\n100000000.,\nSkyViewLutSampleCount,\n-1.,\n&transmittanceVal\n);let transparency=1.-avg(transmittanceVal);return vec4f(radiance,transparency);}\n#endif\n#if RENDER_CAMERA_VOLUME\nfn renderCameraVolume(\npositionOnNearPlane: vec3f,\nlayerIdx: f32,\ntransmittanceLut: texture_2d<f32>,\nmultiScatteringLut: texture_2d<f32>\n)->vec4f {var result=vec4f(0.);let rayDirection=normalize(positionOnNearPlane);let layer=layerIdxToAerialPerspectiveLayer(layerIdx);let tMax=toAerialPerspectiveDepth(layer);var tMaxMax=tMax;var cameraPositionGlobalClampedToTopOfAtmosphere=atmosphere.clampedCameraPositionGlobal;if (atmosphere.clampedCameraRadius>=atmosphere.atmosphereRadius) {var intersectsAtmosphere=false;moveToTopAtmosphere(\natmosphere.clampedCameraPositionGlobal,\natmosphere.clampedCameraRadius,\natmosphere.cameraGeocentricNormal,\nrayDirection,\n&intersectsAtmosphere,\n&cameraPositionGlobalClampedToTopOfAtmosphere);if (!intersectsAtmosphere) {return result;}\nlet distanceToAtmosphere=distance(atmosphere.clampedCameraPositionGlobal,cameraPositionGlobalClampedToTopOfAtmosphere);if (tMaxMax<distanceToAtmosphere) {return result;}\ntMaxMax=max(0.,tMaxMax-distanceToAtmosphere);}\nlet sampleCount=i32(min(SkyViewLutSampleCount,2.*layer+2.));var transmittance: vec3f;let radiance=integrateScatteredRadiance(\ntrue,\natmosphere.lightIntensity,\ntransmittanceLut,\nmultiScatteringLut,\natmosphere.multiScatteringIntensity,\ncameraPositionGlobalClampedToTopOfAtmosphere,\nrayDirection,\natmosphere.directionToLight,\ntMaxMax,\nsampleCount,\n-1.,\n&transmittance);let transparency=1.-avg(transmittance);result=vec4f(radiance,transparency);return result;}\n#endif\n")},621(e,t,i){var n=i(597),r="atmosphereUboDeclaration";n.ShaderStore.IncludesShadersStoreWGSL[r]||(n.ShaderStore.IncludesShadersStoreWGSL[r]="struct Atmosphere {peakRayleighScattering: vec3<f32>,\nplanetRadius: f32,\npeakMieScattering: vec3<f32>,\natmosphereThickness: f32,\npeakMieAbsorption: vec3<f32>,\nplanetRadiusSquared: f32,\npeakMieExtinction: vec3<f32>,\natmosphereRadius: f32,\npeakOzoneAbsorption: vec3<f32>,\natmosphereRadiusSquared: f32,\nhorizonDistanceToAtmosphereEdge: f32,\nhorizonDistanceToAtmosphereEdgeSquared: f32,\nplanetRadiusWithOffset: f32,\nplanetRadiusOffset: f32,\natmosphereExposure: f32,\naerialPerspectiveRadianceBias: f32,\ninverseAtmosphereThickness: f32,\naerialPerspectiveTransmittanceScale: f32,\ninverseViewProjectionWithoutTranslation: mat4x4<f32>,\ndirectionToLight: vec3<f32>,\nmultiScatteringIntensity: f32,\ndirectionToLightRelativeToCameraGeocentricNormal: vec3<f32>,\ncameraRadius: f32,\nlightRadianceAtCamera: vec3<f32>,\ndiffuseSkyIrradianceDesaturationFactor: f32,\ngroundAlbedo: vec3<f32>,\naerialPerspectiveSaturation: f32,\nminMultiScattering: vec3<f32>,\ndiffuseSkyIrradianceIntensity: f32,\ncameraPositionGlobal: vec3<f32>,\nlightIntensity: f32,\nclampedCameraPositionGlobal: vec3<f32>,\naerialPerspectiveIntensity: f32,\ncameraGeocentricNormal: vec3<f32>,\nclampedCameraRadius: f32,\ncameraForward: vec3<f32>,\nclampedCameraHeight: f32,\ncameraPosition: vec3<f32>,\ncosCameraHorizonAngleFromZenith: f32,\nviewport: vec4<f32>,\nadditionalDiffuseSkyIrradiance: vec3<f32>,\ncameraHeight: f32,\ncameraNearPlane: f32,\noriginHeight: f32,\nsinCameraAtmosphereHorizonAngleFromNadir: f32};var<uniform> atmosphere : Atmosphere;\n")},796(e,t,i){var n=i(597),r="depthFunctions";n.ShaderStore.IncludesShadersStoreWGSL[r]||(n.ShaderStore.IncludesShadersStoreWGSL[r]="fn reconstructDistanceFromCameraPlane(depth: f32,cameraNearPlane: f32)->f32 {return cameraNearPlane/(1.-depth);}\nfn sampleDistanceFromCameraPlane(depthTex: texture_2d<f32>,depthSampler: sampler,uv: vec2f,cameraNearPlane: f32)->f32 {let depth=textureSampleLevel(depthTex,depthSampler,uv,0.).r;return select(reconstructDistanceFromCameraPlane(depth,cameraNearPlane),0.,depth>=1.);}\nfn reconstructDistanceFromCamera(depth: f32,cameraRayDirection: vec3f,cameraForward: vec3f,cameraNearPlane: f32)->f32 {let distanceFromCameraPlane=reconstructDistanceFromCameraPlane(depth,cameraNearPlane);return distanceFromCameraPlane/max(.00001,dot(cameraForward,cameraRayDirection));}\nfn reconstructDistanceFromCameraWithTexture(\ndepthTex: texture_2d<f32>,\ndepthSampler: sampler,\nuv: vec2f,\ncameraRayDirection: vec3f,\ncameraForward: vec3f,\ncameraNearPlane: f32)->f32 {let depth=textureSampleLevel(depthTex,depthSampler,uv,0.).r;return select(reconstructDistanceFromCamera(depth,cameraRayDirection,cameraForward,cameraNearPlane),0.,depth>=1.);}\n")},862(e,t,i){i.r(t),i.d(t,{aerialPerspectivePixelShaderWGSL:()=>o});var n=i(597),r=(i(621),i(744),"aerialPerspectivePixelShader"),a="#define RENDER_CAMERA_VOLUME\n#include<atmosphereUboDeclaration>\nvar transmittanceLutSampler: sampler;var transmittanceLut: texture_2d<f32>;var multiScatteringLutSampler: sampler;var multiScatteringLut: texture_2d<f32>;\n#include<helperFunctions>\n#include<atmosphereFunctions>\nvarying positionOnNearPlane: vec3f;uniform layerIdx: f32;@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=renderCameraVolume(\ninput.positionOnNearPlane,\nuniforms.layerIdx,\ntransmittanceLut,\nmultiScatteringLut\n);}\n";n.ShaderStore.ShadersStoreWGSL[r]||(n.ShaderStore.ShadersStoreWGSL[r]=a);var o={name:r,shader:a}},967(e,t,i){i.r(t),i.d(t,{compositeAerialPerspectivePixelShaderWGSL:()=>o});var n=i(597),r=(i(621),i(796),i(744),"compositeAerialPerspectivePixelShader"),a="#include<atmosphereUboDeclaration>\n#if USE_AERIAL_PERSPECTIVE_LUT\nvar aerialPerspectiveLutSampler: sampler;var aerialPerspectiveLut: texture_2d_array<f32>;\n#endif\nvar depthTextureSampler: sampler;var depthTexture: texture_2d<f32>;var transmittanceLutSampler: sampler;var transmittanceLut: texture_2d<f32>;var multiScatteringLutSampler: sampler;var multiScatteringLut: texture_2d<f32>;\n#include<helperFunctions>\n#include<depthFunctions>\n#include<atmosphereFunctions>\nvarying vUV: vec2f;varying positionOnNearPlane: vec3f;@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=vec4f(0.);let depth=textureSampleLevel(depthTexture,depthTextureSampler,input.vUV,0.).r;if (depth>=1.) {discard;}\nlet rayDirection=normalize(input.positionOnNearPlane);let distanceFromCamera =\nreconstructDistanceFromCamera(\ndepth,\nrayDirection,\natmosphere.cameraForward,\natmosphere.cameraNearPlane);let distanceToSurface=distanceFromCamera/1000.;var aerialPerspective=vec4f(0.);if (sampleAerialPerspectiveLut(\ninput.vUV,\nfalse,\ndistanceToSurface,\nNumAerialPerspectiveLutLayers,\nAerialPerspectiveLutKMPerSlice,\nAerialPerspectiveLutRangeKM,\n&aerialPerspective)) {\n#ifndef APPLY_TRANSMITTANCE_BLENDING\naerialPerspective=vec4f(aerialPerspective.rgb,0.);\n#endif\nfragmentOutputs.color=aerialPerspective;} else {var intersectsAtmosphere=false;var cameraPositionGlobalClampedToTopOfAtmosphere=vec3f(0.);moveToTopAtmosphere(\natmosphere.clampedCameraPositionGlobal,\natmosphere.clampedCameraRadius,\natmosphere.cameraGeocentricNormal,\nrayDirection,\n&intersectsAtmosphere,\n&cameraPositionGlobalClampedToTopOfAtmosphere);if (!intersectsAtmosphere) {fragmentOutputs.color=vec4f(0.);return fragmentOutputs;}\nlet isAerialPerspectiveLut=atmosphere.clampedCameraRadius<atmosphere.atmosphereRadius;var transmittance: vec3f;let radiance=integrateScatteredRadiance(\nisAerialPerspectiveLut,\natmosphere.atmosphereExposure*atmosphere.lightIntensity,\ntransmittanceLut,\nmultiScatteringLut,\natmosphere.multiScatteringIntensity,\ncameraPositionGlobalClampedToTopOfAtmosphere,\nrayDirection,\natmosphere.directionToLight,\n100000000.,\nSkyViewLutSampleCount,\ndistanceToSurface,\n&transmittance);let transparency=1.-avg(transmittance);fragmentOutputs.color =\napplyAerialPerspectiveRadianceBias(\napplyAerialPerspectiveIntensity(\napplyAerialPerspectiveSaturation(vec4f(radiance,transparency))));\n#ifndef APPLY_TRANSMITTANCE_BLENDING\nfragmentOutputs.color=vec4f(fragmentOutputs.color.rgb,0.);\n#endif\n}\n#if OUTPUT_TO_SRGB\nfragmentOutputs.color=toGammaSpace(fragmentOutputs.color);\n#endif\n}\n";n.ShaderStore.ShadersStoreWGSL[r]||(n.ShaderStore.ShadersStoreWGSL[r]=a);var o={name:r,shader:a}},776(e,t,i){i.r(t),i.d(t,{compositeGlobeAtmospherePixelShaderWGSL:()=>o});var n=i(597),r=(i(621),i(796),i(744),"compositeGlobeAtmospherePixelShader"),a="#define SAMPLE_SKY_VIEW_LUT\n#if USE_SKY_VIEW_LUT\n#define EXCLUDE_RAY_MARCHING_FUNCTIONS\n#endif\n#include<atmosphereUboDeclaration>\n#if HAS_DEPTH_TEXTURE\nvar depthTextureSampler: sampler;var depthTexture: texture_2d<f32>;\n#endif\n#if USE_SKY_VIEW_LUT\nvar skyViewLutSampler: sampler;var skyViewLut: texture_2d<f32>;\n#else\nvar transmittanceLutSampler: sampler;var transmittanceLut: texture_2d<f32>;var multiScatteringLutSampler: sampler;var multiScatteringLut: texture_2d<f32>;\n#endif\n#include<helperFunctions>\n#include<depthFunctions>\n#include<atmosphereFunctions>\nvarying vUV: vec2f;varying positionOnNearPlane: vec3f;@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=vec4f(0.);\n#if HAS_DEPTH_TEXTURE\nlet depth=textureSampleLevel(depthTexture,depthTextureSampler,input.vUV,0.).r;\n#endif\nlet rayDirection=normalize(input.positionOnNearPlane);\n#if USE_SKY_VIEW_LUT\nvar cosAngleBetweenViewAndZenith: f32;var isRayIntersectingGround: bool;var skyColor=sampleSkyViewLut(\nskyViewLut,\natmosphere.clampedCameraRadius,\natmosphere.cameraGeocentricNormal,\nrayDirection,\natmosphere.directionToLight,\natmosphere.cosCameraHorizonAngleFromZenith,\n&cosAngleBetweenViewAndZenith,\n&isRayIntersectingGround);fragmentOutputs.color=skyColor;if (isRayIntersectingGround) {fragmentOutputs.color =\napplyAerialPerspectiveRadianceBias(\napplyAerialPerspectiveIntensity(\napplyAerialPerspectiveSaturation(fragmentOutputs.color)));\n#if HAS_DEPTH_TEXTURE\nfragmentOutputs.color=vec4f(fragmentOutputs.color.rgb,select(fragmentOutputs.color.a,1.,depth>=1.));\n#endif\n}\n#else\nvar intersectsAtmosphere=false;var cameraPositionGlobalClampedToTopOfAtmosphere=vec3f(0.);moveToTopAtmosphere(\natmosphere.clampedCameraPositionGlobal,\natmosphere.clampedCameraRadius,\natmosphere.cameraGeocentricNormal,\nrayDirection,\n&intersectsAtmosphere,\n&cameraPositionGlobalClampedToTopOfAtmosphere);if (!intersectsAtmosphere) {return fragmentOutputs;}\n#if HAS_DEPTH_TEXTURE\nlet distanceFromCamera =\nreconstructDistanceFromCamera(\ndepth,\nrayDirection,\natmosphere.cameraForward,\natmosphere.cameraNearPlane);let distanceToSurface=distanceFromCamera/1000.;\n#else\nlet distanceToSurface=0.;\n#endif\nvar transmittance: vec3f;let radiance=integrateScatteredRadiance(\nfalse,\natmosphere.atmosphereExposure*atmosphere.lightIntensity,\ntransmittanceLut,\nmultiScatteringLut,\natmosphere.multiScatteringIntensity,\ncameraPositionGlobalClampedToTopOfAtmosphere,\nrayDirection,\natmosphere.directionToLight,\n100000000.,\nSkyViewLutSampleCount,\ndistanceToSurface,\n&transmittance);let transparency=1.-avg(transmittance);fragmentOutputs.color=vec4f(radiance,transparency);if (distanceToSurface>0.) {fragmentOutputs.color =\napplyAerialPerspectiveRadianceBias(\napplyAerialPerspectiveIntensity(\napplyAerialPerspectiveSaturation(fragmentOutputs.color)));\n#if HAS_DEPTH_TEXTURE\nfragmentOutputs.color=vec4f(fragmentOutputs.color.rgb,select(fragmentOutputs.color.a,1.,depth>=1.));\n#endif\n}\n#endif\n#if OUTPUT_TO_SRGB\nfragmentOutputs.color=toGammaSpace(fragmentOutputs.color);\n#endif\n}\n";n.ShaderStore.ShadersStoreWGSL[r]||(n.ShaderStore.ShadersStoreWGSL[r]=a);var o={name:r,shader:a}},936(e,t,i){i.r(t),i.d(t,{compositeSkyPixelShaderWGSL:()=>o});var n=i(597),r=(i(621),i(744),"compositeSkyPixelShader"),a="#define SAMPLE_SKY_VIEW_LUT\n#if USE_SKY_VIEW_LUT\n#define EXCLUDE_RAY_MARCHING_FUNCTIONS\n#endif\n#include<atmosphereUboDeclaration>\n#if USE_SKY_VIEW_LUT\nvar skyViewLutSampler: sampler;var skyViewLut: texture_2d<f32>;\n#else\nvar transmittanceLutSampler: sampler;var transmittanceLut: texture_2d<f32>;var multiScatteringLutSampler: sampler;var multiScatteringLut: texture_2d<f32>;\n#endif\n#include<helperFunctions>\n#include<atmosphereFunctions>\nvarying vUV: vec2f;varying positionOnNearPlane: vec3f;@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=vec4f(0.);let rayDirection=normalize(input.positionOnNearPlane);\n#if USE_SKY_VIEW_LUT\nvar cosAngleBetweenViewAndZenith: f32;var isRayIntersectingGround: bool;var skyColor=sampleSkyViewLut(\nskyViewLut,\natmosphere.clampedCameraRadius,\natmosphere.cameraGeocentricNormal,\nrayDirection,\natmosphere.directionToLight,\natmosphere.cosCameraHorizonAngleFromZenith,\n&cosAngleBetweenViewAndZenith,\n&isRayIntersectingGround);\n#ifndef APPLY_TRANSMITTANCE_BLENDING\nskyColor=vec4f(skyColor.rgb,0.);\n#endif\nfragmentOutputs.color=skyColor;fragmentOutputs.color=vec4f(fragmentOutputs.color.rgb,select(fragmentOutputs.color.a,1.,isRayIntersectingGround));\n#else\nvar intersectsAtmosphere=false;var cameraPositionGlobalClampedToTopOfAtmosphere=vec3f(0.);moveToTopAtmosphere(\natmosphere.clampedCameraPositionGlobal,\natmosphere.clampedCameraRadius,\natmosphere.cameraGeocentricNormal,\nrayDirection,\n&intersectsAtmosphere,\n&cameraPositionGlobalClampedToTopOfAtmosphere);if (!intersectsAtmosphere) {return fragmentOutputs;}\nvar transmittance: vec3f;let radiance=integrateScatteredRadiance(\nfalse,\natmosphere.atmosphereExposure*atmosphere.lightIntensity,\ntransmittanceLut,\nmultiScatteringLut,\natmosphere.multiScatteringIntensity,\ncameraPositionGlobalClampedToTopOfAtmosphere,\nrayDirection,\natmosphere.directionToLight,\n100000000.,\nSkyViewLutSampleCount,\n-1.,\n&transmittance);\n#if APPLY_TRANSMITTANCE_BLENDING\nlet transparency=1.-avg(transmittance);\n#else\nlet transparency=0.;\n#endif\nfragmentOutputs.color=vec4f(radiance,transparency);\n#endif\n#if OUTPUT_TO_SRGB\nfragmentOutputs.color=toGammaSpace(fragmentOutputs.color);\n#endif\n}\n";n.ShaderStore.ShadersStoreWGSL[r]||(n.ShaderStore.ShadersStoreWGSL[r]=a);var o={name:r,shader:a}},179(e,t,i){i.r(t),i.d(t,{diffuseSkyIrradiancePixelShaderWGSL:()=>o});var n=i(597),r=(i(621),i(744),"diffuseSkyIrradiancePixelShader"),a="const DiffuseSkyIrradianceLutSampleCount=32;\n#include<atmosphereUboDeclaration>\nvar transmittanceLutSampler: sampler;var transmittanceLut: texture_2d<f32>;var multiScatteringLutSampler: sampler;var multiScatteringLut: texture_2d<f32>;\n#include<helperFunctions>\n#include<atmosphereFunctions>\nfn integrateForIrradiance(directionToLightParam: vec3f,rayDirection: vec3f,rayOrigin: vec3f)->vec3f {var transmittance: vec3f;let radiance=integrateScatteredRadiance(\nfalse,\n1.,\ntransmittanceLut,\nmultiScatteringLut,\natmosphere.multiScatteringIntensity,\nrayOrigin,\nrayDirection.xzy,\ndirectionToLightParam.xzy,\n100000000.,\nDiffuseSkyIrradianceLutSampleCount,\n-1.,\n&transmittance);return radiance;}\n#include<importanceSampling>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\nvarying vUV: vec2f;@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {let unit=uvToUnit(input.vUV,DiffuseSkyIrradianceLutDomainInUVSpace,DiffuseSkyIrradianceLutHalfTexelSize);let cosLightInclination=2.*unit.x-1.;let sinLightInclination=sqrtClamped(1.-cosLightInclination*cosLightInclination);let directionToLight=normalize(vec3f(0.,cosLightInclination,sinLightInclination));let radius=max(atmosphere.planetRadiusWithOffset,unit.y*atmosphere.atmosphereThickness+atmosphere.planetRadius);let swappedDirectionToLight=vec3f(directionToLight.x,directionToLight.z,directionToLight.y); \nvar irradianceResult=PI*irradiance(\nswappedDirectionToLight,\nvec2f(radius,0.),\n1.,\nvec3f(1.),\nvec3f(1.));let averageIrradiance=getLuminance(irradianceResult);let newIrradiance=mix(irradianceResult,vec3f(averageIrradiance),atmosphere.diffuseSkyIrradianceDesaturationFactor);let newIrradianceScale=getLuminance(newIrradiance);let rescaling=averageIrradiance/max(0.000001,newIrradianceScale);irradianceResult=newIrradiance*rescaling;fragmentOutputs.color=vec4f(irradianceResult,1.);}\n";n.ShaderStore.ShadersStoreWGSL[r]||(n.ShaderStore.ShadersStoreWGSL[r]=a);var o={name:r,shader:a}},321(e,t,i){i.r(t),i.d(t,{fullscreenTriangleVertexShaderWGSL:()=>o});var n=i(597),r=(i(621),"fullscreenTriangleVertexShader"),a="#include<atmosphereUboDeclaration>\n#if POSITION_VEC2\nattribute position: vec2f;\n#else\nattribute position: vec3f;\n#endif\nuniform depth: f32;varying vUV: vec2f;\n#if COMPUTE_WORLD_RAY\nvarying positionOnNearPlane: vec3f;\n#endif\n#if COMPUTE_WORLD_RAY\nconst nearPlaneNDC: f32=-1.0;\n#endif\n@vertex\nfn main(input: VertexInputs)->FragmentInputs {vertexOutputs.position=vec4f(input.position.xy,uniforms.depth,1.0);vertexOutputs.vUV=input.position.xy*vec2f(0.5,0.5)+vec2f(0.5,0.5);\n#if COMPUTE_WORLD_RAY\nvertexOutputs.positionOnNearPlane=(atmosphere.inverseViewProjectionWithoutTranslation*vec4f(input.position.xy,nearPlaneNDC,1.0)).xyz;\n#endif\n}\n";n.ShaderStore.ShadersStoreWGSL[r]||(n.ShaderStore.ShadersStoreWGSL[r]=a);var o={name:r,shader:a}},255(e,t,i){i.r(t),i.d(t,{multiScatteringPixelShaderWGSL:()=>o});var n=i(597),r=(i(621),i(744),"multiScatteringPixelShader"),a="#define RENDER_MULTI_SCATTERING\n#define COMPUTE_MULTI_SCATTERING\n#include<atmosphereUboDeclaration>\nvar transmittanceLutSampler: sampler;var transmittanceLut: texture_2d<f32>;\n#include<helperFunctions>\n#include<atmosphereFunctions>\nvarying vUV: vec2f;@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=renderMultiScattering(input.vUV,transmittanceLut);}\n";n.ShaderStore.ShadersStoreWGSL[r]||(n.ShaderStore.ShadersStoreWGSL[r]=a);var o={name:r,shader:a}},342(e,t,i){i.r(t),i.d(t,{skyViewPixelShaderWGSL:()=>o});var n=i(597),r=(i(621),i(744),"skyViewPixelShader"),a="#define RENDER_SKY_VIEW\n#include<atmosphereUboDeclaration>\nvar transmittanceLutSampler: sampler;var transmittanceLut: texture_2d<f32>;var multiScatteringLutSampler: sampler;var multiScatteringLut: texture_2d<f32>;\n#include<helperFunctions>\n#include<atmosphereFunctions>\nvarying vUV: vec2f;@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=renderSkyView(input.vUV,transmittanceLut,multiScatteringLut);}\n";n.ShaderStore.ShadersStoreWGSL[r]||(n.ShaderStore.ShadersStoreWGSL[r]=a);var o={name:r,shader:a}},783(e,t,i){i.r(t),i.d(t,{transmittancePixelShaderWGSL:()=>o});var n=i(597),r=(i(621),i(744),"transmittancePixelShader"),a="#define RENDER_TRANSMITTANCE\n#define EXCLUDE_RAY_MARCHING_FUNCTIONS\n#include<atmosphereUboDeclaration>\n#include<helperFunctions>\n#include<atmosphereFunctions>\nvarying vUV: vec2f;@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=renderTransmittance(input.vUV);}\n";n.ShaderStore.ShadersStoreWGSL[r]||(n.ShaderStore.ShadersStoreWGSL[r]=a);var o={name:r,shader:a}},370(e,t,i){i.r(t),i.d(t,{msdfPixelShader:()=>o});var n=i(597),r="msdfPixelShader",a="#extension GL_OES_standard_derivatives : enable\nprecision highp float;uniform sampler2D fontAtlas;uniform vec4 uColor;uniform vec4 uStrokeColor;uniform float uStrokeInsetWidth;uniform float uStrokeOutsetWidth;uniform float thickness;varying vec2 atlasUV;float median(vec3 msdf) {return max(min(msdf.r,msdf.g),min(max(msdf.r,msdf.g),msdf.b));}\nvoid main(void)\n{vec3 s=texture2D(fontAtlas,atlasUV).rgb;float sigDist=median(s)-0.5+thickness;float alpha=clamp(sigDist/fwidth(sigDist)+0.5,0.0,1.0);float sigDistOutset=sigDist+uStrokeOutsetWidth*0.5;float sigDistInset=sigDist-uStrokeInsetWidth*0.5;float outset=clamp(sigDistOutset/fwidth(sigDistOutset)+0.5,0.0,1.0);float inset=1.0-clamp(sigDistInset/fwidth(sigDistInset)+0.5,0.0,1.0);float border=outset*inset;vec4 filledFragColor=vec4(uColor.rgb,alpha*uColor.a);vec4 strokedFragColor=vec4(uStrokeColor.rgb,border*uStrokeColor.a);gl_FragColor=mix(filledFragColor,strokedFragColor,border);}";n.ShaderStore.ShadersStore[r]||(n.ShaderStore.ShadersStore[r]=a);var o={name:r,shader:a}},36(e,t,i){i.r(t),i.d(t,{msdfVertexShader:()=>o});var n=i(597),r="msdfVertexShader",a="#define BILLBOARD 1\n#define BILLBOARDSCREENPROJECTED 2\nattribute vec2 offsets;attribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;attribute vec4 uvs;uniform mat4 transform;uniform mat4 parentWorld;uniform mat4 view;uniform mat4 projection;uniform vec3 center;uniform int mode;varying vec2 atlasUV;void main(void) {mat4 world=mat4(world0,world1,world2,world3);vec4 worldPos=transform*(world*vec4(offsets.xy-vec2(0.5,0.5),0.,1.0));if (mode>=BILLBOARD) {vec3 viewPos=(view*parentWorld*vec4(0.,0.,0.,1.0)).xyz; \nif (mode==BILLBOARDSCREENPROJECTED) {viewPos.x/=viewPos.z;viewPos.y/=viewPos.z;viewPos.z=1.0;}\ngl_Position=projection*vec4(viewPos+worldPos.xyz,1.0); } else {vec3 viewPos=(view*parentWorld*worldPos).xyz; \ngl_Position=projection*vec4(viewPos,1.0); }\natlasUV=vec2(uvs.x+offsets.x*uvs.z,uvs.y+(1.0-offsets.y)*uvs.w);}";n.ShaderStore.ShadersStore[r]||(n.ShaderStore.ShadersStore[r]=a);var o={name:r,shader:a}},115(e,t,i){i.r(t),i.d(t,{msdfPixelShaderWGSL:()=>o});var n=i(597),r="msdfPixelShader",a="var fontAtlas: texture_2d<f32>;var fontAtlasSampler: sampler;uniform uColor: vec4f;uniform thickness: f32;uniform uStrokeColor: vec4f;uniform uStrokeInsetWidth: f32;uniform uStrokeOutsetWidth: f32;varying atlasUV: vec2f;fn median(msdf: vec3<f32>)->f32 {let a=min(msdf.r,msdf.g);let b=max(msdf.r,msdf.g);return max(a,min(b,msdf.b));}\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {let s=textureSample(fontAtlas,fontAtlasSampler,input.atlasUV).rgb;let sigDist=median(s)-0.5+uniforms.thickness;let afwidth=length(vec2<f32>(dpdx(sigDist),dpdy(sigDist)));let alpha=clamp(sigDist/afwidth+0.5,0.0,1.0);let sigDistOutset=sigDist+uniforms.uStrokeOutsetWidth*0.5;let sigDistInset=sigDist-uniforms.uStrokeInsetWidth*0.5;let afwidthOutset=length(vec2<f32>(dpdx(sigDistOutset),dpdy(sigDistOutset)));let afwidthInset=length(vec2<f32>(dpdx(sigDistInset),dpdy(sigDistInset)));let outset=clamp(sigDistOutset/afwidthOutset+0.5,0.0,1.0);let inset=1.0-clamp(sigDistInset/afwidthInset+0.5,0.0,1.0);let border=outset*inset;let filledFragColor=vec4<f32>(uniforms.uColor.rgb,alpha*uniforms.uColor.a);let strokedFragColor=vec4<f32>(uniforms.uStrokeColor.rgb,border*uniforms.uStrokeColor.a);fragmentOutputs.color=mix(filledFragColor,strokedFragColor,border);}";n.ShaderStore.ShadersStoreWGSL[r]||(n.ShaderStore.ShadersStoreWGSL[r]=a);var o={name:r,shader:a}},681(e,t,i){i.r(t),i.d(t,{msdfVertexShaderWGSL:()=>o});var n=i(597),r="msdfVertexShader",a="#define BILLBOARD 1\n#define BILLBOARDSCREENPROJECTED 2\nattribute offsets: vec2f;attribute world0: vec4f;attribute world1: vec4f;attribute world2: vec4f;attribute world3: vec4f;attribute uvs: vec4f;uniform transform: mat4x4f;uniform parentWorld: mat4x4f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform mode: u32;varying atlasUV: vec2f;@vertex\nfn main(input: VertexInputs)->FragmentInputs {let world=mat4x4<f32>(input.world0,input.world1,input.world2,input.world3);let localOffset=vec4<f32>(input.offsets-vec2<f32>(0.5,0.5),0.0,1.0);let worldPos=uniforms.transform*world*localOffset;if (uniforms.mode>=BILLBOARD) { \nvar viewPos=(uniforms.view*uniforms.parentWorld*vec4f(0.,0.,0.,1.0)).xyz;if (uniforms.mode==BILLBOARDSCREENPROJECTED) {viewPos=vec3f(viewPos.x/viewPos.z,viewPos.y/viewPos.z,1.0);} \nvertexOutputs.position=uniforms.projection*vec4<f32>(viewPos+worldPos.xyz,1.0);} else { \nlet viewPos=(uniforms.view*uniforms.parentWorld*worldPos).xyz;vertexOutputs.position=uniforms.projection*vec4<f32>(viewPos,1.0);}\nvertexOutputs.atlasUV=vec2<f32>(\ninput.uvs.x+input.offsets.x*input.uvs.z,\ninput.uvs.y+(1.0-input.offsets.y)*input.uvs.w\n);}";n.ShaderStore.ShadersStoreWGSL[r]||(n.ShaderStore.ShadersStoreWGSL[r]=a);var o={name:r,shader:a}},597(t){t.exports=e}},i={};function n(e){var r=i[e];if(void 0!==r)return r.exports;var a=i[e]={exports:{}};return t[e](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};n.d(r,{default:()=>gt});var a={};n.r(a),n.d(a,{Atmosphere:()=>Z,AtmospherePhysicalProperties:()=>R,BuildFromNavmeshData:()=>pt,BuildFromTileCacheData:()=>ht,ComputeSmoothPath:()=>Je,ConvertNavPathPoints:()=>Ye,CreateDebugNavMesh:()=>at,CreateDefaultTileCacheMeshProcess:()=>ze,CreateNavigationPluginAsync:()=>ct,CreateSoloNavMeshConfig:()=>Be,CreateTileCacheNavMeshConfig:()=>We,CreateTiledNavMeshConfig:()=>He,DebugLayerOption:()=>mt,DefaultMaxObstacles:()=>Ge,DefaultParagraphOptions:()=>xe,DiffuseSkyIrradianceLut:()=>U,FitStrategy:()=>be,FontAsset:()=>Ce,GenerateNavMesh:()=>ot,GetChaikinSmoothPath:()=>ut,GetLShapedPath:()=>dt,GetPositionsAndIndices:()=>nt,GetReversedIndices:()=>rt,HtmlMesh:()=>Re,HtmlMeshRenderer:()=>ae,InjectGenerators:()=>st,NavigationDebugger:()=>ft,PointerEventsCaptureBehavior:()=>Le,RecastNavigationJSPluginV2:()=>lt,SdfTextParagraph:()=>Me,TextRenderer:()=>we,ToCrowdAgentParams:()=>qe,ToSoloNavMeshGeneratorConfig:()=>je,TransmittanceLut:()=>W,WaitForFullTileCacheUpdate:()=>ke,msdfPixelShader:()=>Oe.msdfPixelShader,msdfPixelShaderWGSL:()=>Ne.msdfPixelShaderWGSL,msdfVertexShader:()=>Ie.msdfVertexShader,msdfVertexShaderWGSL:()=>De.msdfVertexShaderWGSL});var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},o(e,t)};function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var l=function(){return l=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},l.apply(this,arguments)};function c(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))}function u(e,t){var i,n,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(i=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function d(e,t,i){if(i||2===arguments.length)for(var n,r=0,a=t.length;r<a;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var p,h=n(597),m=(n(744),n(621),s((function(e){var t=p.call(this)||this;return t.APPLY_AERIAL_PERSPECTIVE_INTENSITY=!1,t.APPLY_AERIAL_PERSPECTIVE_RADIANCE_BIAS=!1,t.SAMPLE_TRANSMITTANCE_LUT=!0,t.EXCLUDE_RAY_MARCHING_FUNCTIONS=!0,t.USE_AERIAL_PERSPECTIVE_LUT=e,t}),p=h.MaterialDefines),"originOffsetKm"),f="inverseViewportSize",g=[{name:m,size:3,type:"vec3"},{name:"_atmoPbrPadding1",size:1,type:"float"},{name:f,size:2,type:"vec2"}],v={x:0,y:0,z:0},_=function(e){function t(t,i,n){void 0===n&&(n=!1);var r=e.call(this,t,"AtmospherePBRMaterialPlugin",600,{USE_CUSTOM_REFLECTION:null!==i.diffuseSkyIrradianceLut,CUSTOM_FRAGMENT_BEFORE_FOG:n,USE_AERIAL_PERSPECTIVE_LUT:n&&i.isAerialPerspectiveLutEnabled,APPLY_AERIAL_PERSPECTIVE_INTENSITY:n&&1!==i.aerialPerspectiveIntensity,APPLY_AERIAL_PERSPECTIVE_RADIANCE_BIAS:n&&0!==i.aerialPerspectiveRadianceBias,SAMPLE_TRANSMITTANCE_LUT:!0,EXCLUDE_RAY_MARCHING_FUNCTIONS:!0},!1,!0,!0)||this;return r._atmosphere=i,r._isAerialPerspectiveEnabled=n,r.doNotSerialize=!0,r._pluginManager._addPlugin(r),r}return s(t,e),t.prototype.isCompatible=function(){return!0},t.prototype.getUniformBuffersNames=function(e){var t=this._atmosphere.uniformBuffer;if(t.useUbo){var i=1===this._material.shaderLanguage?"atmosphere":t.name;e.push(i)}},t.prototype.getUniforms=function(){return e=this._atmosphere,{ubo:g,fragment:"uniform vec2 ".concat(f,";\nuniform vec3 ").concat(m,";\n"),externalUniforms:e.uniformBuffer.getUniformNames()};var e},t.prototype.isReadyForSubMesh=function(){var e,t,i=!0,n=this._atmosphere;if(this._isAerialPerspectiveEnabled&&n.isAerialPerspectiveLutEnabled){var r=n.aerialPerspectiveLutRenderTarget;i=i&&!!(null==r?void 0:r.isReady())}var a=null!==(t=null===(e=n.transmittanceLut)||void 0===e?void 0:e.renderTarget)&&void 0!==t?t:null;return i&&!!(null==a?void 0:a.isReady())},t.prototype.getActiveTextures=function(e){var t,i,n=this._atmosphere;if(this._isAerialPerspectiveEnabled&&n.isAerialPerspectiveLutEnabled){var r=n.aerialPerspectiveLutRenderTarget;r&&e.push(r)}var a=null!==(i=null===(t=n.transmittanceLut)||void 0===t?void 0:t.renderTarget)&&void 0!==i?i:null;a&&e.push(a)},t.prototype.bindForSubMesh=function(e){var t,i,n=this._atmosphere,r=n.scene,a=r.getEngine(),o=e.currentEffect;o&&this._atmosphere.bindUniformBufferToEffect(o),e.updateVector3(m,r.floatingOriginMode?(0,h.Vector3ScaleToRef)(r.floatingOriginOffset,.001,v):(0,h.Vector3FromFloatsToRef)(0,n.physicalProperties.planetRadius,0,v));var s=a.getRenderWidth(),l=a.getRenderHeight();if(e.updateFloat2(f,1/s,1/l),this._isAerialPerspectiveEnabled&&n.isAerialPerspectiveLutEnabled){var c=n.aerialPerspectiveLutRenderTarget;e.setTexture("aerialPerspectiveLut",c)}var u=null!==(i=null===(t=n.transmittanceLut)||void 0===t?void 0:t.renderTarget)&&void 0!==i?i:null;e.setTexture("transmittanceLut",u)},t.prototype.prepareDefines=function(e){var t=e.USE_AERIAL_PERSPECTIVE_LUT,i=e.APPLY_AERIAL_PERSPECTIVE_INTENSITY,n=e.APPLY_AERIAL_PERSPECTIVE_RADIANCE_BIAS;e.USE_AERIAL_PERSPECTIVE_LUT=this._isAerialPerspectiveEnabled&&this._atmosphere.isAerialPerspectiveLutEnabled,e.APPLY_AERIAL_PERSPECTIVE_INTENSITY=this._isAerialPerspectiveEnabled&&1!==this._atmosphere.aerialPerspectiveIntensity,e.APPLY_AERIAL_PERSPECTIVE_RADIANCE_BIAS=this._isAerialPerspectiveEnabled&&0!==this._atmosphere.aerialPerspectiveRadianceBias,t===e.USE_AERIAL_PERSPECTIVE_LUT&&i===e.APPLY_AERIAL_PERSPECTIVE_INTENSITY&&n===e.APPLY_AERIAL_PERSPECTIVE_RADIANCE_BIAS||e.markAllAsDirty()},t.prototype.getSamplers=function(e){e.push("transmittanceLut"),this._isAerialPerspectiveEnabled&&this._atmosphere.isAerialPerspectiveLutEnabled&&e.push("aerialPerspectiveLut")},t.prototype.getCustomCode=function(e,t){if("fragment"!==e)return null;var i=this._atmosphere.scene.getEngine().supportsUniformBuffers?"-light0.vLightData.xyz":"-vLightData0.xyz",n=1===t||this._atmosphere.uniformBuffer.useUbo?"#include<atmosphereUboDeclaration>":"#include<atmosphereFragmentDeclaration>";return 0===t?{CUSTOM_FRAGMENT_DEFINITIONS:this._isAerialPerspectiveEnabled&&this._atmosphere.isAerialPerspectiveLutEnabled?"uniform sampler2D transmittanceLut;\r\nprecision highp sampler2DArray;\r\nuniform sampler2DArray aerialPerspectiveLut;\r\n".concat(n,"\r\n#include<atmosphereFunctions>"):"uniform sampler2D transmittanceLut;\r\n".concat(n,"\r\n#include<atmosphereFunctions>"),CUSTOM_LIGHT0_COLOR:"\n            {\n                vec3 positionGlobal = 0.001 * vPositionW + ".concat(m,";\n                float positionRadius = length(positionGlobal);\n                vec3 geocentricNormal = positionGlobal / positionRadius;\n                vec3 directionToLight = ").concat(i,";\n                float cosAngleLightToZenith = dot(directionToLight, geocentricNormal);\n                diffuse0 = lightIntensity * sampleTransmittanceLut(transmittanceLut, positionRadius, cosAngleLightToZenith);\n            }\n"),CUSTOM_REFLECTION:"\n            {\n                vec3 positionGlobal =  0.001 * vPositionW + ".concat(m,";\n                float positionRadius = length(positionGlobal);\n                vec3 geocentricNormal = positionGlobal / positionRadius;\n\n                vec3 directionToLight = ").concat(i,";\n                float cosAngleLightToZenith = dot(directionToLight, geocentricNormal);\n\n                vec2 uv = vec2(0.5 + 0.5 * cosAngleLightToZenith, (positionRadius - planetRadius) / atmosphereThickness);\n                float irradianceScaleT = 0.5 * dot(normalW, geocentricNormal) + 0.5;\n                float irradianceScale = ((-0.6652 * irradianceScaleT) + 1.5927) * irradianceScaleT + 0.1023;\n                vec3 environmentIrradiance = lightIntensity * sampleReflection(irradianceSampler, uv).rgb;\n\n                // Add a contribution here to estimate indirect lighting.\n                const float r = 0.2;\n                float indirect = getLuminance(environmentIrradiance) / max(0.00001, 1. - r);\n                environmentIrradiance *= irradianceScale;\n                environmentIrradiance += indirect;\n\n                environmentIrradiance += additionalDiffuseSkyIrradiance;\n\n                const float diffuseBrdf = 1. / PI;\n                environmentIrradiance *= diffuseBrdf * diffuseSkyIrradianceIntensity;\n\n                reflectionOut.environmentIrradiance = environmentIrradiance;\n                reflectionOut.environmentRadiance.rgb = reflectionOut.environmentIrradiance;\n            }\n"),CUSTOM_FRAGMENT_BEFORE_FOG:"\n            #if USE_AERIAL_PERSPECTIVE_LUT\n            {\n                float distanceFromCameraKm = 0.001 * distance(vEyePosition.xyz, vPositionW);\n                vec4 aerialPerspective = vec4(0.);\n                if (sampleAerialPerspectiveLut(\n                        gl_FragCoord.xy * ".concat(f,",\n                        true,\n                        distanceFromCameraKm,\n                        NumAerialPerspectiveLutLayers,\n                        AerialPerspectiveLutKMPerSlice,\n                        AerialPerspectiveLutRangeKM,\n                        aerialPerspective)) {\n                    finalColor = aerialPerspective + (1. - aerialPerspective.a) * finalColor;\n                }\n            }\n            #endif\n")}:{CUSTOM_FRAGMENT_DEFINITIONS:this._isAerialPerspectiveEnabled&&this._atmosphere.isAerialPerspectiveLutEnabled?"var transmittanceLutSampler: sampler;\r\nvar transmittanceLut: texture_2d<f32>;\r\nvar aerialPerspectiveLutSampler: sampler;\r\nvar aerialPerspectiveLut: texture_2d_array<f32>;\r\n".concat(n,"\r\n#include<atmosphereFunctions>"):"var transmittanceLutSampler: sampler;\r\nvar transmittanceLut: texture_2d<f32>;\r\n".concat(n,"\r\n#include<atmosphereFunctions>"),CUSTOM_LIGHT0_COLOR:"\n            {\n                var positionGlobal = 0.001 * fragmentInputs.vPositionW + uniforms.".concat(m,";\n                var positionRadius = length(positionGlobal);\n                var geocentricNormal = positionGlobal / positionRadius;\n                var directionToLight = ").concat(i,";\n                var cosAngleLightToZenith = dot(directionToLight, geocentricNormal);\n                diffuse0 = atmosphere.lightIntensity * sampleTransmittanceLut(transmittanceLut, positionRadius, cosAngleLightToZenith);\n            }\n"),CUSTOM_REFLECTION:"\n            {\n                var positionGlobal =  0.001 * fragmentInputs.vPositionW + uniforms.".concat(m,";\n                var positionRadius = length(positionGlobal);\n                var geocentricNormal = positionGlobal / positionRadius;\n\n                var directionToLight = ").concat(i,";\n                var cosAngleLightToZenith = dot(directionToLight, geocentricNormal);\n\n                var uv = vec2f(0.5 + 0.5 * cosAngleLightToZenith, (positionRadius - atmosphere.planetRadius) / atmosphere.atmosphereThickness);\n                var irradianceScaleT = 0.5 * dot(normalW, geocentricNormal) + 0.5;\n                var irradianceScale = ((-0.6652 * irradianceScaleT) + 1.5927) * irradianceScaleT + 0.1023;\n                var environmentIrradiance = atmosphere.lightIntensity * textureSample(irradianceSampler, irradianceSamplerSampler, uv).rgb;\n\n                // Add a contribution here to estimate indirect lighting.\n                const r = 0.2;\n                var indirect = getLuminance(environmentIrradiance) / max(0.00001, 1.0 - r);\n                environmentIrradiance *= irradianceScale;\n                environmentIrradiance += indirect;\n\n                environmentIrradiance += atmosphere.additionalDiffuseSkyIrradiance;\n\n                const diffuseBrdf = 1.0 / PI;\n                environmentIrradiance *= diffuseBrdf * atmosphere.diffuseSkyIrradianceIntensity;\n\n                reflectionOut.environmentIrradiance = environmentIrradiance;\n                reflectionOut.environmentRadiance = vec4f(reflectionOut.environmentIrradiance, reflectionOut.environmentRadiance.a);\n            }\n"),CUSTOM_FRAGMENT_BEFORE_FOG:"\n            #if USE_AERIAL_PERSPECTIVE_LUT\n            {\n                var distanceFromCameraKm = 0.001 * distance(scene.vEyePosition.xyz, fragmentInputs.vPositionW);\n                var aerialPerspective = vec4f(0.);\n                if (sampleAerialPerspectiveLut(\n                        fragmentInputs.position.xy * uniforms.".concat(f,",\n                        true,\n                        distanceFromCameraKm,\n                        NumAerialPerspectiveLutLayers,\n                        AerialPerspectiveLutKMPerSlice,\n                        AerialPerspectiveLutRangeKM,\n                        &aerialPerspective)) {\n                    finalColor = aerialPerspective + (1. - aerialPerspective.a) * finalColor;\n                }\n            }\n            #endif\n")}},t}(h.MaterialPluginBase),y=new h.Ray(h.Vector3.Zero(),h.Vector3.Zero()),S=function(){function e(){this._inverseViewProjectionMatrixWithoutTranslation=h.Matrix.Identity(),this._directionToLightRelativeToCameraGeocentricNormal=h.Vector3.Up(),this._cosAngleLightToZenith=0,this._cameraRadius=0,this._clampedCameraRadius=0,this._cameraHeight=0,this._clampedCameraHeight=0,this._cameraPositionGlobal=new h.Vector3,this._clampedCameraPositionGlobal=new h.Vector3,this._cosCameraHorizonAngleFromZenith=0,this._sinCameraAtmosphereHorizonAngleFromNadir=0,this._cameraGeocentricNormal=h.Vector3.Up(),this._cameraForward=h.Vector3.Down(),this._cameraNearPlane=0,this._cameraPosition=new h.Vector3,this._viewport=new h.Vector4,this._lastViewMatrix=h.Matrix.Identity(),this._lastProjectionMatrix=h.Matrix.Identity(),this._inverseViewMatrixWithoutTranslation=h.Matrix.Identity(),this._inverseProjectionMatrix=h.Matrix.Identity()}return Object.defineProperty(e.prototype,"inverseViewProjectionMatrixWithoutTranslation",{get:function(){return this._inverseViewProjectionMatrixWithoutTranslation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"directionToLightRelativeToCameraGeocentricNormal",{get:function(){return this._directionToLightRelativeToCameraGeocentricNormal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cosAngleLightToZenith",{get:function(){return this._cosAngleLightToZenith},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraRadius",{get:function(){return this._cameraRadius},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clampedCameraRadius",{get:function(){return this._clampedCameraRadius},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraHeight",{get:function(){return this._cameraHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clampedCameraHeight",{get:function(){return this._clampedCameraHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraPositionGlobal",{get:function(){return this._cameraPositionGlobal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clampedCameraPositionGlobal",{get:function(){return this._clampedCameraPositionGlobal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cosCameraHorizonAngleFromZenith",{get:function(){return this._cosCameraHorizonAngleFromZenith},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sinCameraAtmosphereHorizonAngleFromNadir",{get:function(){return this._sinCameraAtmosphereHorizonAngleFromNadir},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraGeocentricNormal",{get:function(){return this._cameraGeocentricNormal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraForward",{get:function(){return this._cameraForward},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraNearPlane",{get:function(){return this._cameraNearPlane},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraPosition",{get:function(){return this._cameraPosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},enumerable:!1,configurable:!0}),e.prototype.update=function(e,t,i,n,r,a){this._cameraNearPlane=e.minZ,this._cameraForward.copyFrom(e.getForwardRayToRef(y,1).direction);var o=e.getScene(),s=o.getEngine();this._viewport.copyFromFloats(0,0,s.getRenderWidth(),s.getRenderHeight());var l=e.getViewMatrix(),c=e.getProjectionMatrix(),u=this._lastViewMatrix,d=this._lastProjectionMatrix;u.equals(l)&&d.equals(c)||(u.copyFrom(l),u.setTranslation(h.Vector3.ZeroReadOnly),u.invertToRef(this._inverseViewMatrixWithoutTranslation),d.copyFrom(c),d.invertToRef(this._inverseProjectionMatrix),this._inverseProjectionMatrix.multiplyToRef(this._inverseViewMatrixWithoutTranslation,this._inverseViewProjectionMatrixWithoutTranslation));var p=this._cameraPosition.copyFrom(e.globalPosition).scaleToRef(.001,this._cameraPositionGlobal);o.floatingOriginMode?(p.normalizeToRef(this._cameraGeocentricNormal),this._cameraGeocentricNormal.scaleAndAddToRef(a,p)):(p.y+=t+a,p.normalizeToRef(this._cameraGeocentricNormal)),this._cameraRadius=p.length(),this._cameraHeight=this._cameraRadius-t,this._clampedCameraRadius=this._cameraRadius,this._clampedCameraRadius<i?(this._clampedCameraRadius=i,this._cameraGeocentricNormal.scaleToRef(i,this._clampedCameraPositionGlobal)):this._clampedCameraPositionGlobal.copyFrom(p),this._cosCameraHorizonAngleFromZenith=T(t,this._clampedCameraRadius),this._sinCameraAtmosphereHorizonAngleFromNadir=Math.min(1,n/this._clampedCameraRadius),this._clampedCameraHeight=this._clampedCameraRadius-t,this._cosAngleLightToZenith=(0,h.Vector3Dot)(r,this._cameraGeocentricNormal);var m=Math.sqrt(Math.max(0,1-this._cosAngleLightToZenith*this._cosAngleLightToZenith));this._directionToLightRelativeToCameraGeocentricNormal.copyFromFloats(m,this._cosAngleLightToZenith,0),this._directionToLightRelativeToCameraGeocentricNormal.normalize()},e}(),T=function(e,t){var i=Math.min(1,e/t);return-Math.sqrt(1-i*i)},P=new h.Vector3(.005802,.013558,.0331),A=new h.Vector3(.003996,.003996,.003996),L=new h.Vector3(444e-6,444e-6,444e-6),b=new h.Vector3(65e-5,.001881,85e-6),R=function(){function e(e){var t,i,n,r,a,o,s,l,c,u,d;this.onChangedObservable=new h.Observable,this._peakRayleighScattering=new h.Vector3,this._peakMieScattering=new h.Vector3,this._peakMieAbsorption=new h.Vector3,this._peakOzoneAbsorption=new h.Vector3,this._planetRadiusWithOffset=0,this._planetRadiusSquared=0,this._atmosphereRadius=0,this._atmosphereRadiusSquared=0,this._horizonDistanceToAtmosphereEdge=0,this._horizonDistanceToAtmosphereEdgeSquared=0,this._rayleighScattering=new h.Vector3,this._mieScattering=new h.Vector3,this._mieAbsorption=new h.Vector3,this._mieExtinction=new h.Vector3,this._ozoneAbsorption=new h.Vector3,this._planetRadius=null!==(t=null==e?void 0:e.planetRadius)&&void 0!==t?t:6360,this._planetRadiusOffset=null!==(i=null==e?void 0:e.planetRadiusOffset)&&void 0!==i?i:.01,this._atmosphereThickness=null!==(n=null==e?void 0:e.atmosphereThickness)&&void 0!==n?n:100,this._rayleighScatteringScale=null!==(r=null==e?void 0:e.rayleighScatteringScale)&&void 0!==r?r:1,this._peakRayleighScattering.copyFrom(null!==(a=null==e?void 0:e.peakRayleighScattering)&&void 0!==a?a:P),this._mieScatteringScale=null!==(o=null==e?void 0:e.mieScatteringScale)&&void 0!==o?o:1,this._peakMieScattering.copyFrom(null!==(s=null==e?void 0:e.peakMieScattering)&&void 0!==s?s:A),this._mieAbsorptionScale=null!==(l=null==e?void 0:e.mieAbsorptionScale)&&void 0!==l?l:1,this._peakMieAbsorption.copyFrom(null!==(c=null==e?void 0:e.peakMieAbsorption)&&void 0!==c?c:L),this._ozoneAbsorptionScale=null!==(u=null==e?void 0:e.ozoneAbsorptionScale)&&void 0!==u?u:1,this._peakOzoneAbsorption.copyFrom(null!==(d=null==e?void 0:e.peakOzoneAbsorption)&&void 0!==d?d:b),this._recomputeDimensionalParameters(),this._recomputeRayleighScattering(),this._recomputeMieScattering(),this._recomputeMieAbsorption(),this._recomputeOzoneAbsorption()}return Object.defineProperty(e.prototype,"planetRadius",{get:function(){return this._planetRadius},set:function(e){this._planetRadius!==e&&(this._planetRadius=e,this._recomputeDimensionalParameters(),this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"planetRadiusSquared",{get:function(){return this._planetRadiusSquared},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"planetRadiusOffset",{get:function(){return this._planetRadiusOffset},set:function(e){this._planetRadiusOffset!==e&&(this._planetRadiusOffset=e,this._recomputeDimensionalParameters(),this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"planetRadiusWithOffset",{get:function(){return this._planetRadiusWithOffset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atmosphereThickness",{get:function(){return this._atmosphereThickness},set:function(e){this._atmosphereThickness!==e&&(this._atmosphereThickness=e,this._recomputeDimensionalParameters(),this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atmosphereRadius",{get:function(){return this._atmosphereRadius},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atmosphereRadiusSquared",{get:function(){return this._atmosphereRadiusSquared},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"horizonDistanceToAtmosphereEdge",{get:function(){return this._horizonDistanceToAtmosphereEdge},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"horizonDistanceToAtmosphereEdgeSquared",{get:function(){return this._horizonDistanceToAtmosphereEdgeSquared},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rayleighScatteringScale",{get:function(){return this._rayleighScatteringScale},set:function(e){this._rayleighScatteringScale!==e&&(this._rayleighScatteringScale=e,this._recomputeRayleighScattering(),this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"peakRayleighScattering",{get:function(){return this._peakRayleighScattering},set:function(e){this._peakRayleighScattering.equals(e)||(this._peakRayleighScattering.copyFrom(e),this._recomputeRayleighScattering(),this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rayleighScattering",{get:function(){return this._rayleighScattering},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mieScatteringScale",{get:function(){return this._mieScatteringScale},set:function(e){this._mieScatteringScale!==e&&(this._mieScatteringScale=e,this._recomputeMieScattering(),this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"peakMieScattering",{get:function(){return this._peakMieScattering},set:function(e){this._peakMieScattering.equals(e)||(this._peakMieScattering.copyFrom(e),this._recomputeMieScattering(),this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mieScattering",{get:function(){return this._mieScattering},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mieAbsorptionScale",{get:function(){return this._mieAbsorptionScale},set:function(e){this._mieAbsorptionScale!==e&&(this._mieAbsorptionScale=e,this._recomputeMieAbsorption(),this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"peakMieAbsorption",{get:function(){return this._peakMieAbsorption},set:function(e){this._peakMieAbsorption.equals(e)||(this._peakMieAbsorption.copyFrom(e),this._recomputeMieAbsorption(),this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mieAbsorption",{get:function(){return this._mieAbsorption},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mieExtinction",{get:function(){return this._mieExtinction},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ozoneAbsorptionScale",{get:function(){return this._ozoneAbsorptionScale},set:function(e){this._ozoneAbsorptionScale!==e&&(this._ozoneAbsorptionScale=e,this._recomputeOzoneAbsorption(),this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"peakOzoneAbsorption",{get:function(){return this._peakOzoneAbsorption},set:function(e){this._peakOzoneAbsorption.equals(e)||(this._peakOzoneAbsorption.copyFrom(e),this._recomputeOzoneAbsorption(),this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ozoneAbsorption",{get:function(){return this._ozoneAbsorption},enumerable:!1,configurable:!0}),e.prototype._recomputeDimensionalParameters=function(){this._planetRadiusWithOffset=this._planetRadius+this._planetRadiusOffset,this._planetRadiusSquared=this._planetRadius*this._planetRadius,this._atmosphereRadius=this._planetRadius+this._atmosphereThickness,this._atmosphereRadiusSquared=this._atmosphereRadius*this._atmosphereRadius,this._horizonDistanceToAtmosphereEdgeSquared=this._atmosphereRadiusSquared-this._planetRadiusSquared,this._horizonDistanceToAtmosphereEdge=Math.sqrt(this._horizonDistanceToAtmosphereEdgeSquared)},e.prototype._recomputeRayleighScattering=function(){this._peakRayleighScattering.scaleToRef(this._rayleighScatteringScale,this._rayleighScattering)},e.prototype._recomputeMieScattering=function(){this._peakMieScattering.scaleToRef(this._mieScatteringScale,this._mieScattering),this._recomputeMieExtinction()},e.prototype._recomputeMieAbsorption=function(){this._peakMieAbsorption.scaleToRef(this._mieAbsorptionScale,this._mieAbsorption),this._recomputeMieExtinction()},e.prototype._recomputeMieExtinction=function(){this._mieAbsorption.addToRef(this._mieScattering,this._mieExtinction)},e.prototype._recomputeOzoneAbsorption=function(){this._peakOzoneAbsorption.scaleToRef(this._ozoneAbsorptionScale,this._ozoneAbsorption)},e}(),E=function(){return{r:Number.NaN,g:Number.NaN,b:Number.NaN,a:Number.NaN}},C=E(),x=E(),M=E(),w=E();function I(e,t,i,n,r,a,o){if(void 0===o&&(o=function(e){return e/255}),i<=0||n<=0)throw new Error("Sample2DRgbaToRef: widthPx and heightPx must be positive.");var s=i*n*4;if(r.length<s)throw new Error("Sample2DRgbaToRef: data length (".concat(r.length,") is less than required (").concat(s,")."));e=(0,h.Clamp)(e),t=(0,h.Clamp)(t);var l=Math.max(e*i-.5,0),c=Math.max(t*n-.5,0),u=Math.floor(l),d=Math.min(u+1,i-1),p=Math.floor(c),m=Math.min(p+1,n-1),f=D(u,p,i,n,r,C,o),g=D(u,m,i,n,r,x,o),v=D(d,p,i,n,r,M,o),_=D(d,m,i,n,r,w,o),y=l-u,S=c-p,T=1-y,P=1-S,A=T*P,L=y*P,b=T*S,R=y*S;return a.r=f.r*A+v.r*L+g.r*b+_.r*R,a.g=f.g*A+v.g*L+g.g*b+_.g*R,a.b=f.b*A+v.b*L+g.b*b+_.b*R,a.a=f.a*A+v.a*L+g.a*b+_.a*R,a}var O,D=function(e,t,i,n,r,a,o){void 0===o&&(o=function(e){return e/255});var s=(0,h.Clamp)(e,0,i-1),l=4*((0,h.Clamp)(t,0,n-1)*i+s);return a.r=o(r[l]),a.g=o(r[l+1]),a.b=o(r[l+2]),a.a=o(r[l+3]),a},N={x:Number.NaN,y:Number.NaN},V={r:Number.NaN,g:Number.NaN,b:Number.NaN,a:Number.NaN},U=function(){function e(e){var t=this;this._renderTarget=null,this._effectWrapper=null,this._effectRenderer=null,this._isDirty=!0,this._isDisposed=!1,this._lutData=new Uint16Array(0),this._atmosphere=e;var i=e.scene,r=i.getEngine(),a="atmo-diffuseSkyIrradiance",o=r.getCaps().textureHalfFloatRender?h.Constants.TEXTURETYPE_HALF_FLOAT:h.Constants.TEXTURETYPE_UNSIGNED_BYTE,s=this._renderTarget=new h.RenderTargetTexture(a,{width:64,height:16},i,{generateMipMaps:!1,type:o,samplingMode:h.Constants.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,gammaSpace:!1});s.wrapU=h.Constants.TEXTURE_CLAMP_ADDRESSMODE,s.wrapV=h.Constants.TEXTURE_CLAMP_ADDRESSMODE,s.anisotropicFilteringLevel=1,s.skipInitialClear=!0;var l=e.uniformBuffer,p=l.useUbo,m=r.isWebGPU&&!h.EffectWrapper.ForceGLSL,f=m?"atmosphere":l.name;this._effectWrapper=new h.EffectWrapper({engine:r,name:a,vertexShader:"fullscreenTriangle",fragmentShader:"diffuseSkyIrradiance",attributeNames:["position"],uniformNames:d(["depth"],p?[]:l.getUniformNames(),!0),uniformBuffers:p?[f]:[],defines:["#define POSITION_VEC2","#define NUM_SAMPLES ".concat(128,"u"),"#define CUSTOM_IRRADIANCE_FILTERING_INPUT","#define CUSTOM_IRRADIANCE_FILTERING_FUNCTION"],samplers:["transmittanceLut","multiScatteringLut"],useShaderStore:!0,shaderLanguage:m?1:0,extraInitializationsAsync:function(){return c(t,void 0,void 0,(function(){var e,t,i,r;return u(this,(function(a){switch(a.label){case 0:return[4,Promise.all(m?[Promise.resolve().then(n.bind(n,321)),Promise.resolve().then(n.bind(n,179))]:[Promise.resolve().then(n.bind(n,788)),Promise.resolve().then(n.bind(n,62))])];case 1:return a.sent(),e=m?h.ShaderStore.IncludesShadersStoreWGSL:h.ShaderStore.IncludesShadersStore,t=(t=(t=e.hdrFilteringFunctions).replace(/^CUSTOM_IRRADIANCE_FILTERING_INPUT\s*$/gm,"")).replace(/^CUSTOM_IRRADIANCE_FILTERING_FUNCTION\s*$/gm,m?"var c = integrateForIrradiance(n, Ls, vec3f(0., filteringInfo.x, 0.));":"vec3 c = integrateForIrradiance(n, Ls, vec3(0., filteringInfo.x, 0.));"),i=m?h.ShaderStore.ShadersStoreWGSL:h.ShaderStore.ShadersStore,r=(r=i.diffuseSkyIrradiancePixelShader).replace("#include<hdrFilteringFunctions>",t),i.diffuseSkyIrradiancePixelShader=r,[2]}}))}))}}),this._effectRenderer=new h.EffectRenderer(r,{indices:[0,2,1],positions:[-1,-1,-1,3,3,-1]}),i.environmentTexture=s,i.environmentTexture.irradianceTexture=s,i.environmentIntensity=1,i.environmentTexture.isRenderTarget=!1}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderTarget",{get:function(){if(this._isDisposed||null===this._renderTarget)throw new Error;return this._renderTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasLutData",{get:function(){return void 0!==this._lutData[0]},enumerable:!1,configurable:!0}),e.prototype.getDiffuseSkyIrradianceToRef=function(e,t,i,n,r){var a=this._atmosphere,o=a.additionalDiffuseSkyIrradiance,s=a.physicalProperties;if(void 0===this._lutData[0]||t>s.atmosphereRadius)return r.r=o.r,r.g=o.g,r.b=o.b,r;!function(e,t,i,n){var r=(0,h.Clamp)(.5+.5*i),a=(0,h.Clamp)((t-e.planetRadius)/e.atmosphereThickness);n.x=.984375*r+.0078125,n.y=.9375*a+.03125}(s,t,(0,h.Vector3Dot)(e,i),N),I(N.x,N.y,64,16,this._lutData,V,h.FromHalfFloat);var l=a.diffuseSkyIrradianceIntensity;return r.r=l*(n*V.r+o.r),r.g=l*(n*V.g+o.g),r.b=l*(n*V.b+o.b),r},e.prototype.render=function(){var e,t,i=this,n=this._effectWrapper;if(!this._isDirty||!(null==n?void 0:n.isReady())||!(null===(e=this._renderTarget)||void 0===e?void 0:e.isReady()))return!1;var r=this._effectRenderer;r.saveStates();var a=this._atmosphere.scene.getEngine();a.bindFramebuffer(this.renderTarget.renderTarget,void 0,void 0,void 0,!0),r.setViewport(),r.applyEffectWrapper(n);var o=n.effect;return r.bindBuffers(o),o.setTexture("transmittanceLut",this._atmosphere.transmittanceLut.renderTarget),o.setTexture("multiScatteringLut",this._atmosphere.multiScatteringLutRenderTarget),this._atmosphere.bindUniformBufferToEffect(o),o.setFloat("depth",0),r.draw(),r.restoreStates(),a.restoreDefaultFramebuffer(),this._isDirty=!1,null===(t=this.renderTarget.readPixels(0,0,void 0,void 0,!0))||void 0===t||t.then((function(e){i._isDisposed||(i._lutData=e)})),!0},e.prototype.markDirty=function(){this._isDirty=!0},e.prototype.dispose=function(){var e,t;this._renderTarget&&(this._renderTarget.irradianceTexture=null,this._renderTarget.dispose()),this._renderTarget=null,null===(e=this._effectWrapper)||void 0===e||e.dispose(),this._effectWrapper=null,null===(t=this._effectRenderer)||void 0===t||t.dispose(),this._effectRenderer=null,this._isDisposed=!0},e}(),F=.001953125,z=.00390625,k={x:Number.NaN,y:Number.NaN},G={r:Number.NaN,g:Number.NaN,b:Number.NaN},B={x:Number.NaN,y:Number.NaN,z:Number.NaN},H={r:Number.NaN,g:Number.NaN,b:Number.NaN,a:Number.NaN},W=function(){function e(e){this.onUpdatedObservable=new h.Observable,this._lutData=new Uint8Array(0),this._isDirty=!0,this._isDisposed=!1,this._atmosphere=e;var t=this._atmosphere.scene,i=t.getEngine(),r="atmo-transmittance",a=this._renderTarget=new h.RenderTargetTexture(r,{width:256,height:64},t,{type:h.Constants.TEXTURETYPE_UNSIGNED_BYTE,samplingMode:h.Constants.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,gammaSpace:!1});a.wrapU=h.Constants.TEXTURE_CLAMP_ADDRESSMODE,a.wrapV=h.Constants.TEXTURE_CLAMP_ADDRESSMODE,a.anisotropicFilteringLevel=1,a.skipInitialClear=!0;var o=e.uniformBuffer,s=o.useUbo,l=i.isWebGPU&&!h.EffectWrapper.ForceGLSL,c=l?"atmosphere":o.name;this._effectWrapper=new h.EffectWrapper({engine:i,name:r,vertexShader:"fullscreenTriangle",fragmentShader:"transmittance",attributeNames:["position"],uniformNames:d(["depth"],s?[]:o.getUniformNames(),!0),uniformBuffers:s?[c]:[],defines:["#define POSITION_VEC2"],useShaderStore:!0,shaderLanguage:l?1:0,extraInitializations:function(e,t){t.push.apply(t,l?[Promise.resolve().then(n.bind(n,321)),Promise.resolve().then(n.bind(n,783))]:[Promise.resolve().then(n.bind(n,788)),Promise.resolve().then(n.bind(n,416))])}}),this._effectRenderer=new h.EffectRenderer(i,{indices:[0,2,1],positions:[-1,-1,-1,3,3,-1]})}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderTarget",{get:function(){if(this._isDisposed||null===this._renderTarget)throw new Error;return this._renderTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasLutData",{get:function(){return void 0!==this._lutData[0]},enumerable:!1,configurable:!0}),e.prototype.getTransmittedColorToRef=function(e,t,i,n){if(void 0!==this._lutData[0]){var r=(0,h.Vector3Dot)(e,i);(function(e,t,i,n,r){if(i>e.atmosphereRadius)r.r=r.g=r.b=r.a=1;else{!function(e,t,i,n){var r=t*t,a=Math.sqrt(Math.max(0,r-e.planetRadiusSquared)),o=r*(i*i-1)+e.atmosphereRadiusSquared,s=Math.max(0,-t*i+Math.sqrt(Math.max(0,o))),l=Math.max(0,e.atmosphereRadius-t),c=a+e.horizonDistanceToAtmosphereEdge,u=(s-l)/Math.max(1e-6,c-l),d=a/Math.max(1e-6,e.horizonDistanceToAtmosphereEdge);n.x=.99609375*u+F,n.y=.984375*d+.0078125}(e,i,n,k),I(k.x,k.y,256,64,t,r,(function(e){return e/255}));var a=(0,h.Clamp)((0,h.SmoothStep)(1,0,(0,h.Clamp)((k.x-.998046875)/z)));r.r*=a,r.g*=a,r.b*=a,r.a*=a}})(this._atmosphere.physicalProperties,this._lutData,t,r,H),n.r=H.r,n.g=H.g,n.b=H.b}else n.r=n.g=n.b=1;return n},e.prototype.updateLightParameters=function(e,t,i){var n=e.direction;B.x=-n.x,B.y=-n.y,B.z=-n.z,this.getTransmittedColorToRef(B,t,i,G),e.diffuse.copyFromFloats(G.r,G.g,G.b),e.specular.copyFromFloats(G.r,G.g,G.b)},e.prototype.render=function(){var e,t,i=this,n=this._effectWrapper;if(!this._isDirty||!(null==n?void 0:n.isReady())||!(null===(e=this._renderTarget)||void 0===e?void 0:e.isReady()))return!1;var r=this._effectRenderer;r.saveStates();var a=this._atmosphere.scene.getEngine();a.bindFramebuffer(this.renderTarget.renderTarget,void 0,void 0,void 0,!0),r.setViewport(),r.applyEffectWrapper(n);var o=n.effect;return r.bindBuffers(o),this._atmosphere.bindUniformBufferToEffect(o),o.setFloat("depth",0),r.draw(),r.restoreStates(),a.restoreDefaultFramebuffer(),this._isDirty=!1,null===(t=this.renderTarget.readPixels(0,0,void 0,void 0,false))||void 0===t||t.then((function(e){i._isDisposed||(i._lutData=e,i.onUpdatedObservable.notifyObservers())})),!0},e.prototype.markDirty=function(){this._isDirty=!0},e.prototype.dispose=function(){var e,t,i;null===(e=this._renderTarget)||void 0===e||e.dispose(),this._renderTarget=null,null===(t=this._effectWrapper)||void 0===t||t.dispose(),this._effectWrapper=null,null===(i=this._effectRenderer)||void 0===i||i.dispose(),this._effectRenderer=null,this._isDisposed=!0},e}(),j="atmo-pbr",q=0,Z=function(){function e(e,t,i,n){var r,a,o,s,l,c,u,d,p,m,f,g,v,y,T,P,A,L,b,E,C,x,M=this;this.name=e,this.scene=t,this._directionToLight=h.Vector3.Zero(),this._tempSceneAmbient=new h.Color3,this._additionalDiffuseSkyIrradiance=new h.Color3,this._atmosphereUbo=null,this._minimumMultiScattering=new h.Vector3,this._cameraAtmosphereVariables=new S,this._lightRadianceAtCamera=new h.Vector3,this._linearLightColor=new h.Color3,this._atmosphereUniformBufferAsArray=[],this._effectRenderer=null,this._isEnabled=!0,this._aerialPerspectiveLutHasBeenRendered=!1,this._hasRenderedMultiScatteringLut=!1,this._hasEverRenderedMultiScatteringLut=!1,this._multiScatteringEffectWrapper=null,this._multiScatteringLutRenderTarget=null,this._aerialPerspectiveLutEffectWrapper=null,this._aerialPerspectiveLutEffectRenderer=null,this._aerialPerspectiveLutRenderTarget=null,this._skyViewLutEffectWrapper=null,this._skyViewLutEffectRenderer=null,this._skyViewLutRenderTarget=null,this._aerialPerspectiveCompositorEffectWrapper=null,this._skyCompositorEffectWrapper=null,this._globeAtmosphereCompositorEffectWrapper=null,this._onBeforeCameraRenderObserver=null,this._onBeforeRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterRenderingGroupObserver=null,this.uniqueId=q++,this.onAfterUpdateVariablesForCameraObservable=new h.Observable,this.onBeforeLightVariablesUpdateObservable=new h.Observable,this.onBeforeRenderLutsForCameraObservable=new h.Observable,this.onAfterRenderLutsForCameraObservable=new h.Observable,this.depthTexture=null,this.getTransmittedColorToRef=function(e,t,i,n){return M._transmittanceLut.getTransmittedColorToRef(e,t,i,n)},this.getDiffuseSkyIrradianceToRef=function(e,t,i,n,r){var a,o;return null!==(o=null===(a=M._diffuseSkyIrradianceLut)||void 0===a?void 0:a.getDiffuseSkyIrradianceToRef(e,t,i,n,r))&&void 0!==o?o:(r.r=0,r.g=0,r.b=0,r)};var w=this._engine=t.getEngine();if(!w.isWebGPU&&w.version<2)throw new Error("Atmosphere is not supported on WebGL ".concat(w.version,"."));if(this._physicalProperties=null!==(r=null==n?void 0:n.physicalProperties)&&void 0!==r?r:new R,this._physicalProperties.onChangedObservable.add((function(){var e;null===(e=M._transmittanceLut)||void 0===e||e.markDirty()})),1!==i.length)throw new Error("Atmosphere only supports one light source currently.");this._lights=i,this.depthTexture=null!==(a=null==n?void 0:n.depthTexture)&&void 0!==a?a:null,this._exposure=null!==(o=null==n?void 0:n.exposure)&&void 0!==o?o:1,this._isLinearSpaceLight=null!==(s=null==n?void 0:n.isLinearSpaceLight)&&void 0!==s&&s,this._isLinearSpaceComposition=null!==(l=null==n?void 0:n.isLinearSpaceComposition)&&void 0!==l&&l,this._applyApproximateTransmittance=null===(c=null==n?void 0:n.applyApproximateTransmittance)||void 0===c||c,this._aerialPerspectiveRadianceBias=null!==(u=null==n?void 0:n.aerialPerspectiveRadianceBias)&&void 0!==u?u:0,this._aerialPerspectiveTransmittanceScale=null!==(d=null==n?void 0:n.aerialPerspectiveTransmittanceScale)&&void 0!==d?d:1,this._aerialPerspectiveSaturation=null!==(p=null==n?void 0:n.aerialPerspectiveSaturation)&&void 0!==p?p:1,this._aerialPerspectiveIntensity=null!==(m=null==n?void 0:n.aerialPerspectiveIntensity)&&void 0!==m?m:1,this._diffuseSkyIrradianceDesaturationFactor=null!==(f=null==n?void 0:n.diffuseSkyIrradianceDesaturationFactor)&&void 0!==f?f:.5,this._diffuseSkyIrradianceIntensity=null!==(g=null==n?void 0:n.diffuseSkyIrradianceIntensity)&&void 0!==g?g:1,this._additionalDiffuseSkyIrradianceIntensity=null!==(v=null==n?void 0:n.additionalDiffuseSkyIrradianceIntensity)&&void 0!==v?v:.01,this._multiScatteringIntensity=null!==(y=null==n?void 0:n.multiScatteringIntensity)&&void 0!==y?y:1,this._minimumMultiScatteringIntensity=null!==(T=null==n?void 0:n.minimumMultiScatteringIntensity)&&void 0!==T?T:618e-6,this._isSkyViewLutEnabled=null===(P=null==n?void 0:n.isSkyViewLutEnabled)||void 0===P||P,this._isAerialPerspectiveLutEnabled=null===(A=null==n?void 0:n.isAerialPerspectiveLutEnabled)||void 0===A||A,this._originHeight=null!==(L=null==n?void 0:n.originHeight)&&void 0!==L?L:0,this._additionalDiffuseSkyIrradianceColor=(null==n?void 0:n.additionalDiffuseSkyIrradianceColor)?(new h.Color3).copyFrom(n.additionalDiffuseSkyIrradianceColor):new h.Color3(163/255,199/255,1),this._groundAlbedo=(null==n?void 0:n.groundAlbedo)?(new h.Color3).copyFrom(n.groundAlbedo):(new h.Color3).set(124/255,165/255,1);var I=this._minimumMultiScatteringColor=(null==n?void 0:n.minimumMultiScatteringColor)?(new h.Color3).copyFrom(n.minimumMultiScatteringColor):new h.Color3(30/255,40/255,77/255);this._skyRenderingGroup=null!==(b=null==n?void 0:n.skyRenderingGroup)&&void 0!==b?b:0,this._aerialPerspectiveRenderingGroup=null!==(E=null==n?void 0:n.aerialPerspectiveRenderingGroup)&&void 0!==E?E:0,this._globeAtmosphereRenderingGroup=null!==(C=null==n?void 0:n.globeAtmosphereRenderingGroup)&&void 0!==C?C:0,this._additionalDiffuseSkyIrradianceColor.scaleToRef(this._additionalDiffuseSkyIrradianceIntensity,this._additionalDiffuseSkyIrradiance),this._minimumMultiScattering.x=I.r*this._minimumMultiScatteringIntensity,this._minimumMultiScattering.y=I.g*this._minimumMultiScatteringIntensity,this._minimumMultiScattering.z=I.b*this._minimumMultiScatteringIntensity;var O=i[0];this._directionToLight.copyFrom(O.direction).scaleInPlace(-1);var D=this._linearLightColor.copyFrom(O.diffuse);this._isLinearSpaceLight||D.toLinearSpaceToRef(D);var N=O.intensity;this._lightRadianceAtCamera.set(N*D.r,N*D.g,N*D.b),this._effectRenderer=new h.EffectRenderer(w,{indices:[0,2,1],positions:[-1,-1,-1,3,3,-1]}),this._transmittanceLut=new W(this),this._multiScatteringLutRenderTarget=K("atmo-multiScattering",{width:32,height:32},t),this._multiScatteringEffectWrapper=Q(w,this.uniformBuffer,this._groundAlbedo),this._isDiffuseSkyIrradianceLutEnabled=null===(x=null==n?void 0:n.isDiffuseSkyIrradianceLutEnabled)||void 0===x||x,this._isDiffuseSkyIrradianceLutEnabled&&(this._diffuseSkyIrradianceLut=new U(this)),this._isSkyViewLutEnabled&&this.skyViewLutRenderTarget,this._isAerialPerspectiveLutEnabled&&this.aerialPerspectiveLutRenderTarget,this._onBeforeRenderObserver=t.onBeforeRenderObservable.add((function(){M.renderGlobalLuts()})),this._onBeforeCameraRenderObserver=t.onBeforeCameraRenderObservable.add((function(e){M._updatePerCameraVariables(e),M._renderLutsForCamera(e)}));var V=t.renderingManager;this._skyRenderingGroup>=0&&V.getRenderingGroup(this._skyRenderingGroup),this._aerialPerspectiveRenderingGroup>=0&&V.getRenderingGroup(this._aerialPerspectiveRenderingGroup),this._globeAtmosphereRenderingGroup>=0&&V.getRenderingGroup(this._globeAtmosphereRenderingGroup),this._onBeforeDrawPhaseObserver=t.onBeforeDrawPhaseObservable.add((function(){M._skyRenderingGroup>=0&&(V.getRenderingGroup(M._skyRenderingGroup)._empty=!1),M._aerialPerspectiveRenderingGroup>=0&&(V.getRenderingGroup(M._aerialPerspectiveRenderingGroup)._empty=!1),M._globeAtmosphereRenderingGroup>=0&&(V.getRenderingGroup(M._globeAtmosphereRenderingGroup)._empty=!1)})),this._onAfterRenderingGroupObserver=t.onAfterRenderingGroupObservable.add((function(e){if(e.renderingManager===t.renderingManager){var i=e.renderingGroupId;M._skyRenderingGroup===i&&M.drawSkyCompositor(),M._aerialPerspectiveRenderingGroup===i&&M.drawAerialPerspectiveCompositor(),M._globeAtmosphereRenderingGroup===i&&M.drawGlobeAtmosphereCompositor()}})),t.onDisposeObservable.addOnce((function(){t.removeExternalData("atmosphere"),M.dispose()})),t.addExternalData("atmosphere",this),(0,h.UnregisterMaterialPlugin)(j),(0,h.RegisterMaterialPlugin)(j,(function(e){return"PBRMaterial"===e.getClassName()?new _(e,M,null===M.depthTexture):null}))}return e.IsSupported=function(e){return!e._badOS&&(e.isWebGPU||e.version>=2)},Object.defineProperty(e.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure=Math.max(0,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multiScatteringIntensity",{get:function(){return this._multiScatteringIntensity},set:function(e){var t;Math.max(0,e)!==this._multiScatteringIntensity&&(this._multiScatteringIntensity=e,null===(t=this._diffuseSkyIrradianceLut)||void 0===t||t.markDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groundAlbedo",{get:function(){return this._groundAlbedo},set:function(e){var t;this._groundAlbedo.equals(e)||(this._groundAlbedo.copyFrom(e),null===(t=this._multiScatteringEffectWrapper)||void 0===t||t.dispose(),this._multiScatteringEffectWrapper=null,this._hasRenderedMultiScatteringLut=!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minimumMultiScatteringColor",{get:function(){return this._minimumMultiScatteringColor},set:function(e){var t;if(!this._minimumMultiScatteringColor.equals(e)){var i=this._minimumMultiScatteringColor.copyFrom(e);this._minimumMultiScattering.x=i.r*this._minimumMultiScatteringIntensity,this._minimumMultiScattering.y=i.g*this._minimumMultiScatteringIntensity,this._minimumMultiScattering.z=i.b*this._minimumMultiScatteringIntensity,null===(t=this._diffuseSkyIrradianceLut)||void 0===t||t.markDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minimumMultiScatteringIntensity",{get:function(){return this._minimumMultiScatteringIntensity},set:function(e){var t;Math.max(0,e)!==this._minimumMultiScatteringIntensity&&(this._minimumMultiScatteringIntensity=e,this._minimumMultiScattering.x=this._minimumMultiScatteringColor.r*e,this._minimumMultiScattering.y=this._minimumMultiScatteringColor.g*e,this._minimumMultiScattering.z=this._minimumMultiScatteringColor.b*e,null===(t=this._diffuseSkyIrradianceLut)||void 0===t||t.markDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"diffuseSkyIrradianceDesaturationFactor",{get:function(){return this._diffuseSkyIrradianceDesaturationFactor},set:function(e){var t,i=Math.max(e,0);i!==this._diffuseSkyIrradianceDesaturationFactor&&(this._diffuseSkyIrradianceDesaturationFactor=i,null===(t=this._diffuseSkyIrradianceLut)||void 0===t||t.markDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"additionalDiffuseSkyIrradianceIntensity",{get:function(){return this._additionalDiffuseSkyIrradianceIntensity},set:function(e){(e=Math.max(0,e))!==this._additionalDiffuseSkyIrradianceIntensity&&(this._additionalDiffuseSkyIrradianceIntensity=e,this._additionalDiffuseSkyIrradianceColor.scaleToRef(e,this._additionalDiffuseSkyIrradiance))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"additionalDiffuseSkyIrradianceColor",{get:function(){return this._additionalDiffuseSkyIrradianceColor},set:function(e){this._additionalDiffuseSkyIrradianceColor.equals(e)||this._additionalDiffuseSkyIrradianceColor.copyFrom(e).scaleToRef(this._additionalDiffuseSkyIrradianceIntensity,this._additionalDiffuseSkyIrradiance)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"additionalDiffuseSkyIrradiance",{get:function(){return this._additionalDiffuseSkyIrradiance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"diffuseSkyIrradianceIntensity",{get:function(){return this._diffuseSkyIrradianceIntensity},set:function(e){this._diffuseSkyIrradianceIntensity=Math.max(e,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSkyViewLutEnabled",{get:function(){return this._isSkyViewLutEnabled},set:function(e){this._isSkyViewLutEnabled=e,this._disposeSkyCompositor(),this._disposeGlobeAtmosphereCompositor()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skyViewLutRenderTarget",{get:function(){if(!this._isSkyViewLutEnabled)return null;if(null!==this._skyViewLutRenderTarget)return this._skyViewLutRenderTarget;var e=this._skyViewLutRenderTarget=K("atmo-skyView",{width:128,height:128},this.scene);return e.coordinatesMode=h.Constants.TEXTURE_EQUIRECTANGULAR_MODE,this._skyViewLutEffectWrapper=ie(this._engine,this.uniformBuffer),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAerialPerspectiveLutEnabled",{get:function(){return this._isAerialPerspectiveLutEnabled},set:function(e){this._isAerialPerspectiveLutEnabled=e,this._disposeAerialPerspectiveCompositor()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aerialPerspectiveLutRenderTarget",{get:function(){if(!this._isAerialPerspectiveLutEnabled)return null;if(null!==this._aerialPerspectiveLutRenderTarget)return this._aerialPerspectiveLutRenderTarget;var e=this.scene,t=this._aerialPerspectiveLutRenderTarget=K("atmo-aerialPerspective",{width:16,height:64,layers:32},e,{});return this._aerialPerspectiveLutEffectWrapper=$(this._engine,this.uniformBuffer),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aerialPerspectiveIntensity",{get:function(){return this._aerialPerspectiveIntensity},set:function(e){if((e=Math.max(.001,e))!==this._aerialPerspectiveIntensity){var t=1===e!=(1===this._aerialPerspectiveIntensity);this._aerialPerspectiveIntensity=e,t&&(this._disposeAerialPerspectiveCompositor(),this._disposeGlobeAtmosphereCompositor())}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aerialPerspectiveTransmittanceScale",{get:function(){return this._aerialPerspectiveTransmittanceScale},set:function(e){(e=Math.max(0,e))!==this._aerialPerspectiveTransmittanceScale&&(this._aerialPerspectiveTransmittanceScale=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aerialPerspectiveSaturation",{get:function(){return this._aerialPerspectiveSaturation},set:function(e){(e=Math.max(0,e))!==this._aerialPerspectiveSaturation&&(this._aerialPerspectiveSaturation=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aerialPerspectiveRadianceBias",{get:function(){return this._aerialPerspectiveRadianceBias},set:function(e){if(e!==this._aerialPerspectiveRadianceBias){var t=0===e!=(0===this._aerialPerspectiveRadianceBias);this._aerialPerspectiveRadianceBias=e,t&&(this._disposeAerialPerspectiveCompositor(),this._disposeGlobeAtmosphereCompositor())}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLinearSpaceComposition",{get:function(){return this._isLinearSpaceComposition},set:function(e){e!==this._isLinearSpaceComposition&&(this._isLinearSpaceComposition=e,this._disposeSkyCompositor(),this._disposeAerialPerspectiveCompositor(),this._disposeGlobeAtmosphereCompositor())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLinearSpaceLight",{get:function(){return this._isLinearSpaceLight},set:function(e){this._isLinearSpaceLight=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transmittanceLut",{get:function(){return this._transmittanceLut},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multiScatteringLutRenderTarget",{get:function(){return this._multiScatteringLutRenderTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"diffuseSkyIrradianceLut",{get:function(){return this._diffuseSkyIrradianceLut},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"physicalProperties",{get:function(){return this._physicalProperties},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"originHeight",{get:function(){return this._originHeight},set:function(e){this._originHeight=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"applyApproximateTransmittance",{get:function(){return this._applyApproximateTransmittance},set:function(e){this._applyApproximateTransmittance!==e&&(this._applyApproximateTransmittance=e,this._disposeSkyCompositor(),this._disposeAerialPerspectiveCompositor(),this._disposeGlobeAtmosphereCompositor())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lights",{get:function(){return this._lights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skyRenderingGroup",{get:function(){return this._skyRenderingGroup},set:function(e){this._skyRenderingGroup=e,this.scene.renderingManager.getRenderingGroup(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aerialPerspectiveRenderingGroup",{get:function(){return this._aerialPerspectiveRenderingGroup},set:function(e){this._aerialPerspectiveRenderingGroup=e,this.scene.renderingManager.getRenderingGroup(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globeAtmosphereRenderingGroup",{get:function(){return this._globeAtmosphereRenderingGroup},set:function(e){this._globeAtmosphereRenderingGroup=e,this.scene.renderingManager.getRenderingGroup(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniformBuffer",{get:function(){if(null===this._atmosphereUbo){var e=this._atmosphereUbo=new h.UniformBuffer(this._engine,void 0,!0,"Atmosphere");e.addUniform("peakRayleighScattering",3),e.addUniform("planetRadius",1),e.addUniform("peakMieScattering",3),e.addUniform("atmosphereThickness",1),e.addUniform("peakMieAbsorption",3),e.addUniform("planetRadiusSquared",1),e.addUniform("peakMieExtinction",3),e.addUniform("atmosphereRadius",1),e.addUniform("peakOzoneAbsorption",3),e.addUniform("atmosphereRadiusSquared",1),e.addUniform("horizonDistanceToAtmosphereEdge",1),e.addUniform("horizonDistanceToAtmosphereEdgeSquared",1),e.addUniform("planetRadiusWithOffset",1),e.addUniform("planetRadiusOffset",1),e.addUniform("atmosphereExposure",1),e.addUniform("aerialPerspectiveRadianceBias",1),e.addUniform("inverseAtmosphereThickness",1),e.addUniform("aerialPerspectiveTransmittanceScale",1),e.addUniform("inverseViewProjectionWithoutTranslation",16),e.addUniform("directionToLight",3),e.addUniform("multiScatteringIntensity",1),e.addUniform("directionToLightRelativeToCameraGeocentricNormal",3),e.addUniform("cameraRadius",1),e.addUniform("lightRadianceAtCamera",3),e.addUniform("diffuseSkyIrradianceDesaturationFactor",1),e.addUniform("groundAlbedo",3),e.addUniform("aerialPerspectiveSaturation",1),e.addUniform("minMultiScattering",3),e.addUniform("diffuseSkyIrradianceIntensity",1),e.addUniform("cameraPositionGlobal",3),e.addUniform("lightIntensity",1),e.addUniform("clampedCameraPositionGlobal",3),e.addUniform("aerialPerspectiveIntensity",1),e.addUniform("cameraGeocentricNormal",3),e.addUniform("clampedCameraRadius",1),e.addUniform("cameraForward",3),e.addUniform("clampedCameraHeight",1),e.addUniform("cameraPosition",3),e.addUniform("cosCameraHorizonAngleFromZenith",1),e.addUniform("viewport",4),e.addUniform("additionalDiffuseSkyIrradiance",3),e.addUniform("cameraHeight",1),e.addUniform("cameraNearPlane",1),e.addUniform("originHeight",1),e.addUniform("sinCameraAtmosphereHorizonAngleFromNadir",1),e.create()}return this._atmosphereUbo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraAtmosphereVariables",{get:function(){return this._cameraAtmosphereVariables},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){var e,t,i,n,r,a,o,s,l,c,u,d,p,m,f,g,v,_,y;null===(e=this._onBeforeCameraRenderObserver)||void 0===e||e.remove(),this._onBeforeCameraRenderObserver=null,null===(t=this._onBeforeDrawPhaseObserver)||void 0===t||t.remove(),this._onBeforeDrawPhaseObserver=null,null===(i=this._onAfterRenderingGroupObserver)||void 0===i||i.remove(),this._onAfterRenderingGroupObserver=null,null===(n=this._onBeforeRenderObserver)||void 0===n||n.remove(),this._onBeforeRenderObserver=null,null===(r=this._globeAtmosphereCompositorEffectWrapper)||void 0===r||r.dispose(),this._globeAtmosphereCompositorEffectWrapper=null,null===(a=this._skyCompositorEffectWrapper)||void 0===a||a.dispose(),this._skyCompositorEffectWrapper=null,null===(o=this._aerialPerspectiveCompositorEffectWrapper)||void 0===o||o.dispose(),this._aerialPerspectiveCompositorEffectWrapper=null,null===(s=this._skyViewLutRenderTarget)||void 0===s||s.dispose(),this._skyViewLutRenderTarget=null,null===(l=this._skyViewLutEffectWrapper)||void 0===l||l.dispose(),this._skyViewLutEffectWrapper=null,null===(c=this._skyViewLutEffectRenderer)||void 0===c||c.dispose(),this._skyViewLutEffectRenderer=null,null===(u=this._aerialPerspectiveLutRenderTarget)||void 0===u||u.dispose(),this._aerialPerspectiveLutRenderTarget=null,null===(d=this._aerialPerspectiveLutEffectWrapper)||void 0===d||d.dispose(),this._aerialPerspectiveLutEffectWrapper=null,null===(p=this._aerialPerspectiveLutEffectRenderer)||void 0===p||p.dispose(),this._aerialPerspectiveLutEffectRenderer=null,null===(m=this._multiScatteringEffectWrapper)||void 0===m||m.dispose(),this._multiScatteringEffectWrapper=null,null===(f=this._multiScatteringLutRenderTarget)||void 0===f||f.dispose(),this._multiScatteringLutRenderTarget=null,null===(g=this._transmittanceLut)||void 0===g||g.dispose(),this._transmittanceLut=null,null===(v=this._diffuseSkyIrradianceLut)||void 0===v||v.dispose(),this._diffuseSkyIrradianceLut=null,null===(_=this._atmosphereUbo)||void 0===_||_.dispose(),this._atmosphereUbo=null,null===(y=this._effectRenderer)||void 0===y||y.dispose(),this._effectRenderer=null,this._atmosphereUniformBufferAsArray.length=0,(0,h.UnregisterMaterialPlugin)(j)},e.prototype.isEnabled=function(){return this._isEnabled},e.prototype.setEnabled=function(e){this._isEnabled=e},e.prototype.getClassName=function(){return"Atmosphere"},e.prototype._drawMultiScatteringLut=function(){var e=this,t=this._transmittanceLut.renderTarget;X(this._engine,this._effectRenderer,this._multiScatteringEffectWrapper,this._multiScatteringLutRenderTarget,(function(i,n,r,a){e.bindUniformBufferToEffect(r),a.bindFramebuffer(n,void 0,void 0,void 0,!0),i.bindBuffers(r),r.setTexture("transmittanceLut",t),i.draw()}))},e.prototype.drawAerialPerspectiveCompositor=function(){var e,t,i,n=this;if(null!==this.depthTexture&&this.isEnabled()){var r=this._engine,a=null!==(e=this._aerialPerspectiveCompositorEffectWrapper)&&void 0!==e?e:this._aerialPerspectiveCompositorEffectWrapper=ee(r,this.uniformBuffer,this._isAerialPerspectiveLutEnabled,this._isSkyViewLutEnabled,this._isLinearSpaceComposition,this._applyApproximateTransmittance,this._aerialPerspectiveIntensity,this._aerialPerspectiveRadianceBias);if(this._isGlobalLutsReady&&!(this._cameraAtmosphereVariables.clampedCameraRadius>this._physicalProperties.atmosphereRadius)){var o=this._isSkyViewLutEnabled?this.skyViewLutRenderTarget:null,s=this._multiScatteringLutRenderTarget,l=this._transmittanceLut.renderTarget,c=this._isAerialPerspectiveLutEnabled?this.aerialPerspectiveLutRenderTarget:null;a.isReady()&&(null===(t=null==o?void 0:o.isReady())||void 0===t||t)&&s.isReady()&&l.isReady()&&(null===(i=null==c?void 0:c.isReady())||void 0===i||i)&&this.depthTexture.isReady()&&X(r,this._effectRenderer,a,null,(function(e,t,i){if(null===n.depthTexture)throw new Error("Depth texture is required for aerial perspective compositor.");n.bindUniformBufferToEffect(i),e.bindBuffers(i),i.setTexture("transmittanceLut",l),i.setTexture("multiScatteringLut",s),n._isSkyViewLutEnabled&&i.setTexture("skyViewLut",o),n._isAerialPerspectiveLutEnabled&&i.setTexture("aerialPerspectiveLut",c),i.setTexture("depthTexture",n.depthTexture),e.draw()}),1,this.applyApproximateTransmittance?h.Constants.ALPHA_PREMULTIPLIED_PORTERDUFF:h.Constants.ALPHA_ONEONE,!0,!1,h.Constants.ALWAYS,!1)}}},e.prototype.drawSkyCompositor=function(){var e,t,i=this;if(this.isEnabled()){var n=this._engine,r=null!==(e=this._skyCompositorEffectWrapper)&&void 0!==e?e:this._skyCompositorEffectWrapper=J(n,this.uniformBuffer,this._isSkyViewLutEnabled,this._isLinearSpaceComposition,this._applyApproximateTransmittance);if(this._isGlobalLutsReady&&!(this._cameraAtmosphereVariables.clampedCameraRadius>this._physicalProperties.atmosphereRadius)&&(null===this.depthTexture||this.depthTexture.isReady())){var a=this._isSkyViewLutEnabled?this.skyViewLutRenderTarget:null,o=this._multiScatteringLutRenderTarget,s=this._transmittanceLut.renderTarget;r.isReady()&&(null===(t=null==a?void 0:a.isReady())||void 0===t||t)&&o.isReady()&&s.isReady()&&X(n,this._effectRenderer,r,null,(function(e,t,n){i.bindUniformBufferToEffect(n),e.bindBuffers(n),n.setTexture("multiScatteringLut",o),n.setTexture("transmittanceLut",s),i._isSkyViewLutEnabled&&n.setTexture("skyViewLut",a),e.draw()}),1,this._applyApproximateTransmittance?h.Constants.ALPHA_PREMULTIPLIED_PORTERDUFF:h.Constants.ALPHA_ONEONE,!0,!1,h.Constants.EQUAL,!1)}}},e.prototype.drawGlobeAtmosphereCompositor=function(){var e,t,i=this;if(this.isEnabled()){var n=this._engine,r=null!==(e=this._globeAtmosphereCompositorEffectWrapper)&&void 0!==e?e:this._globeAtmosphereCompositorEffectWrapper=te(n,this.uniformBuffer,this._isSkyViewLutEnabled,this._isLinearSpaceComposition,this._applyApproximateTransmittance,this._aerialPerspectiveIntensity,this._aerialPerspectiveRadianceBias,null!==this.depthTexture);if(this._isGlobalLutsReady&&this._cameraAtmosphereVariables.clampedCameraRadius>this._physicalProperties.atmosphereRadius){var a=this._isSkyViewLutEnabled?this.skyViewLutRenderTarget:null,o=this._multiScatteringLutRenderTarget,s=this._transmittanceLut.renderTarget;r.isReady()&&(null===(t=null==a?void 0:a.isReady())||void 0===t||t)&&o.isReady()&&s.isReady()&&(null===this.depthTexture||this.depthTexture.isReady())&&X(n,this._effectRenderer,r,null,(function(e,t,n){i.bindUniformBufferToEffect(n),e.bindBuffers(n),n.setTexture("transmittanceLut",s),n.setTexture("multiScatteringLut",o),i._isSkyViewLutEnabled&&n.setTexture("skyViewLut",a),null!==i.depthTexture&&n.setTexture("depthTexture",i.depthTexture),e.draw()}),1,this._applyApproximateTransmittance?h.Constants.ALPHA_PREMULTIPLIED_PORTERDUFF:h.Constants.ALPHA_ONEONE,!0,!1,h.Constants.ALWAYS,!1)}}},e.prototype._disposeSkyCompositor=function(){var e;null===(e=this._skyCompositorEffectWrapper)||void 0===e||e.dispose(),this._skyCompositorEffectWrapper=null},e.prototype._disposeAerialPerspectiveCompositor=function(){var e;null===(e=this._aerialPerspectiveCompositorEffectWrapper)||void 0===e||e.dispose(),this._aerialPerspectiveCompositorEffectWrapper=null},e.prototype._disposeGlobeAtmosphereCompositor=function(){var e;null===(e=this._globeAtmosphereCompositorEffectWrapper)||void 0===e||e.dispose(),this._globeAtmosphereCompositorEffectWrapper=null},Object.defineProperty(e.prototype,"_isGlobalLutsReady",{get:function(){var e;return this._hasEverRenderedMultiScatteringLut&&!!(null===(e=this._transmittanceLut)||void 0===e?void 0:e.hasLutData)&&(!this._isDiffuseSkyIrradianceLutEnabled||this._diffuseSkyIrradianceLut.hasLutData)},enumerable:!1,configurable:!0}),e.prototype._updatePerCameraVariables=function(e){var t=this._lights[0],i=this._directionToLight.copyFrom(t.direction).scaleInPlace(-1),n=this._physicalProperties,r=this._cameraAtmosphereVariables;r.update(e,n.planetRadius,n.planetRadiusWithOffset,n.atmosphereRadius,i,this.originHeight),this._transmittanceLut.updateLightParameters(t,r.clampedCameraRadius,r.cameraGeocentricNormal),this._linearLightColor.copyFrom(t.diffuse),this.getDiffuseSkyIrradianceToRef(i,0,r.cameraGeocentricNormal,t.intensity,this._tempSceneAmbient),this.isLinearSpaceLight||this._tempSceneAmbient.toGammaSpaceToRef(this._tempSceneAmbient),this.scene.ambientColor=this._tempSceneAmbient,this.onAfterUpdateVariablesForCameraObservable.notifyObservers(e)},e.prototype._renderLutsForCamera=function(e){this.onBeforeLightVariablesUpdateObservable.notifyObservers();var t=this.lights[0];this.isLinearSpaceLight||(t.diffuse=t.diffuse.toGammaSpaceToRef(t.diffuse),t.specular=t.specular.toGammaSpaceToRef(t.specular));var i=t.intensity;this._lightRadianceAtCamera.set(i*this._linearLightColor.r,i*this._linearLightColor.g,i*this._linearLightColor.b),this.uniformBuffer.useUbo&&this.updateUniformBuffer();var n=this.isEnabled();this.onBeforeRenderLutsForCameraObservable.notifyObservers(e),n&&!this._transmittanceLut.isDirty&&this._hasRenderedMultiScatteringLut&&(this._isSkyViewLutEnabled&&this._drawSkyViewLut(),this._isAerialPerspectiveLutEnabled&&(this._cameraAtmosphereVariables.clampedCameraRadius<=this._physicalProperties.atmosphereRadius?this._drawAerialPerspectiveLut():this._aerialPerspectiveLutHasBeenRendered||this._clearAerialPerspectiveLut(),this._aerialPerspectiveLutHasBeenRendered=!0)),this.onAfterRenderLutsForCameraObservable.notifyObservers(e)},e.prototype.renderGlobalLuts=function(){var e,t,i,n,r;this.uniformBuffer.useUbo&&this.updateUniformBuffer(),this._transmittanceLut.render()&&(this._hasRenderedMultiScatteringLut=!1,null===(e=this._diffuseSkyIrradianceLut)||void 0===e||e.markDirty()),this._transmittanceLut.isDirty||this._hasRenderedMultiScatteringLut||(null!==(t=this._multiScatteringEffectWrapper)&&void 0!==t||(this._multiScatteringEffectWrapper=Q(this._engine,this.uniformBuffer,this._groundAlbedo)),(null===(i=this._multiScatteringEffectWrapper)||void 0===i?void 0:i.isReady())&&(null===(n=this._multiScatteringLutRenderTarget)||void 0===n?void 0:n.isReady())&&(this._drawMultiScatteringLut(),this._hasRenderedMultiScatteringLut=!0,this._hasEverRenderedMultiScatteringLut=!0)),!this._transmittanceLut.isDirty&&this._hasRenderedMultiScatteringLut&&(null===(r=this._diffuseSkyIrradianceLut)||void 0===r||r.render())},e.prototype.bindUniformBufferToEffect=function(e){var t=this.uniformBuffer,i=1===e.shaderLanguage?"atmosphere":t.name;t.bindToEffect(e,i),t.useUbo?t.update():this.updateUniformBuffer()},e.prototype.updateUniformBuffer=function(){var e=this._physicalProperties,t=this._cameraAtmosphereVariables,i=this.uniformBuffer;i.updateVector3("peakRayleighScattering",e.rayleighScattering),i.updateFloat("planetRadius",e.planetRadius),i.updateVector3("peakMieScattering",e.mieScattering),i.updateFloat("atmosphereThickness",e.atmosphereThickness),i.updateVector3("peakMieAbsorption",e.mieAbsorption),i.updateFloat("planetRadiusSquared",e.planetRadiusSquared),i.updateVector3("peakMieExtinction",e.mieExtinction),i.updateFloat("atmosphereRadius",e.atmosphereRadius),i.updateVector3("peakOzoneAbsorption",e.ozoneAbsorption),i.updateFloat("atmosphereRadiusSquared",e.atmosphereRadiusSquared),i.updateFloat("horizonDistanceToAtmosphereEdge",e.horizonDistanceToAtmosphereEdge),i.updateFloat("horizonDistanceToAtmosphereEdgeSquared",e.horizonDistanceToAtmosphereEdgeSquared),i.updateFloat("planetRadiusWithOffset",e.planetRadiusWithOffset),i.updateFloat("planetRadiusOffset",e.planetRadiusOffset),i.updateFloat("aerialPerspectiveRadianceBias",this._aerialPerspectiveRadianceBias),i.updateFloat("inverseAtmosphereThickness",1/e.atmosphereThickness),i.updateFloat("aerialPerspectiveTransmittanceScale",this._aerialPerspectiveTransmittanceScale),i.updateMatrix("inverseViewProjectionWithoutTranslation",t.inverseViewProjectionMatrixWithoutTranslation),i.updateVector3("directionToLight",this._directionToLight),i.updateFloat("multiScatteringIntensity",this.multiScatteringIntensity),i.updateVector3("directionToLightRelativeToCameraGeocentricNormal",t.directionToLightRelativeToCameraGeocentricNormal),i.updateFloat("cameraRadius",t.cameraRadius),i.updateVector3("lightRadianceAtCamera",this._lightRadianceAtCamera),i.updateFloat("diffuseSkyIrradianceDesaturationFactor",this._diffuseSkyIrradianceDesaturationFactor),i.updateColor3("groundAlbedo",this._groundAlbedo),i.updateFloat("aerialPerspectiveSaturation",this._aerialPerspectiveSaturation),i.updateVector3("minMultiScattering",this._minimumMultiScattering),i.updateFloat("diffuseSkyIrradianceIntensity",this._diffuseSkyIrradianceIntensity),i.updateVector3("cameraPositionGlobal",t.cameraPositionGlobal),i.updateFloat("lightIntensity",this.lights[0].getScaledIntensity()),i.updateVector3("clampedCameraPositionGlobal",t.clampedCameraPositionGlobal),i.updateFloat("aerialPerspectiveIntensity",this._aerialPerspectiveIntensity),i.updateVector3("cameraGeocentricNormal",t.cameraGeocentricNormal),i.updateFloat("clampedCameraRadius",t.clampedCameraRadius),i.updateVector3("cameraForward",t.cameraForward),i.updateFloat("clampedCameraHeight",t.clampedCameraHeight),i.updateVector3("cameraPosition",t.cameraPosition),i.updateFloat("cosCameraHorizonAngleFromZenith",t.cosCameraHorizonAngleFromZenith),i.updateVector4("viewport",t.viewport),i.updateColor3("additionalDiffuseSkyIrradiance",this._additionalDiffuseSkyIrradiance),i.updateFloat("cameraHeight",t.cameraHeight),i.updateFloat("cameraNearPlane",t.cameraNearPlane),i.updateFloat("originHeight",this._originHeight),i.updateFloat("sinCameraAtmosphereHorizonAngleFromNadir",t.sinCameraAtmosphereHorizonAngleFromNadir),i.updateFloat("atmosphereExposure",this._exposure)},e.prototype._drawAerialPerspectiveLut=function(){var e=this,t=this._transmittanceLut.renderTarget,i=this._multiScatteringLutRenderTarget;X(this._engine,this._effectRenderer,this._aerialPerspectiveLutEffectWrapper,this._aerialPerspectiveLutRenderTarget,(function(n,r,a,o){e.bindUniformBufferToEffect(a),a.setTexture("transmittanceLut",t),a.setTexture("multiScatteringLut",i);for(var s=0;s<32;s++)o.bindFramebuffer(r,void 0,void 0,void 0,!0,void 0,s),n.bindBuffers(a),a.setFloat("layerIdx",s),n.draw()}))},e.prototype._clearAerialPerspectiveLut=function(){var e,t=null===(e=this._aerialPerspectiveLutRenderTarget)||void 0===e?void 0:e.renderTarget;if(t)for(var i=this._engine,n={r:0,g:0,b:0,a:0},r=0;r<32;r++)i.bindFramebuffer(t,void 0,void 0,void 0,!0,void 0,r),i.clear(n,!0,!1,!1)},e.prototype._drawSkyViewLut=function(){var e=this,t=this._transmittanceLut.renderTarget,i=this._multiScatteringLutRenderTarget;X(this._engine,this._effectRenderer,this._skyViewLutEffectWrapper,this._skyViewLutRenderTarget,(function(n,r,a,o){e.bindUniformBufferToEffect(a),o.bindFramebuffer(r,void 0,void 0,void 0,!0),n.bindBuffers(a),a.setTexture("transmittanceLut",t),a.setTexture("multiScatteringLut",i),n.draw()}))},e}(),Y=function(e,t,i,n,r,a,o,s,l){var c;void 0===s&&(s=!1);var u=null!==(c=null==o?void 0:o.map((function(e){return"#define ".concat(e)})))&&void 0!==c?c:[];return new h.EffectWrapper({engine:e,name:t,vertexShader:"fullscreenTriangle",fragmentShader:i,attributeNames:["position"],uniformNames:n,uniformBuffers:a,samplerNames:r,defines:u,useShaderStore:!0,shaderLanguage:s?1:0,extraInitializations:l})},Q=function(e,t,i){var r=t.useUbo,a=e.isWebGPU&&!h.EffectWrapper.ForceGLSL,o=a?"atmosphere":t.name,s=["#define POSITION_VEC2"];return i.equals(h.Color3.BlackReadOnly)||s.push("#define USE_GROUND_ALBEDO"),new h.EffectWrapper({engine:e,name:"atmo-multiScattering",vertexShader:"fullscreenTriangle",fragmentShader:"multiScattering",attributeNames:["position"],uniformNames:d(["depth"],r?[]:t.getUniformNames(),!0),uniformBuffers:r?[o]:[],samplerNames:["transmittanceLut"],defines:s,useShaderStore:!0,shaderLanguage:a?1:0,extraInitializations:function(e,t){t.push.apply(t,a?[Promise.resolve().then(n.bind(n,321)),Promise.resolve().then(n.bind(n,255))]:[Promise.resolve().then(n.bind(n,788)),Promise.resolve().then(n.bind(n,264))])}})},K=function(e,t,i,n){var r=i.getEngine().getCaps(),a=r.textureHalfFloatRender?h.Constants.TEXTURETYPE_HALF_FLOAT:r.textureFloatRender?h.Constants.TEXTURETYPE_FLOAT:h.Constants.TEXTURETYPE_UNSIGNED_BYTE,o=l({generateMipMaps:!1,generateDepthBuffer:!1,generateStencilBuffer:!1,gammaSpace:!1,samplingMode:h.Constants.TEXTURE_BILINEAR_SAMPLINGMODE,type:a,format:h.Constants.TEXTUREFORMAT_RGBA},n),s=new h.RenderTargetTexture(e,t,i,o);return s.wrapU=h.Constants.TEXTURE_CLAMP_ADDRESSMODE,s.wrapV=h.Constants.TEXTURE_CLAMP_ADDRESSMODE,s.anisotropicFilteringLevel=1,s.skipInitialClear=!0,s},X=function(e,t,i,n,r,a,o,s,l,c,u){if(void 0===a&&(a=0),void 0===o&&(o=h.Constants.ALPHA_DISABLE),void 0===s&&(s=!0),void 0===c&&(c=h.Constants.LEQUAL),void 0===u&&(u=!0),(null===n||n.isReady())&&(null==i?void 0:i.isReady())){t.saveStates();var d=e.getDepthWrite();void 0!==l&&e.setDepthWrite(l);var p=e.getDepthFunction();e.setDepthFunction(c);var m=e.getAlphaMode();e.setAlphaMode(o,!0);var f=e.depthCullingState.cull;t.setViewport(),t.applyEffectWrapper(i,s),e.depthCullingState.cull=!1;var g=i.effect;g.setFloat("depth",a),r(t,null==n?void 0:n.renderTarget,g,e),e.depthCullingState.cull=f,e.setAlphaMode(m,!0),void 0!==d&&e.setDepthWrite(d),p&&e.setDepthFunction(p),t.restoreStates(),u&&e.restoreDefaultFramebuffer()}},J=function(e,t,i,r,a){var o=t.useUbo,s=e.isWebGPU&&!h.EffectWrapper.ForceGLSL,l=s?"atmosphere":t.name,c=["POSITION_VEC2","COMPUTE_WORLD_RAY"];i&&c.push("USE_SKY_VIEW_LUT"),r||c.push("OUTPUT_TO_SRGB"),a&&c.push("APPLY_TRANSMITTANCE_BLENDING");var u=i?["skyViewLut"]:["transmittanceLut","multiScatteringLut"];return Y(e,"atmo-skyCompositor","compositeSky",d(["depth"],o?[]:t.getUniformNames(),!0),u,o?[l]:[],c,s,(function(e,t){t.push.apply(t,s?[Promise.resolve().then(n.bind(n,321)),Promise.resolve().then(n.bind(n,936))]:[Promise.resolve().then(n.bind(n,788)),Promise.resolve().then(n.bind(n,209))])}))},$=function(e,t){var i=e.isWebGPU&&!h.EffectWrapper.ForceGLSL,r=i?"atmosphere":t.name;return Y(e,"atmo-aerialPerspective","aerialPerspective",d(["layerIdx"],t.useUbo?[]:t.getUniformNames(),!0),["transmittanceLut","multiScatteringLut"],t.useUbo?[r]:[],["POSITION_VEC2","COMPUTE_WORLD_RAY"],i,(function(e,t){t.push.apply(t,i?[Promise.resolve().then(n.bind(n,321)),Promise.resolve().then(n.bind(n,862))]:[Promise.resolve().then(n.bind(n,788)),Promise.resolve().then(n.bind(n,229))])}))},ee=function(e,t,i,r,a,o,s,l){var c=t.useUbo,u=e.isWebGPU&&!h.EffectWrapper.ForceGLSL,p=u?"atmosphere":t.name,m=["POSITION_VEC2","COMPUTE_WORLD_RAY"];i&&m.push("USE_AERIAL_PERSPECTIVE_LUT"),r&&m.push("USE_SKY_VIEW_LUT"),1!==s&&m.push("APPLY_AERIAL_PERSPECTIVE_INTENSITY"),a||m.push("OUTPUT_TO_SRGB"),o&&m.push("APPLY_TRANSMITTANCE_BLENDING"),0!==l&&m.push("APPLY_AERIAL_PERSPECTIVE_RADIANCE_BIAS");var f=["transmittanceLut","multiScatteringLut","depthTexture"];return r&&f.push("skyViewLut"),i&&f.push("aerialPerspectiveLut"),Y(e,"atmo-aerialPerspectiveCompositor","compositeAerialPerspective",d(["depth"],c?[]:t.getUniformNames(),!0),f,c?[p]:[],m,u,(function(e,t){t.push.apply(t,u?[Promise.resolve().then(n.bind(n,321)),Promise.resolve().then(n.bind(n,967))]:[Promise.resolve().then(n.bind(n,788)),Promise.resolve().then(n.bind(n,674))])}))},te=function(e,t,i,r,a,o,s,l){var c=t.useUbo,u=e.isWebGPU&&!h.EffectWrapper.ForceGLSL,p=u?"atmosphere":t.name,m=["POSITION_VEC2","COMPUTE_WORLD_RAY"];i&&m.push("USE_SKY_VIEW_LUT"),1!==o&&m.push("APPLY_AERIAL_PERSPECTIVE_INTENSITY"),r||m.push("OUTPUT_TO_SRGB"),l&&m.push("HAS_DEPTH_TEXTURE"),a&&m.push("APPLY_TRANSMITTANCE_BLENDING"),0!==s&&m.push("APPLY_AERIAL_PERSPECTIVE_RADIANCE_BIAS");var f=["transmittanceLut","multiScatteringLut"];return i&&f.push("skyViewLut"),l&&f.push("depthTexture"),Y(e,"atmo-globeAtmosphereCompositor","compositeGlobeAtmosphere",d(["depth"],c?[]:t.getUniformNames(),!0),f,c?[p]:[],m,u,(function(e,t){t.push.apply(t,u?[Promise.resolve().then(n.bind(n,321)),Promise.resolve().then(n.bind(n,776))]:[Promise.resolve().then(n.bind(n,788)),Promise.resolve().then(n.bind(n,657))])}))},ie=function(e,t){var i=e.isWebGPU&&!h.EffectWrapper.ForceGLSL,r=i?"atmosphere":t.name;return Y(e,"atmo-skyView","skyView",d(["depth"],t.useUbo?[]:t.getUniformNames(),!0),["transmittanceLut","multiScatteringLut"],t.useUbo?[r]:[],["POSITION_VEC2"],i,(function(e,t){t.push.apply(t,i?[Promise.resolve().then(n.bind(n,321)),Promise.resolve().then(n.bind(n,342))]:[Promise.resolve().then(n.bind(n,788)),Promise.resolve().then(n.bind(n,429))])}))},ne=100,re=function(e){return function(t,i){var n=t.getMesh(),r=i.getMesh(),a=n.isHtmlMesh,o=r.isHtmlMesh;return a?o&&n.absolutePosition.z<=r.absolutePosition.z?1:-1:o?1:e(t,i)}},ae=function(){function e(e,t){var i=void 0===t?{}:t,n=i.parentContainerId,r=void 0===n?null:n,a=i._containerId,o=void 0===a?"css-container":a,s=i.enableOverlayRender,l=void 0===s||s,c=i.defaultOpaqueRenderOrder,u=void 0===c?h.RenderingGroup.PainterSortCompare:c,d=i.defaultAlphaTestRenderOrder,p=void 0===d?h.RenderingGroup.PainterSortCompare:d,m=i.defaultTransparentRenderOrder,f=void 0===m?h.RenderingGroup.defaultTransparentSortCompare:m,g=this;this._cache={cameraData:{fov:0,position:new h.Vector3,style:""},htmlMeshData:new WeakMap},this._width=0,this._height=0,this._heightHalf=0,this._temp={scaleTransform:new h.Vector3,rotationTransform:new h.Quaternion,positionTransform:new h.Vector3,objectMatrix:h.Matrix.Identity(),cameraWorldMatrix:h.Matrix.Identity(),cameraRotationMatrix:h.Matrix.Identity(),cameraWorldMatrixAsArray:new Array(16)},this._lastDevicePixelRatio=window.devicePixelRatio,this._cameraMatrixUpdated=!0,this._previousCanvasDocumentPosition={top:0,left:0},this._renderObserver=null,this._onCameraMatrixChanged=function(e){g._cameraWorldMatrix=e.getWorldMatrix(),g._cameraMatrixUpdated=!0},"undefined"!=typeof document&&(this._containerId=o,this._init(e,r,l,u,p,f))}return e.prototype.dispose=function(){var e,t;this._renderObserver&&(this._renderObserver.remove(),this._renderObserver=null),null===(e=this._overlayElements)||void 0===e||e.container.remove(),this._overlayElements=null,null===(t=this._inSceneElements)||void 0===t||t.container.remove(),this._inSceneElements=null},e.prototype._init=function(e,t,i,n,r,a){var o,s=this;if("undefined"!=typeof document){var l=t?document.getElementById(t):document.body;l||(l=document.body);var c="".concat(this._containerId,"_in_scene");if(this._inSceneElements=this._createRenderLayerElements(c),l.insertBefore(this._inSceneElements.container,l.firstChild),i){var u="".concat(this._containerId,"_overlay");this._overlayElements=this._createRenderLayerElements(u);var d=+(null!==(o=e.getEngine().getRenderingCanvas().style.zIndex)&&void 0!==o?o:"0")+1;this._overlayElements.container.style.zIndex="".concat(d),this._overlayElements.container.style.pointerEvents="none",l.insertBefore(this._overlayElements.container,l.firstChild)}this._engine=e.getEngine();var p,h,m=this._engine.getRenderingCanvasClientRect();if(!m)throw new Error("Failed to get client rect for rendering canvas");this._setSize(m.width,m.height),this._engine.onResizeObservable.add((function(){var e=s._engine.getRenderingCanvasClientRect();e&&s._setSize(e.width,e.height)}));var f=function(){var t=e.activeCamera;t&&(p=t.onProjectionMatrixChangedObservable.add((function(){s._onCameraMatrixChanged(t)})),h=t.onViewMatrixChangedObservable.add((function(){s._onCameraMatrixChanged(t)})))};f(),e.onActiveCameraChanged.add((function(){var t,i;p&&(null===(t=e.activeCamera)||void 0===t||t.onProjectionMatrixChangedObservable.remove(p)),h&&(null===(i=e.activeCamera)||void 0===i||i.onViewMatrixChangedObservable.remove(h)),f()}));var g=re(n),v=re(r),_=re(a);e.setRenderingOrder(0,g,v,_),this._renderObserver=e.onBeforeRenderObservable.add((function(){s._render(e,e.activeCamera)}))}},e.prototype._createRenderLayerElements=function(e){var t=document.getElementById(e);t&&t.remove();var i=document.createElement("div");i.id=e,i.style.position="absolute",i.style.width="100%",i.style.height="100%",i.style.zIndex="-1";var n=document.createElement("div");n.style.overflow="hidden";var r=document.createElement("div");return r.style.webkitTransformStyle="preserve-3d",r.style.transformStyle="preserve-3d",r.style.pointerEvents="none",n.appendChild(r),i.appendChild(n),{container:i,domElement:n,cameraElement:r}},e.prototype._getSize=function(){return{width:this._width,height:this._height}},e.prototype._setSize=function(e,t){if(this._width=e,this._height=t,this._heightHalf=this._height/2,this._inSceneElements&&this._overlayElements)for(var i=0,n=[this._inSceneElements.domElement,this._overlayElements.domElement,this._inSceneElements.cameraElement,this._overlayElements.cameraElement];i<n.length;i++){var r=n[i];r&&(r.style.width="".concat(e,"px"),r.style.height="".concat(t,"px"))}},e.prototype._getCameraCssMatrix=function(e){var t=e.m;return"matrix3d(".concat(this._epsilon(t[0]),",").concat(this._epsilon(-t[1]),",").concat(this._epsilon(t[2]),",").concat(this._epsilon(t[3]),",").concat(this._epsilon(t[4]),",").concat(this._epsilon(-t[5]),",").concat(this._epsilon(t[6]),",").concat(this._epsilon(t[7]),",").concat(this._epsilon(t[8]),",").concat(this._epsilon(-t[9]),",").concat(this._epsilon(t[10]),",").concat(this._epsilon(t[11]),",").concat(this._epsilon(t[12]),",").concat(this._epsilon(-t[13]),",").concat(this._epsilon(t[14]),",").concat(this._epsilon(t[15]),")")},e.prototype._getHtmlContentCssMatrix=function(e,t){var i=e.m,n=t?-1:1;return"matrix3d(".concat(this._epsilon(i[0]),",").concat(this._epsilon(i[1]),",").concat(this._epsilon(i[2]*-n),",").concat(this._epsilon(i[3]),",").concat(this._epsilon(-i[4]),",").concat(this._epsilon(-i[5]),",").concat(this._epsilon(i[6]*n),",").concat(this._epsilon(-i[7]),",").concat(this._epsilon(i[8]*-n),",").concat(this._epsilon(i[9]*-n),",").concat(this._epsilon(i[10]),",").concat(this._epsilon(i[11]*n),",").concat(this._epsilon(i[12]*n),",").concat(this._epsilon(i[13]*n),",").concat(this._epsilon(i[14]*n),",").concat(this._epsilon(i[15]),")")},e.prototype._getTransformationMatrix=function(t,i){var n;if(this._cameraWorldMatrix||(this._cameraWorldMatrix=null===(n=t.getScene().activeCamera)||void 0===n?void 0:n.getWorldMatrix()),!this._cameraWorldMatrix)return h.Matrix.Identity();var r=t.getWorldMatrix(),a=1,o=1;t.sourceWidth&&t.sourceHeight&&(a=t.width/(t.sourceWidth/ne),o=t.height/(t.sourceHeight/ne));var s=this._temp.scaleTransform,l=this._temp.rotationTransform,c=this._temp.positionTransform,u=this._temp.objectMatrix;r.decompose(s,l,c),s.x*=a,s.y*=o,h.Matrix.ComposeToRef(s,l,c,u);var d=i?-1:1,p=t.getAbsolutePosition();return u.setRowFromFloats(3,(-this._cameraWorldMatrix.m[12]+p.x)*ne*d,(-this._cameraWorldMatrix.m[13]+p.y)*ne*d,(this._cameraWorldMatrix.m[14]-p.z)*ne,this._cameraWorldMatrix.m[15]*e.PROJECTION_SCALE_FACTOR*ne),u.multiplyAtIndex(3,ne),u.multiplyAtIndex(7,ne),u.multiplyAtIndex(11,ne),u},e.prototype._renderHtmlMesh=function(e,t){var i,n;if(e.element&&e.element.firstElementChild){var r=this._cache.htmlMeshData.get(e);r||(r={style:""},this._cache.htmlMeshData.set(e,r));var a=e._isCanvasOverlay?null===(i=this._overlayElements)||void 0===i?void 0:i.cameraElement:null===(n=this._inSceneElements)||void 0===n?void 0:n.cameraElement;e.element.parentNode!==a&&a.appendChild(e.element),e.requiresUpdate&&this._updateBaseScaleFactor(e);var o=this._getTransformationMatrix(e,t),s="translate(-50%, -50%) ".concat(this._getHtmlContentCssMatrix(o,t));s+="".concat(t?"matrix3d(".concat(e.billboardMode!==h.TransformNode.BILLBOARDMODE_NONE?1:-1,", 0, 0, 0, 0, 1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 1)"):""),r.style!==s&&(e.element.style.webkitTransform=s,e.element.style.transform=s),e._markAsUpdated()}},e.prototype._render=function(e,t){var i,n,r,a,o=!1,s=e.useRightHandedSystem;this._updateContainerPositionIfNeeded(),this._cameraMatrixUpdated&&(this._cameraMatrixUpdated=!1,o=!0),t.position.x===this._cache.cameraData.position.x&&t.position.y===this._cache.cameraData.position.y&&t.position.z===this._cache.cameraData.position.z||(this._cache.cameraData.position.copyFrom(t.position),o=!0),window.devicePixelRatio!==this._lastDevicePixelRatio&&(this._lastDevicePixelRatio=window.devicePixelRatio,h.Logger.Log("In render - dpr changed: ",this._lastDevicePixelRatio),o=!0);var l=e.meshes.filter((function(e){return e.isHtmlMesh&&(o||e.requiresUpdate)}));if(o=o||l.length>0){var c=t.getProjectionMatrix().m[5]*this._heightHalf;if(this._cache.cameraData.fov!==c){var u=[null===(i=this._overlayElements)||void 0===i?void 0:i.domElement,null===(n=this._inSceneElements)||void 0===n?void 0:n.domElement];if(t.mode==h.Camera.PERSPECTIVE_CAMERA)for(var d=0,p=u;d<p.length;d++)(A=p[d])&&(A.style.webkitPerspective=c+"px",A.style.perspective=c+"px");else for(var m=0,f=u;m<f.length;m++)(A=f[m])&&(A.style.webkitPerspective="",A.style.perspective="");this._cache.cameraData.fov=c}null===t.parent&&t.computeWorldMatrix();var g=this._temp.cameraWorldMatrix;g.copyFrom(t.getWorldMatrix());var v=this._temp.cameraRotationMatrix;g.getRotationMatrix().transposeToRef(v);var _=this._temp.cameraWorldMatrixAsArray;g.copyToArray(_);var y=s?1:-1;_[1]=v.m[1],_[2]=v.m[2]*y,_[4]=v.m[4]*y,_[6]=v.m[6]*y,_[8]=v.m[8]*y,_[9]=v.m[9]*y,h.Matrix.FromArrayToRef(_,0,g);var S=this._getCameraCssMatrix(g);if(this._cache.cameraData.style!==S){for(var T=0,P=u=[null===(r=this._inSceneElements)||void 0===r?void 0:r.cameraElement,null===(a=this._overlayElements)||void 0===a?void 0:a.cameraElement];T<P.length;T++){var A;(A=P[T])&&(A.style.webkitTransform=S,A.style.transform=S)}this._cache.cameraData.style=S}for(var L=0,b=l;L<b.length;L++){var R=b[L];this._renderHtmlMesh(R,s)}}},e.prototype._updateBaseScaleFactor=function(e){var t=this._width,i=this._height,n=(e.width||1)/(e.height||1);n>t/i?t=i*n:i=t/n,e.setContentSizePx(t,i)},e.prototype._updateContainerPositionIfNeeded=function(){var e,t,i=this._engine.getRenderingCanvasClientRect();if(i){var n=window.scrollY,r=window.scrollX,a=i.top+n,o=i.left+r;if(this._previousCanvasDocumentPosition.top!==a||this._previousCanvasDocumentPosition.left!==o){this._previousCanvasDocumentPosition.top=a,this._previousCanvasDocumentPosition.left=o;for(var s=0,l=[null===(e=this._inSceneElements)||void 0===e?void 0:e.container,null===(t=this._overlayElements)||void 0===t?void 0:t.container];s<l.length;s++){var c=l[s];if(c){var u=c.offsetParent,d=u.getBoundingClientRect(),p=d.top+n,m=d.left+r,f=this._getAncestorMarginsAndPadding(u),g=window.getComputedStyle(document.body),v=parseInt(g.marginTop,10),_=parseInt(g.marginLeft,10);c.style.top="".concat(a-p-f.marginTop+f.paddingTop+v,"px"),c.style.left="".concat(o-m-f.marginLeft+f.paddingLeft+_,"px")}}}}else h.Logger.Warn("Failed to update html mesh renderer position due to failure to get canvas rect.  HtmlMesh instances may not render correctly")},e.prototype._epsilon=function(e){return Math.abs(e)<1e-10?0:e},e.prototype._getAncestorMarginsAndPadding=function(e){for(var t=0,i=0,n=0,r=0;e&&e!==document.body&&e!==document.documentElement;){var a=window.getComputedStyle(e);t+=parseInt(a.marginTop,10),i+=parseInt(a.marginLeft,10),n+=parseInt(a.paddingTop,10),r+=parseInt(a.paddingLeft,10),e=e.offsetParent}return{marginTop:t,marginLeft:i,paddingTop:n,paddingLeft:r}},e.PROJECTION_SCALE_FACTOR=1e-5,e}(),oe=[],se=new Map,le=[],ce=null,ue=function(e){ge("In pointerEventsCapture.requestRelease - Pointer events release requested for ".concat(e)),e&&e!==ce?de(e)?se.delete(e):(ge("In pointerEventsCapture.requestRelease - Received release request ".concat(e," but no matching capture request was received")),le.includes(e)||le.push(e)):pe()},de=function(e){var t=!1;return oe=oe.filter((function(i){return i!==e||(t=!0,ge("In pointerEventsCapture.cancelRequest - Canceling pointer events capture request ".concat(e)),!1)})),t},pe=function(){var e=fe();ge("In pointerEventsCapture.transferPointerEventsOwnership - Transferrring pointer events from ".concat(ce," to ").concat(e)),he(),e&&me(e)},he=function(){var e;ge("In pointerEventsCapture.doRelease - Releasing pointer events from ".concat(ce)),ce&&(null===(e=se.get(ce))||void 0===e||e.release(),se.delete(ce),ce=null)},me=function(e){var t;e&&(null===(t=se.get(e))||void 0===t||t.capture()),ce=e,ge("In pointerEventsCapture.doCapture - Pointer events now captured by ".concat(e))},fe=function(){return oe.length>0?oe.shift():null},ge=function(e){("undefined"==typeof window||window["pointer-events-capture-debug"])&&h.Tools.Log("".concat(performance.now()," - game.scene.pointerEvents - ").concat(e,"\ncurrentOwner: ").concat(ce,"\nqueue: ").concat(oe,"\nunmatched: ").concat(le))},ve=null,_e=0,ye=new WeakMap,Se=function(e){"undefined"!=typeof document&&(0===_e&&(document.addEventListener("pointermove",Ae),document.addEventListener("touchstart",Ae),ve=null!=ve?ve:e,h.Logger.Log("PointerEventsCaptureBehavior: Starting observation of pointer move events."),ve.onDisposeObservable.add(Te)),_e++)},Te=function(){document.removeEventListener("pointermove",Ae),document.removeEventListener("touchstart",Ae),ve=null,h.Logger.Log("PointerEventsCaptureBehavior: Stopping observation of pointer move events."),_e=0},Pe=function(){"undefined"!=typeof document&&ve&&--_e<=0&&Te()},Ae=function(e){if(ve){var t=ve.getEngine().getRenderingCanvasClientRect();if(t){var i,n="touches"in e?e.touches[0]:e,r=n.clientX,a=n.clientY,o=r-t.left,s=a-t.top,l=ve.pick(o,s,(function(e){var t=ye.get(e);return e.isEnabled()&&void 0!==t&&t._captureOnPointerEnter}));i=l.hit?l.pickedMesh:null;var c=parseInt(ce||"");i&&i.uniqueId===c||(!c||i&&i.uniqueId===c||ue(ce),i&&ye.get(i).capturePointerEvents())}}},Le=function(){function e(e,t,i){var n=(void 0===i?{}:i).captureOnPointerEnter,r=void 0===n||n;this._captureCallback=e,this._releaseCallback=t,this.name="PointerEventsCaptureBehavior",this._attachedMesh=null,this._captureOnPointerEnter=r,"undefined"==typeof document&&h.Logger.Warn("Creating an instance of PointerEventsCaptureBehavior outside of a browser.  The behavior will not work.")}return Object.defineProperty(e.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(e){this._attachedMesh=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attachedNode",{get:function(){return this._attachedMesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureOnPointerEnter",{set:function(e){this._captureOnPointerEnter!==e&&(this._captureOnPointerEnter=e,this._attachedMesh&&(this._captureOnPointerEnter?Se(this._attachedMesh.getScene()):Pe()))},enumerable:!1,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(e){this.attachedMesh=e,ye.set(e,this),this._captureOnPointerEnter&&Se(e.getScene())},e.prototype.detach=function(){this.attachedMesh&&(ye.delete(this.attachedMesh),this._captureOnPointerEnter&&Pe(),this.attachedMesh=null)},e.prototype.dispose=function(){this.detach()},e.prototype.releasePointerEvents=function(){this.attachedMesh&&ue(this.attachedMesh.uniqueId.toString())},e.prototype.capturePointerEvents=function(){var e,t,i;this.attachedMesh&&(e=this.attachedMesh.uniqueId.toString(),t=this._captureCallback,i=this._releaseCallback,ge("In pointerEventsCapture.requestCapture - Pointer events capture requested for ".concat(e)),function(e){var t=!1;return le=le.filter((function(i){return i!==e||(t=!0,!1)})),t}(e)?ge("In pointerEventsCapture.requestCapture - Capture request matched previous release request ".concat(e,".  Cancelling capture request")):(e!==ce&&function(e,t,i){ge("In pointerEventsCapture.enqueueCaptureRequest - Enqueueing capture request for  ".concat(e)),oe.includes(e)||(oe.push(e),se.set(e,{capture:t,release:i}))}(e,t,i),ce||pe()))},e}(),be={CONTAIN:{wrapElement:function(e){var t=document.createElement("div");t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center";var i=document.createElement("div");return i.style.visibility="hidden",i.appendChild(e),t.appendChild(i),t},updateSize:function(e,t,i){var n=e.firstElementChild;e.style.width="".concat(t,"px"),e.style.height="".concat(i,"px");var r=[n.offsetWidth,n.offsetHeight],a=r[0],o=r[1],s=Math.min(t/a,i/o);n.style.transform="scale(".concat(s,")"),n.style.visibility="visible"}},COVER:{wrapElement:function(e){var t=document.createElement("div");t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.overflow="hidden";var i=document.createElement("div");return i.style.visibility="hidden",i.appendChild(e),t.appendChild(i),t},updateSize:function(e,t,i){var n=e.firstElementChild;e.style.width="".concat(t,"px"),e.style.height="".concat(i,"px");var r=[n.offsetWidth,n.offsetHeight],a=r[0],o=r[1],s=Math.max(t/a,i/o);n.style.transform="scale(".concat(s,")"),n.style.visibility="visible"}},STRETCH:{wrapElement:function(e){var t=document.createElement("div");t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center";var i=document.createElement("div");return i.style.visibility="hidden",i.appendChild(e),t.appendChild(i),t},updateSize:function(e,t,i){var n=e.firstElementChild;e.style.width="".concat(t,"px"),e.style.height="".concat(i,"px");var r=[n.offsetWidth,n.offsetHeight],a=r[0],o=r[1];n.style.transform="scale(".concat(t/a,", ").concat(i/o,")"),n.style.visibility="visible"}},NONE:{wrapElement:function(e){return e},updateSize:function(e,t,i){e&&(e.style.width="".concat(t,"px"),e.style.height="".concat(i,"px"))}}},Re=function(e){function t(t,i,n){var r=void 0===n?{}:n,a=r.captureOnPointerEnter,o=void 0===a||a,s=r.isCanvasOverlay,l=void 0!==s&&s,c=r.fitStrategy,u=void 0===c?be.NONE:c,d=e.call(this,i,t)||this;return d._enabled=!1,d._ready=!1,d._isCanvasOverlay=!1,d._requiresUpdate=!0,d._inverseScaleMatrix=null,d._captureOnPointerEnter=!0,d._pointerEventCaptureBehavior=null,d._sourceWidth=null,d._sourceHeight=null,d._fitStrategy=be.NONE,"undefined"==typeof document?(h.Logger.Warn("Creating an instance of an HtmlMesh with id ".concat(i," outside of a browser.  The mesh will not be visible.")),d):(d._fitStrategy=u,d._isCanvasOverlay=l,d._createMask(),d._element=d._createElement(),d.setEnabled(!0),d._captureOnPointerEnter=o,d._pointerEventCaptureBehavior=new Le(d.capturePointerEvents.bind(d),d.releasePointerEvents.bind(d),{captureOnPointerEnter:d._captureOnPointerEnter}),d.addBehavior(d._pointerEventCaptureBehavior),d)}return s(t,e),Object.defineProperty(t.prototype,"isHtmlMesh",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceWidth",{get:function(){return this._sourceWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceHeight",{get:function(){return this._sourceHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"requiresUpdate",{get:function(){return this._requiresUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"captureOnPointerEnter",{set:function(e){this._captureOnPointerEnter=e,this._pointerEventCaptureBehavior&&(this._pointerEventCaptureBehavior.captureOnPointerEnter=e)},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){var t;e.prototype.dispose.call(this),null===(t=this._element)||void 0===t||t.remove(),this._element=void 0,this._pointerEventCaptureBehavior&&(this._pointerEventCaptureBehavior.dispose(),this._pointerEventCaptureBehavior=null)},t.prototype._markAsUpdated=function(){this._requiresUpdate=!1},t.prototype.setContent=function(e,t,i){this._setAsReady(!1),this._sourceWidth=null,this._sourceHeight=null,this._element&&(this._width=t,this._height=i,this._requiresUpdate=!0,this.scaling.setAll(1),e&&(this._element.appendChild(this._fitStrategy.wrapElement(e)),this._updateScaleIfNecessary()),this.sourceWidth&&this.sourceHeight&&this._setAsReady(!0))},t.prototype.setEnabled=function(e){this._enabled=e,e&&!this._ready||this._doSetEnabled(e)},t.prototype.setContentSizePx=function(e,t){this._sourceWidth=e,this._sourceHeight=t,this._element&&this._element.firstElementChild&&(this._fitStrategy.updateSize(this._element.firstElementChild,e,t),this._updateScaleIfNecessary(),this.width&&this.height&&this._setAsReady(!0))},t.prototype._setAsReady=function(e){this._ready=e,e?this._doSetEnabled(this._enabled):this._doSetEnabled(!1)},t.prototype._doSetEnabled=function(t){var i,n=this;this._element&&(t&&!this._worldMatrixUpdateObserver?this._worldMatrixUpdateObserver=this.onAfterWorldMatrixUpdateObservable.add((function(){n._requiresUpdate=!0})):t||(null===(i=this._worldMatrixUpdateObserver)||void 0===i||i.remove(),this._worldMatrixUpdateObserver=null),this._element.style.display=t?"":"none",this._setElementzIndex(-1e4*this.position.z),e.prototype.setEnabled.call(this,t))},t.prototype._updateScaleIfNecessary=function(){this.scaling.setAll(1),this._inverseScaleMatrix&&(this.bakeTransformIntoVertices(this._inverseScaleMatrix),this._inverseScaleMatrix=null);var e=this._width||1,t=this._height||1,i=h.Matrix.Scaling(e,t,1);this.bakeTransformIntoVertices(i),this._inverseScaleMatrix=new h.Matrix,i.invertToRef(this._inverseScaleMatrix)},t.prototype._createMask=function(){(0,h.CreatePlaneVertexData)({width:1,height:1}).applyToMesh(this);var e=this.getScene();this.checkCollisions=!0;var t=new h.StandardMaterial("".concat(this.id,"-mat"),e);this._isCanvasOverlay||(t.backFaceCulling=!1,t.disableColorWrite=!0,t.disableLighting=!0),this.material=t,this.material.freeze()},t.prototype._setElementzIndex=function(e){this._element&&(this._element.style.zIndex="".concat(e))},t.prototype.capturePointerEvents=function(){this._element&&(this._element.style.pointerEvents="auto",document.getElementsByTagName("body")[0].style.pointerEvents="none")},t.prototype.releasePointerEvents=function(){this._element&&(document.getElementsByTagName("body")[0].style.pointerEvents="auto",this._element.style.pointerEvents="none")},t.prototype._createElement=function(){if("undefined"!=typeof document){var e=document.createElement("div");return e.id=this.id,e.style.backgroundColor=this._isCanvasOverlay?"transparent":"#000",e.style.zIndex="1",e.style.position="absolute",e.style.pointerEvents="none",e.style.backfaceVisibility="hidden",e}},t}(h.Mesh);!function(e){e[e.SPACE=32]="SPACE",e[e.TOFU=65532]="TOFU"}(O||(O={}));var Ee,Ce=function(){function e(e,t,i){var n=this;this._chars=new Map,this._kernings=new Map,this._font=JSON.parse(e),this._font.pages=[t],this._font.chars.forEach((function(e){return n._chars.set(e.id,e)})),this._font.kernings.forEach((function(e){var t=n._kernings.get(e.first);t||(t=new Map,n._kernings.set(e.first,t)),t.set(e.second,e.amount)})),this._charsRegex=new RegExp("[".concat(this._font.chars.map((function(e){return e.char.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")})).join(""),"]"),"g"),this._updateFallbacks(),this.scale=1/this._font.info.size,this.textures=this._font.pages.map((function(e){var t=new h.Texture(e,i,{noMipmap:!1,invertY:!1});return t.anisotropicFilteringLevel=16,t}))}return e.prototype.dispose=function(){for(var e=0,t=this.textures;e<t.length;e++)t[e].dispose();this.textures.length=0},e.prototype._updateFallbacks=function(){this._chars.has(O.SPACE)||this._chars.set(O.SPACE,{id:O.SPACE,x:0,y:0,width:0,height:0,xoffset:0,yoffset:0,xadvance:.5*this._font.info.size,page:-1,chnl:-1,index:-1,char:" "}),this._chars.has(O.TOFU)||this._chars.set(O.TOFU,{id:O.TOFU,x:0,y:0,width:this._font.info.size,height:this._font.info.size,xoffset:0,yoffset:0,xadvance:.5*this._font.info.size,page:-1,chnl:-1,index:-1,char:""})},e.prototype._getChar=function(e){return this._chars.get(e)||this._chars.get(O.TOFU)},e.prototype._getKerning=function(e,t){var i;return(null===(i=this._kernings.get(e))||void 0===i?void 0:i.get(t))||0},e.prototype._unsupportedChars=function(e){return e.replace(this._charsRegex,"")},e}(),xe={maxWidth:1/0,lineHeight:1,letterSpacing:1,tabSize:4,whiteSpace:"pre-line",textAlign:"center",translate:{x:-.5,y:-.5}},Me=function(){function e(e,t,i){this.text=e,this.fontAsset=t,this.options=l(l({},xe),i);var n=this.options.customLayoutEngine?this.options.customLayoutEngine(e,this.options):this._computeMetrics(e),r=n.paragraph,a=n.lines,o=n.glyphs,s=n.width,c=n.height;this.paragraph=r,this.lines=a,this.glyphs=o,this.width=s,this.height=c}return Object.defineProperty(e.prototype,"lineHeight",{get:function(){return this.fontAsset._font.common.lineHeight*this.options.lineHeight},enumerable:!1,configurable:!0}),e.prototype._computeMetrics=function(e){for(var t=this,i=this._collapse(e),n=this._breakLines(i).map((function(e){return e.trim()})),r=[],a=0,o=n;a<o.length;a++){var s=o[a];r.push.apply(r,this._wrap(s,r.length))}var l=Math.max.apply(Math,r.map((function(e){return e.width}))),c=this.lineHeight*r.length;("left"!==this.options.textAlign||this.options.translate)&&r.forEach((function(e){for(var i=function(){switch(t.options.textAlign){case"right":return l-e.width;case"center":return(l-e.width)/2;default:return 0}}(),n=t.options.translate?t.options.translate.x*l:0,r=t.options.translate?t.options.translate.y*c:0,a=0,o=e.glyphs;a<o.length;a++){var s=o[a];s.x+=i,s.x+=n,s.y+=r}}));var u=r.flatMap((function(e){return e.glyphs}));return{paragraph:n.join("\n"),lines:r,glyphs:u,width:l,height:c}},e.prototype._breakLines=function(e){return e.split("\n")},e.prototype._collapse=function(e){return e.replace(/\t/g," ".repeat(this.options.tabSize)).replace(/ +/g," ")},e.prototype._wrap=function(e,t){void 0===t&&(t=0);for(var i,n=new Array,r=t,a=new Array,o=0,s=0,l=0,c=l,u=function(){n.push({text:e.slice(l,c),glyphs:a,start:l,end:c,width:s})};c<e.length;){var d=c,p=e.charCodeAt(d),h=this.fontAsset._getChar(p),m=h.width,f=(o+=i?this.fontAsset._getKerning(i.id,h.id):0)+m,g=h.xadvance+this.options.letterSpacing,v=o+g,_=v>this.options.maxWidth||f>this.options.maxWidth;_&&(u(),r++,i=void 0,o=0,s=0,c=(l=c)+1,a=[]);var y=o,S=r*this.lineHeight;a.push({char:h,line:r,position:a.length,x:y,y:S}),_?o=g:(i=h,o=v,s=f,c++)}return a.length>0&&u(),n},e}(),we=function(){function e(e,t,i){void 0===t&&(t=0),this._useVAO=!1,this._vertexBuffers={},this._charMatrices=new Array,this._charUvs=new Array,this._isDirty=!0,this._baseLine=0,this._scalingMatrix=new h.ThinMatrix,this._fontScaleMatrix=new h.ThinMatrix,this._offsetMatrix=new h.ThinMatrix,this._translationMatrix=new h.ThinMatrix,this._baseMatrix=new h.ThinMatrix,this._scaledMatrix=new h.ThinMatrix,this._localMatrix=new h.ThinMatrix,this._finalMatrix=new h.ThinMatrix,this._lineMatrix=new h.ThinMatrix,this._parentWorldMatrix=new h.ThinMatrix,this.color={r:1,g:1,b:1,a:1},this.strokeColor={r:1,g:1,b:1,a:1},this.strokeInsetWidth=0,this.strokeOutsetWidth=0,this.thicknessControl=0,this._parent=null,this._transformMatrix=new h.ThinMatrix,this.isBillboard=!1,this.isBillboardScreenProjected=!1,this.ignoreDepthBuffer=!1,this._engine=e,this._shaderLanguage=t,this._font=i,this._baseLine=i._font.common.lineHeight*i.scale,this._useVAO=e.getCaps().vertexArrayObject&&!e.disableVertexArrayObjects;var n=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new h.Buffer(e,n,!1,2),this._vertexBuffers.offsets=this._spriteBuffer.createVertexBuffer("offsets",0,2),this._resizeBuffers(128)}return Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformMatrix",{get:function(){return this._transformMatrix},set:function(e){this._transformMatrix=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"characterCount",{get:function(){return this._charMatrices.length/16},enumerable:!1,configurable:!0}),e.prototype._resizeBuffers=function(e){this._worldBuffer&&(this._worldBuffer.dispose(),this._worldBuffer=null),this._uvBuffer&&(this._uvBuffer.dispose(),this._uvBuffer=null),this._worldBuffer=new h.Buffer(this._engine,new Float32Array(16*e),!0,16),this._vertexBuffers.world0=this._worldBuffer.createVertexBuffer("world0",0,4,16,!0),this._vertexBuffers.world1=this._worldBuffer.createVertexBuffer("world1",4,4,16,!0),this._vertexBuffers.world2=this._worldBuffer.createVertexBuffer("world2",8,4,16,!0),this._vertexBuffers.world3=this._worldBuffer.createVertexBuffer("world3",12,4,16,!0),this._uvBuffer=new h.Buffer(this._engine,new Float32Array(4*e),!0,4),this._vertexBuffers.uvs=this._uvBuffer.createVertexBuffer("uvs",0,4,4,!0)},e.prototype._setShaders=function(e,t){var i;null===(i=this._drawWrapperBase)||void 0===i||i.dispose(),this._drawWrapperBase=new h.DrawWrapper(this._engine),this._drawWrapperBase.drawContext&&(this._drawWrapperBase.drawContext.useInstancing=!0),this._drawWrapperBase.effect=this._engine.createEffect({vertexSource:e,fragmentSource:t},["offsets","world0","world1","world2","world3","uvs"],["parentWorld","view","projection","uColor","thickness","uStrokeColor","uStrokeInsetWidth","uStrokeOutsetWidth","mode","transform"],["fontAtlas"],"",void 0,void 0,void 0,void 0,this._shaderLanguage),this._drawWrapperBase.effect._refCount++},e.prototype.addParagraph=function(e,t,i){var n=this,r=new Me(e,this._font,t),a=this._font.scale,o=this._font._font.common.scaleW,s=this._font._font.common.scaleH,l=r.glyphs.filter((function(e){return e.char.page>=0})),c=i;if(!c){var u=r.lineHeight*a,d=r.lines.length*u/2;(0,h.TranslationMatrixToRef)(0,this._baseLine-d,0,this._lineMatrix),c=this._lineMatrix}(0,h.ScalingMatrixToRef)(a,a,1,this._fontScaleMatrix),(0,h.TranslationMatrixToRef)(.5,-.5,0,this._offsetMatrix);var p=this._charUvs.length,m=this._charMatrices.length;l.forEach((function(e,t){n._charUvs[p+4*t+0]=e.char.x/o,n._charUvs[p+4*t+1]=e.char.y/s,n._charUvs[p+4*t+2]=e.char.width/o,n._charUvs[p+4*t+3]=e.char.height/s;var i=e.x+e.char.xoffset,r=1-(e.y+e.char.yoffset);(0,h.ScalingMatrixToRef)(e.char.width,e.char.height,1,n._scalingMatrix),(0,h.MultiplyMatricesToRef)(n._offsetMatrix,n._scalingMatrix,n._baseMatrix),(0,h.TranslationMatrixToRef)(i*a,r*a,0,n._translationMatrix),(0,h.MultiplyMatricesToRef)(n._baseMatrix,n._fontScaleMatrix,n._scaledMatrix),(0,h.MultiplyMatricesToRef)(n._scaledMatrix,n._translationMatrix,n._localMatrix),(0,h.MultiplyMatricesToRef)(n._localMatrix,c,n._finalMatrix),(0,h.CopyMatrixToArray)(n._finalMatrix,n._charMatrices,m+16*t)})),this._isDirty=!0,this._baseLine-=r.lineHeight*a*r.lines.length},e.prototype.render=function(e,t){var i=this._drawWrapperBase,n=i.effect;if(n.isReady()){var r=this._engine;r.setState(!1),r.enableEffect(i),this.ignoreDepthBuffer&&r.setDepthBuffer(!1),this._parent?(0,h.CopyMatrixToRef)(this._parent.getWorldMatrix(),this._parentWorldMatrix):(0,h.IdentityMatrixToRef)(this._parentWorldMatrix),n.setInt("mode",this.isBillboard?this.isBillboardScreenProjected?2:1:0),n.setMatrix("parentWorld",this._parentWorldMatrix),n.setMatrix("view",e),n.setMatrix("projection",t),n.setMatrix("transform",this.transformMatrix),n.setTexture("fontAtlas",this._font.textures[0]),n.setDirectColor4("uColor",this.color),n.setDirectColor4("uStrokeColor",this.strokeColor),n.setFloat("thickness",.9*this.thicknessControl),n.setFloat("uStrokeInsetWidth",this.strokeInsetWidth),n.setFloat("uStrokeOutsetWidth",this.strokeOutsetWidth);var a=this._charMatrices.length/16;this._isDirty&&(this._isDirty=!1,this._worldBuffer.getBuffer().capacity/4<16*a&&this._resizeBuffers(a),this._worldBuffer.update(this._charMatrices),this._uvBuffer.update(this._charUvs)),this._useVAO?(this._vertexArrayObject||(this._vertexArrayObject=r.recordVertexArrayObject(this._vertexBuffers,null,n)),r.bindVertexArrayObject(this._vertexArrayObject,null)):r.bindBuffers(this._vertexBuffers,null,n),r.setAlphaMode(h.Constants.ALPHA_COMBINE),r.drawArraysType(h.Constants.MATERIAL_TriangleStripDrawMode,0,4,a),r.unbindInstanceAttributes(),r.setAlphaMode(h.Constants.ALPHA_DISABLE),this.ignoreDepthBuffer&&r.setDepthBuffer(!0)}},e.prototype.dispose=function(){this._worldBuffer&&(this._worldBuffer.dispose(),this._worldBuffer=null),this._uvBuffer&&(this._uvBuffer.dispose(),this._uvBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null)},e.CreateTextRendererAsync=function(t,i){return c(this,void 0,void 0,(function(){var r,a,o,s;return u(this,(function(l){switch(l.label){case 0:if(!i.getCaps().instancedArrays||!i._features.supportSpriteInstancing)throw new Error("Instanced arrays are required for MSDF text rendering.");return r=0,a="",o="",i.isWebGPU?(r=1,[4,Promise.resolve().then(n.bind(n,681))]):[3,3];case 1:return a=l.sent().msdfVertexShaderWGSL.shader,[4,Promise.resolve().then(n.bind(n,115))];case 2:return o=l.sent().msdfPixelShaderWGSL.shader,[3,6];case 3:return[4,Promise.resolve().then(n.bind(n,36))];case 4:return a=l.sent().msdfVertexShader.shader,[4,Promise.resolve().then(n.bind(n,370))];case 5:o=l.sent().msdfPixelShader.shader,l.label=6;case 6:return(s=new e(i,r,t))._setShaders(a,o),[2,s]}}))}))},e}(),Ie=n(36),Oe=n(370),De=n(681),Ne=n(115);function Ve(){if(!Ee)throw new Error("Recast is not initialized. Please call InitRecast first.");return Ee}var Ue=null;function Fe(e){return c(this,void 0,void 0,(function(){var t,i,n,r;return u(this,(function(a){switch(a.label){case 0:return t=null!==(r=null==e?void 0:e.version)&&void 0!==r?r:"0.43.0",i=l({url:"https://unpkg.com/@recast-navigation",version:t},e),Ee?[2]:Ue?[4,Ue]:[3,2];case 1:return a.sent(),[2];case 2:return i.instance?(Ee=i.instance,[3,6]):[3,3];case 3:return Ue=function(e,t){return c(this,void 0,void 0,(function(){var i,n;return u(this,(function(r){switch(r.label){case 0:return i={imports:{"@recast-navigation/core":"".concat(e,"/core@").concat(t,"/dist/index.mjs"),"@recast-navigation/wasm":"".concat(e,"/wasm@").concat(t,"/dist/recast-navigation.wasm-compat.js"),"@recast-navigation/generators":"".concat(e,"/generators@").concat(t,"/dist/index.mjs")}},(n=document.createElement("script")).type="importmap",n.textContent=JSON.stringify(i),document.body.appendChild(n),[4,(0,h._LoadScriptModuleAsync)("\n                import * as CoreModule from '".concat(e,"/core@").concat(t,"/dist/index.mjs';\n                import * as GeneratorsModule from '").concat(e,"/generators@").concat(t,"/dist/index.mjs';\n                const returnedValue =  {core: CoreModule, generators: GeneratorsModule};\n            "))];case 1:return[2,r.sent()]}}))}))}(i.url,i.version),[4,Ue];case 4:return n=a.sent(),[4,(Ee=l(l({},n.core),n.generators)).init()];case 5:a.sent(),a.label=6;case 6:return[2]}}))}))}function ze(e,t,i){return void 0===e&&(e=[]),void 0===t&&(t=0),void 0===i&&(i=1),new(Ve().TileCacheMeshProcess)((function(n,r,a){for(var o=0;o<n.polyCount();++o)r.set(o,t),a.set(o,i);e.length>0&&n.setOffMeshConnections(e)}))}function ke(e,t){for(var i=!1;!i;)i=t.update(e).upToDate}var Ge=128;function Be(e){return je(e)}function He(e){var t;return l(l({},Be(e)),{tileSize:null!==(t=e.tileSize)&&void 0!==t?t:32})}function We(e){var t,i,n=l(l({},He(e)),{expectedLayersPerTile:null!==(t=e.expectedLayersPerTile)&&void 0!==t?t:1,maxObstacles:null!==(i=e.maxObstacles)&&void 0!==i?i:Ge});return e.tileCacheMeshProcess?n.tileCacheMeshProcess=e.tileCacheMeshProcess:e.offMeshConnections&&(h.Logger.Warn("offMeshConnections are required but no tileCacheMeshProcess is set. Using fallback DefaultTileCacheMeshProcess."),n.tileCacheMeshProcess=ze(e.offMeshConnections)),n}function je(e){return Object.fromEntries(Object.entries(e).filter((function(e){return e[0],void 0!==e[1]})))}function qe(e){return Object.fromEntries(Object.entries(e).filter((function(e){return e[0],void 0!==e[1]})))}var Ze=function(){function e(e,t,i,n){var r=this;if(this._transforms=[],this._agents=[],this._reachRadii=[],this._agentDestinationArmed=new Array,this._agentDestination=new Array,this._onBeforeAnimationsObserver=null,this.onReachTargetObservable=new h.Observable,this._navigationPlugin=e,!e.navMesh)throw new Error("There is no NavMesh generated.");this._recastCrowd=new(Ve().Crowd)(e.navMesh,{maxAgents:t,maxAgentRadius:i}),this._scene=n,this._engine=n.getEngine(),this._onBeforeAnimationsObserver=n.onBeforeAnimationsObservable.add((function(){r.update(.001*r._engine.getDeltaTime()*e.timeFactor)}))}return Object.defineProperty(e.prototype,"navigationPlugin",{get:function(){return this._navigationPlugin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"recastCrowd",{get:function(){return this._recastCrowd},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transforms",{get:function(){return this._transforms},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"agents",{get:function(){return Object.freeze(this._agents)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reachRadii",{get:function(){return Object.freeze(this._reachRadii)},enumerable:!1,configurable:!0}),e.prototype.addAgent=function(e,t,i){var n=qe(t),r=this._recastCrowd.addAgent({x:e.x,y:e.y,z:e.z},n);return this._transforms.push(i),this._agents.push(r.agentIndex),this._reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new h.Vector3(0,0,0)),r.agentIndex},e.prototype.getAgentPosition=function(e){var t,i,n=null!==(i=null===(t=this._recastCrowd.getAgent(e))||void 0===t?void 0:t.position())&&void 0!==i?i:h.Vector3.ZeroReadOnly;return new h.Vector3(n.x,n.y,n.z)},e.prototype.getAgentPositionToRef=function(e,t){var i,n,r=null!==(n=null===(i=this._recastCrowd.getAgent(e))||void 0===i?void 0:i.position())&&void 0!==n?n:h.Vector3.ZeroReadOnly;t.set(r.x,r.y,r.z)},e.prototype.getAgentVelocity=function(e){var t,i,n=null!==(i=null===(t=this._recastCrowd.getAgent(e))||void 0===t?void 0:t.velocity())&&void 0!==i?i:h.Vector3.ZeroReadOnly;return new h.Vector3(n.x,n.y,n.z)},e.prototype.getAgentVelocityToRef=function(e,t){var i,n,r=null!==(n=null===(i=this._recastCrowd.getAgent(e))||void 0===i?void 0:i.velocity())&&void 0!==n?n:h.Vector3.ZeroReadOnly;t.set(r.x,r.y,r.z)},e.prototype.getAgentNextTargetPath=function(e){var t,i,n=null!==(i=null===(t=this._recastCrowd.getAgent(e))||void 0===t?void 0:t.nextTargetInPath())&&void 0!==i?i:h.Vector3.ZeroReadOnly;return new h.Vector3(n.x,n.y,n.z)},e.prototype.getAgentNextTargetPathToRef=function(e,t){var i,n,r=null!==(n=null===(i=this._recastCrowd.getAgent(e))||void 0===i?void 0:i.nextTargetInPath())&&void 0!==n?n:h.Vector3.ZeroReadOnly;t.set(r.x,r.y,r.z)},e.prototype.getAgentState=function(e){var t,i;return null!==(i=null===(t=this._recastCrowd.getAgent(e))||void 0===t?void 0:t.state())&&void 0!==i?i:0},e.prototype.overOffmeshConnection=function(e){var t,i;return null!==(i=null===(t=this._recastCrowd.getAgent(e))||void 0===t?void 0:t.overOffMeshConnection())&&void 0!==i&&i},e.prototype.agentGoto=function(e,t){var i;null===(i=this._recastCrowd.getAgent(e))||void 0===i||i.requestMoveTarget(t);var n=this._agents.indexOf(e);n>-1&&(this._agentDestinationArmed[n]=!0,this._agentDestination[n].set(t.x,t.y,t.z))},e.prototype.agentTeleport=function(e,t){var i;null===(i=this._recastCrowd.getAgent(e))||void 0===i||i.teleport(t)},e.prototype.updateAgentParameters=function(e,t){var i=this._recastCrowd.getAgent(e);if(i){var n=i.parameters();n&&(void 0!==t.radius&&(n.radius=t.radius),void 0!==t.height&&(n.height=t.height),void 0!==t.maxAcceleration&&(n.maxAcceleration=t.maxAcceleration),void 0!==t.maxSpeed&&(n.maxSpeed=t.maxSpeed),void 0!==t.collisionQueryRange&&(n.collisionQueryRange=t.collisionQueryRange),void 0!==t.pathOptimizationRange&&(n.pathOptimizationRange=t.pathOptimizationRange),void 0!==t.separationWeight&&(n.separationWeight=t.separationWeight),i.updateParameters(n))}},e.prototype.removeAgent=function(e){this._recastCrowd.removeAgent(e);var t=this._agents.indexOf(e);t>-1&&(this._agents.splice(t,1),this._transforms.splice(t,1),this._reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))},e.prototype.getAgents=function(){return this._agents},e.prototype.update=function(e){if(!(e<=h.Epsilon)){var t=this._navigationPlugin.getTimeStep(),i=this._navigationPlugin.getMaximumSubStepCount();if(t<=h.Epsilon)this._recastCrowd.update(e);else{var n=Math.floor(e/t);i&&n>i&&(n=i),n<1&&(n=1);for(var r=e/n,a=0;a<n;a++)this._recastCrowd.update(r)}for(var o=0;o<this._agents.length;o++){var s=this._agents[o],l=this.getAgentPosition(s);if(this._transforms[o].position=l,this._agentDestinationArmed[o]){var c=l.x-this._agentDestination[o].x,u=l.z-this._agentDestination[o].z,d=this._reachRadii[o],p=this._agentDestination[o].y-this._reachRadii[o],m=this._agentDestination[o].y+this._reachRadii[o],f=c*c+u*u;l.y>p&&l.y<m&&f<d*d&&(this._agentDestinationArmed[o]=!1,this.onReachTargetObservable.notifyObservers({agentIndex:s,destination:this._agentDestination[o]}))}}}},e.prototype.setDefaultQueryExtent=function(e){this._navigationPlugin.setDefaultQueryExtent(e)},e.prototype.getDefaultQueryExtent=function(){var e=this._navigationPlugin.getDefaultQueryExtent();return new h.Vector3(e.x,e.y,e.z)},e.prototype.getDefaultQueryExtentToRef=function(e){var t=this._navigationPlugin.getDefaultQueryExtent();e.set(t.x,t.y,t.z)},e.prototype.getCorners=function(e){var t,i=null===(t=this._recastCrowd.getAgent(e))||void 0===t?void 0:t.corners();if(!i)return[];for(var n=[],r=0;r<i.length;r++)n.push(new h.Vector3(i[r].x,i[r].y,i[r].z));return n},e.prototype.dispose=function(){this._recastCrowd.destroy(),this._onBeforeAnimationsObserver&&(this._scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null),this.onReachTargetObservable.clear()},e}();function Ye(e){var t=[];if(e.success)for(var i=e.path.length,n=0;n<i;n++){var r=e.path[n];t.push(new h.Vector3(r.x,r.y,r.z))}else h.Logger.Warn("Unable to convert navigation path point, because navPath generation has failed.");return t}var Qe={START_NEAREST_POLY_FAILED:"START_NEAREST_POLY_FAILED",END_NEAREST_POLY_FAILED:"END_NEAREST_POLY_FAILED",FIND_PATH_FAILED:"FIND_PATH_FAILED",NO_POLYGON_PATH_FOUND:"NO_POLYGON_PATH_FOUND",NO_CLOSEST_POINT_ON_LAST_POLYGON_FOUND:"NO_CLOSEST_POINT_ON_LAST_POLYGON_FOUND"},Ke=new h.Vector3,Xe=new h.Vector3;function Je(e,t,i,n,r){return Ye(function(e,t,i,n,r){var a,o,s,l,c,u,d=Ve(),p=null!==(a=null==r?void 0:r.filter)&&void 0!==a?a:t.defaultFilter,m=null!==(o=null==r?void 0:r.halfExtents)&&void 0!==o?o:t.defaultQueryHalfExtents,f=null!==(s=null==r?void 0:r.maxSmoothPathPoints)&&void 0!==s?s:2048,g=null!==(l=null==r?void 0:r.maxPathPolys)&&void 0!==l?l:256,v=null!==(c=null==r?void 0:r.stepSize)&&void 0!==c?c:.5,_=null!==(u=null==r?void 0:r.slop)&&void 0!==u?u:.01,y=t.findNearestPoly(i,{filter:p,halfExtents:m});if(!y.success)return{success:!1,error:{type:Qe.START_NEAREST_POLY_FAILED,status:y.status},path:[]};var S=t.findNearestPoly(n,{filter:p,halfExtents:m});if(!S.success)return{success:!1,error:{type:Qe.END_NEAREST_POLY_FAILED,status:S.status},path:[]};var T=y.nearestRef,P=S.nearestRef,A=t.findPath(T,P,i,n,{filter:p,maxPathPolys:g});if(!A.success)return{success:!1,error:{type:Qe.FIND_PATH_FAILED,status:A.status},path:[]};if(A.polys.size<=0)return{success:!1,error:{type:Qe.NO_POLYGON_PATH_FOUND},path:[]};var L=A.polys.get(A.polys.size-1),b=n;if(L!==P){var R=t.closestPointOnPoly(L,n);if(!R.success)return{success:!1,error:{type:Qe.NO_CLOSEST_POINT_ON_LAST_POLYGON_FOUND,status:R.status},path:[]};b=R.closestPoint}var E=new h.Vector3(i.x,i.y,i.z),C=new h.Vector3(b.x,b.y,b.z),x=Array.from(A.polys.getHeapView()),M=[];for(M.push(E.clone());x.length>0&&M.length<f;){var w=$e(t,E,C,_,x,d);if(!w.success)break;var I=w.steerPosFlag&d.Detour.DT_STRAIGHTPATH_END,O=w.steerPosFlag&d.Detour.DT_STRAIGHTPATH_OFFMESH_CONNECTION,D=w.steerPos,N=Ke.copyFrom(D).subtract(E),V=Math.sqrt(N.dot(N));V=(I||O)&&V<v?1:v/V;var U=Xe.copyFrom(E).addInPlace(N.scale(V)),F=t.moveAlongSurface(x[0],E,U,{filter:p,maxVisitedSize:16});if(!F.success)break;var z=F.resultPosition;tt(x,g,F.visited),it(x,e,d);var k=t.getPolyHeight(x[0],z);if(k.success&&(z.y=k.height),E.copyFromFloats(z.x,z.y,z.z),I&&et(E,w.steerPos,_,1)){E.copyFrom(C),M.length<f&&M.push(new h.Vector3(E.x,E.y,E.z));break}if(O&&et(E,w.steerPos,_,1)){for(var G=w.steerPosRef,B=0,H=x[0],W=0;W<x.length&&H!==G;)B=H,H=x[W],W++;for(var j=W;j<x.length;j++)x[j-W]=x[j];x.splice(W,x.length-W);var q=e.getOffMeshConnectionPolyEndPoints(B,H);if(q.success&&M.length<f){M.push(new h.Vector3(E.x,E.y,E.z)),1&M.length&&M.push(new h.Vector3(E.x,E.y,E.z)),E.copyFromFloats(q.end.x,q.end.y,q.end.z);var Z=t.getPolyHeight(x[0],E);Z.success&&(E.y=Z.height)}}M.length<f&&M.push(new h.Vector3(E.x,E.y,E.z))}return{success:!0,path:M}}(e,t,i,n,r))}function $e(e,t,i,n,r,a){var o=e.findStraightPath(t,i,r,{maxStraightPathPoints:3});if(!o.success)return{success:!1};for(var s=[],l=0;l<o.straightPathCount;l++){var c=new h.Vector3(o.straightPath.get(3*l),o.straightPath.get(3*l+1),o.straightPath.get(3*l+2));s.push(c)}for(var u=0;u<s.length&&!(o.straightPathFlags.get(u)&a.Detour.DT_STRAIGHTPATH_OFFMESH_CONNECTION)&&et(s[u],t,n,1e3);)u++;return u>=o.straightPathCount?{success:!1}:{success:!0,steerPos:s[u],steerPosFlag:o.straightPathFlags.get(u),steerPosRef:o.straightPathRefs.get(u),points:s}}function et(e,t,i,n){var r=t.x-e.x,a=t.y-e.y,o=t.z-e.z;return r*r+o*o<i&&Math.abs(a)<n}function tt(e,t,i){for(var n=-1,r=-1,a=e.length-1;a>=0;a--){for(var o=!1,s=i.length-1;s>=0;s--)e[a]===i[s]&&(n=a,r=s,o=!0);if(o)break}if(-1===n||-1===r)return e;var l=i.length-r,c=Math.min(n+1,e.length),u=Math.max(0,e.length-c);for(l+u>t&&(u=t-l),u&&e.splice.apply(e,d([l,u],e.slice(c,c+u),!1)),a=0;a<l;a++)e[a]=i[i.length-(1+a)];return e}function it(e,t,i){if(!(e.length<3)){var n=0,r=[],a=t.getTileAndPolyByRef(e[0]);if(a.success){for(var o=a.poly,s=a.tile,l=o.firstLink();l!==i.Detour.DT_NULL_LINK;l=s.links(l).next()){var c=s.links(l);0!==c.ref()&&n<16&&(r.push(c.ref()),n++)}for(var u=0,d=Math.min(6,e.length)-1;d>1&&0===u;d--)for(var p=0;p<n;p++)if(e[d]===r[p]){u=d;break}u>1&&e.splice(1,u-1)}}}function nt(e,t){var i,n,r,a=0,o=[],s=[];for(i=0;i<e.length;i++)if(e[i]){var l=e[i],c=(null==t?void 0:t.doNotReverseIndices)?l.getIndices(!1,!0):rt(l);if(!c)continue;var u=l.getVerticesData(h.VertexBuffer.PositionKind,!1,!1);if(!u)continue;var d=[],p=l.computeWorldMatrix(!0);if(l.hasThinInstances)for(var m=l.thinInstanceGetWorldMatrices(),f=0;f<m.length;f++){var g=new h.Matrix;m[f].multiplyToRef(p,g),d.push(g)}else d.push(p);for(var v=h.Vector3.Zero(),_=h.Vector3.Zero(),y=0;y<d.length;y++){var S=d[y];for(n=0;n<c.length;n++)s.push(c[n]+a);for(r=0;r<u.length;r+=3)h.Vector3.FromArrayToRef(u,r,_),h.Vector3.TransformCoordinatesToRef(_,S,v),o.push(v.x,v.y,v.z);a+=u.length/3}}return[Float32Array.from(o),Uint32Array.from(s)]}function rt(e){var t,i=e instanceof h.Mesh?e.getIndices(!1,!0):e;if(i)for(var n=0;n<i.length;n+=3)t=[i[n+2],i[n+1]],i[n+1]=t[0],i[n+2]=t[1];return i}function at(e,t,i,n){var r=Ve().getNavMeshPositionsAndIndices(e,n),a=r[0],o=r[1],s=new h.Mesh("NavMeshDebug",t),l=new h.VertexData;return l.indices=rt(o),l.positions=a,l.applyToMesh(s,!1),i&&(s.parent=i),s}function ot(e,t){var i,n,r=Ve();if(0===e.length)throw new Error("At least one mesh is needed to create the nav mesh.");var a=nt(e,{doNotReverseIndices:t.doNotReverseIndices}),o=a[0],s=a[1];if(!o||!s)throw new Error("Unable to get nav mesh. No vertices or indices.");var l=null!==(i=t.tileSize)&&void 0!==i?i:0,c=(null!==(n=t.maxObstacles)&&void 0!==n?n:0)>0,u=l>0;c&&(l<32||l>64)&&h.Logger.Warn("NavigationPlugin: Tile cache is enabled. Recommended tileSize is 32 to 64. Other values may lead to unexpected behavior.");var d=c?We(t):u?He(t):Be(t),p=c?r.generateTileCache(o,s,d,t.keepIntermediates):u?r.generateTiledNavMesh(o,s,d,t.keepIntermediates):r.generateSoloNavMesh(o,s,d,t.keepIntermediates);if(!p.success)throw new Error("Unable to generateSoloNavMesh: ".concat(p.error));return{navMesh:p.navMesh,intermediates:p.intermediates,navMeshQuery:new r.NavMeshQuery(p.navMesh),tileCache:"tileCache"in p?p.tileCache:void 0}}function st(e){var t=this;e.createNavMeshImpl=function(e,t){return ot(e,t)},e.createNavMeshAsyncImpl=function(e,i){return c(t,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){t(ot(e,i))}))];case 1:return[2,t.sent()]}}))}))}}var lt=function(){function e(e){this.name="RecastNavigationJSPlugin",this._maximumSubStepCount=10,this._timeStep=1/60,this._timeFactor=1,e||(e=Ve(),st(this)),this.bjsRECAST=e,this.isSupported()?this.setTimeStep():h.Logger.Error("RecastJS is not available. Please make sure you included the js file.")}return Object.defineProperty(e.prototype,"navMeshQuery",{get:function(){return this._navMeshQuery},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"intermediates",{get:function(){return this._intermediates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileCache",{get:function(){return this._tileCache},enumerable:!1,configurable:!0}),e.prototype.setTimeStep=function(e){void 0===e&&(e=1/60),this._timeStep=e},e.prototype.getTimeStep=function(){return this._timeStep},e.prototype.setMaximumSubStepCount=function(e){void 0===e&&(e=10),this._maximumSubStepCount=e},e.prototype.getMaximumSubStepCount=function(){return this._maximumSubStepCount},Object.defineProperty(e.prototype,"timeFactor",{get:function(){return this._timeFactor},set:function(e){this._timeFactor=Math.max(e,0)},enumerable:!1,configurable:!0}),e.prototype.createNavMesh=function(e,t){if(!this.createNavMeshImpl)throw new Error("Function not injected yet. Use the factory to create the plugin.");this._preprocessParameters(t);var i=this.createNavMeshImpl(e,t);return this._processNavMeshResult(i)},e.prototype.createNavMeshAsync=function(e,t){return c(this,void 0,void 0,(function(){var i;return u(this,(function(n){switch(n.label){case 0:if(!this.createNavMeshAsyncImpl)throw new Error("Function not injected yet. Use the factory to create the plugin.");return this._preprocessParameters(t),[4,this.createNavMeshAsyncImpl(e,t)];case 1:return i=n.sent(),[2,this._processNavMeshResult(i)]}}))}))},e.prototype.createDebugNavMesh=function(e){if(!this.navMesh)throw new Error("There is no navMesh generated.");return this.navMesh&&this._tileCache&&ke(this.navMesh,this._tileCache),at(this.navMesh,e)},e.prototype.getClosestPoint=function(e,t){var i=this._navMeshQuery.findClosestPoint(e,t);return new h.Vector3(i.point.x,i.point.y,i.point.z)},e.prototype.getClosestPointToRef=function(e,t,i){var n=this._navMeshQuery.findClosestPoint(e,i);t.set(n.point.x,n.point.y,n.point.z)},e.prototype.getRandomPointAround=function(e,t,i){var n=this._navMeshQuery.findRandomPointAroundCircle(e,t,i);return new h.Vector3(n.randomPoint.x,n.randomPoint.y,n.randomPoint.z)},e.prototype.getRandomPointAroundToRef=function(e,t,i,n){var r=this._navMeshQuery.findRandomPointAroundCircle(e,t,n);i.set(r.randomPoint.x,r.randomPoint.y,r.randomPoint.z)},e.prototype.moveAlong=function(e,t,i,n){void 0===i&&(i=0);var r=this._navMeshQuery.moveAlongSurface(i,e,t,n);return new h.Vector3(r.resultPosition.x,r.resultPosition.y,r.resultPosition.z)},e.prototype.moveAlongToRef=function(e,t,i,n,r){void 0===n&&(n=0);var a=this._navMeshQuery.moveAlongSurface(n,e,t,r);i.set(a.resultPosition.x,a.resultPosition.y,a.resultPosition.z)},e.prototype.computePath=function(e,t,i){return Ye(this._navMeshQuery.computePath(e,t,i))},e.prototype.computePathSmooth=function(e,t,i){return this.navMesh?Je(this.navMesh,this._navMeshQuery,e,t,i):(h.Logger.Error("No navmesh available. Cannot compute smooth path."),[])},e.prototype.createCrowd=function(e,t,i){var n=new Ze(this,e,t,i);return this._crowd=n,n},e.prototype.setDefaultQueryExtent=function(e){this._navMeshQuery.defaultQueryHalfExtents=e},e.prototype.getDefaultQueryExtent=function(){return new h.Vector3(this._navMeshQuery.defaultQueryHalfExtents.x,this._navMeshQuery.defaultQueryHalfExtents.y,this._navMeshQuery.defaultQueryHalfExtents.z)},e.prototype.getDefaultQueryExtentToRef=function(e){e.set(this._navMeshQuery.defaultQueryHalfExtents.x,this._navMeshQuery.defaultQueryHalfExtents.y,this._navMeshQuery.defaultQueryHalfExtents.z)},e.prototype.buildFromNavmeshData=function(e){var t=this.bjsRECAST.importNavMesh(e);this.navMesh=t.navMesh,this._navMeshQuery=new this.bjsRECAST.NavMeshQuery(this.navMesh)},e.prototype.getNavmeshData=function(){if(!this.navMesh)throw new Error("There is no NavMesh generated.");return this.bjsRECAST.exportNavMesh(this.navMesh)},e.prototype.buildFromTileCacheData=function(e,t){var i=this.bjsRECAST.importTileCache(e,null!=t?t:ze([]));this.navMesh=i.navMesh,this._tileCache=i.tileCache,this._navMeshQuery=new this.bjsRECAST.NavMeshQuery(this.navMesh)},e.prototype.getTileCacheData=function(){if(!this.navMesh||!this._tileCache)throw new Error("There is no TileCache generated.");return this.bjsRECAST.exportTileCache(this.navMesh,this._tileCache)},e.prototype.dispose=function(){var e,t,i,n;null===(e=this._crowd)||void 0===e||e.dispose(),null===(t=this.navMesh)||void 0===t||t.destroy(),null===(i=this._navMeshQuery)||void 0===i||i.destroy(),null===(n=this._tileCache)||void 0===n||n.destroy()},e.prototype.addCylinderObstacle=function(e,t,i,n){var r,a;void 0===n&&(n=!1);var o=null===(r=this._tileCache)||void 0===r?void 0:r.addCylinderObstacle(e,t,i);return(null==o?void 0:o.success)?(!n&&this.navMesh&&this._tileCache&&ke(this.navMesh,this._tileCache),null!==(a=o.obstacle)&&void 0!==a?a:null):null},e.prototype.addBoxObstacle=function(e,t,i,n){var r,a;void 0===n&&(n=!1);var o=null===(r=this._tileCache)||void 0===r?void 0:r.addBoxObstacle(e,t,i);return(null==o?void 0:o.success)?(!n&&this.navMesh&&this._tileCache&&ke(this.navMesh,this._tileCache),null!==(a=o.obstacle)&&void 0!==a?a:null):null},e.prototype.removeObstacle=function(e,t){var i;void 0===t&&(t=!1),null===(i=this._tileCache)||void 0===i||i.removeObstacle(e),!t&&this.navMesh&&this._tileCache&&ke(this.navMesh,this._tileCache)},e.prototype.isSupported=function(){return!!this.bjsRECAST},e.prototype.getRandomSeed=function(){return this.bjsRECAST.getRandomSeed()},e.prototype.setRandomSeed=function(e){this.bjsRECAST.setRandomSeed(e)},e.prototype.raycast=function(e,t){var i,n=this._navMeshQuery.findNearestPoly(e),r=this._navMeshQuery.raycast(n.nearestRef,e,t);if(0<r.t&&r.t<1){h.TmpVectors.Vector3[0].set(e.x,e.y,e.z),h.TmpVectors.Vector3[1].set(t.x,t.y,t.z);var a=h.Vector3.Distance(h.TmpVectors.Vector3[0],h.TmpVectors.Vector3[1])*(null!==(i=null==r?void 0:r.t)&&void 0!==i?i:0),o=h.TmpVectors.Vector3[1].subtract(h.TmpVectors.Vector3[0]).normalize();return{hit:!0,hitPoint:h.TmpVectors.Vector3[0].add(o.multiplyByFloats(a,a,a))}}return{hit:!1}},e.prototype.moveAlongWithVelocity=function(e,t,i){var n=this._navMeshQuery.findClosestPoint({x:e.x,y:e.y,z:e.z},i),r=n.point,a=n.polyRef,o=this._navMeshQuery.moveAlongSurface(a,r,{x:r.x+t.x,y:r.y+t.y,z:r.z+t.z},i).resultPosition,s=this._navMeshQuery.getPolyHeight(a,o);return{position:{x:o.x,y:s.success?s.height:o.y,z:o.z},polyRef:a,height:s.height}},e.prototype._processNavMeshResult=function(e){if(!(null==e?void 0:e.navMesh)||!(null==e?void 0:e.navMeshQuery))throw new Error("Unable to create navmesh. No navMesh or navMeshQuery returned.");return this.navMesh=e.navMesh,this._navMeshQuery=e.navMeshQuery,this._intermediates=e.intermediates,this._tileCache=e.tileCache,{navMesh:e.navMesh,navMeshQuery:e.navMeshQuery,intermediates:e.intermediates,tileCache:e.tileCache}},e.prototype._preprocessParameters=function(e){var t,i;void 0===e.maxObstacles&&(e.tileSize=null!==(t=e.tileSize)&&void 0!==t?t:32,e.maxObstacles=Ge),e.walkableSlopeAngle=Math.max(.1,null!==(i=e.walkableSlopeAngle)&&void 0!==i?i:60)},e}();function ct(e){return c(this,void 0,void 0,(function(){var t;return u(this,(function(i){switch(i.label){case 0:return[4,Fe(e)];case 1:return i.sent(),st(t=new lt(Ve())),[2,t]}}))}))}function ut(e,t){void 0===t&&(t=1);for(var i=0;i<t;i++){for(var n=[],r=0;r<e.length-1;r++){var a=e[r],o=e[r+1];n.push({x:.75*a.x+.25*o.x,y:.75*a.y+.25*o.y,z:.75*a.z+.25*o.z}),n.push({x:.25*a.x+.75*o.x,y:.25*a.y+.75*o.y,z:.25*a.z+.75*o.z})}e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y&&e[0].z===e[e.length-1].z&&n.push(n[0]),e=n}return e}function dt(e){for(var t=[],i=0;i<e.length-1;i++){var n=e[i],r=e[i+1],a=(s=r,l=void 0,c=void 0,u=void 0,d=void 0,l=(o=n).x,c=o.z,u=s.x,d=s.z,Math.abs(u-l)>=Math.abs(d-c)?{x:u,z:c}:{x:l,z:d});t.push(n,new h.Vector3(a.x,r.y,a.z),r)}var o,s,l,c,u,d;return t}function pt(e){var t=Ve(),i=t.importNavMesh(e);if(!i.navMesh)throw new Error("Unable to deserialize NavMesh.");return{navMesh:i.navMesh,navMeshQuery:new t.NavMeshQuery(i.navMesh),tileCache:void 0}}function ht(e,t){var i=Ve(),n=i.importTileCache(e,t);if(!n.tileCache)throw new Error("Unable to deserialize TileCache.");return{navMesh:n.navMesh,navMeshQuery:new i.NavMeshQuery(n.navMesh),tileCache:n.tileCache}}var mt={HEIGHTFIELD_SOLID:"heightfield solid",HEIGHTFIELD_WALKABLE:"heightfield walkable",COMPACT_HEIGHTFIELD_SOLID:"compact heightfield solid",COMPACT_HEIGHTFIELD_REGIONS:"compact heightfield regions",COMPACT_HEIGHTFIELD_DISTANCE:"compact heightfield distance",RAW_CONTOURS:"raw contours",CONTOURS:"contours",POLY_MESH:"poly mesh",POLY_MESH_DETAIL:"poly mesh detail",NAVMESH:"navmesh",NAVMESH_BV_TREE:"navmesh bv tree"},ft=function(){function e(t,i){var n,r,a,o;this._scene=t,this.lineMaterials=[],this.getIntermediates=function(e){var t=[],i=[],n=[],r=[],a=[];if(e)if("solo"===e.type)e.heightfield&&t.push(e.heightfield),e.compactHeightfield&&i.push(e.compactHeightfield),e.contourSet&&n.push(e.contourSet),e.polyMesh&&r.push(e.polyMesh),e.polyMeshDetail&&a.push(e.polyMeshDetail);else if("tiled"===e.type)for(var o=0,s=e.tileIntermediates;o<s.length;o++)(u=s[o]).heightfield&&t.push(u.heightfield),u.compactHeightfield&&i.push(u.compactHeightfield),u.contourSet&&n.push(u.contourSet),u.polyMesh&&r.push(u.polyMesh),u.polyMeshDetail&&a.push(u.polyMeshDetail);else if("tilecache"===e.type)for(var l=0,c=e.tileIntermediates;l<c.length;l++){var u;(u=c[l]).heightfield&&t.push(u.heightfield),u.compactHeightfield&&i.push(u.compactHeightfield)}return{heightfieldList:t,compactHeightfieldList:i,contourSetList:n,polyMeshList:r,polyMeshDetailList:a}},this._debugDrawerUtils=new(Ve().DebugDrawerUtils),this._primitiveTypes=null!==(n=null==i?void 0:i.primitiveTypes)&&void 0!==n?n:["points","lines","tris","quads"],this.debugDrawerParentNode=(null===(r=null==i?void 0:i.parent)||void 0===r?void 0:r.node)instanceof h.TransformNode?i.parent.node:new h.TransformNode(null!==(o=null===(a=null==i?void 0:i.parent)||void 0===a?void 0:a.node)&&void 0!==o?o:"nav-mesh-debug-parent",this._scene);var s=null==i?void 0:i.materials;(null==s?void 0:s.triMaterial)?this.triMaterial=s.triMaterial:(this.triMaterial=new h.StandardMaterial("nav-debug-tris-material"),this.triMaterial.backFaceCulling=!1,this.triMaterial.specularColor=h.Color3.Black(),this.triMaterial.alpha=.5),(null==s?void 0:s.pointMaterial)?this.pointMaterial=s.pointMaterial:(this.pointMaterial=new h.StandardMaterial("nav-debug-points-material"),this.pointMaterial.backFaceCulling=!1,this.pointMaterial.specularColor=h.Color3.Black()),(null==s?void 0:s.lineMaterialOptions)?this._lineMaterialOptions=s.lineMaterialOptions:this._lineMaterialOptions={greasedLineMaterialOptions:{width:2,sizeAttenuation:!0},greasedLineMeshOptions:{}},this._pointMesh=(0,h.CreateBox)(e.NAV_MESH_DEBUG_NAME_POINTS,{size:.02})}return Object.defineProperty(e.prototype,"primitiveTypes",{get:function(){return this._primitiveTypes},set:function(e){this._primitiveTypes=e},enumerable:!1,configurable:!0}),e.prototype.clear=function(){for(var e=0,t=this.debugDrawerParentNode.getChildMeshes();e<t.length;e++)t[e].dispose()},e.prototype.dispose=function(){this.clear(),this._debugDrawerUtils.dispose(),this._pointMesh.dispose(),this.triMaterial.dispose(),this.pointMaterial.dispose()},e.prototype.drawPrimitives=function(e,t){for(var i,n=null,r=0,a=e;r<a.length;r++){var o=a[r];if(this._primitiveTypes.includes(o.type))switch(o.type){case"points":this._drawPoints(o);break;case"lines":var s=this._drawLines(o,n);n||(n=s);break;case"tris":this._drawTris(o);break;case"quads":this._drawQuads(o)}}null==n||n.updateLazy(),(null===(i=null==t?void 0:t.joinMeshes)||void 0===i||i)&&this._joinDebugMeshes()},e.prototype.drawHeightfieldSolid=function(e){var t=this._debugDrawerUtils.drawHeightfieldSolid(e);this.drawPrimitives(t)},e.prototype.drawHeightfieldWalkable=function(e){var t=this._debugDrawerUtils.drawHeightfieldWalkable(e);this.drawPrimitives(t)},e.prototype.drawCompactHeightfieldSolid=function(e){var t=this._debugDrawerUtils.drawCompactHeightfieldSolid(e);this.drawPrimitives(t)},e.prototype.drawCompactHeightfieldRegions=function(e){var t=this._debugDrawerUtils.drawCompactHeightfieldRegions(e);this.drawPrimitives(t)},e.prototype.drawCompactHeightfieldDistance=function(e){var t=this._debugDrawerUtils.drawCompactHeightfieldDistance(e);this.drawPrimitives(t)},e.prototype.drawHeightfieldLayer=function(e,t){var i=this._debugDrawerUtils.drawHeightfieldLayer(e,t);this.drawPrimitives(i)},e.prototype.drawHeightfieldLayers=function(e){var t=this._debugDrawerUtils.drawHeightfieldLayers(e);this.drawPrimitives(t)},e.prototype.drawRegionConnections=function(e,t){void 0===t&&(t=1);var i=this._debugDrawerUtils.drawRegionConnections(e,t);this.drawPrimitives(i)},e.prototype.drawRawContours=function(e,t){void 0===t&&(t=1);var i=this._debugDrawerUtils.drawRawContours(e,t);this.drawPrimitives(i)},e.prototype.drawContours=function(e,t){void 0===t&&(t=1);var i=this._debugDrawerUtils.drawContours(e,t);this.drawPrimitives(i)},e.prototype.drawPolyMesh=function(e){var t=this._debugDrawerUtils.drawPolyMesh(e);this.drawPrimitives(t)},e.prototype.drawPolyMeshDetail=function(e){var t=this._debugDrawerUtils.drawPolyMeshDetail(e);this.drawPrimitives(t)},e.prototype.drawNavMesh=function(e,t){void 0===t&&(t=0);var i=this._debugDrawerUtils.drawNavMesh(e,t);this.drawPrimitives(i)},e.prototype.drawNavMeshWithClosedList=function(e,t,i){void 0===i&&(i=0);var n=this._debugDrawerUtils.drawNavMeshWithClosedList(e,t,i);this.drawPrimitives(n)},e.prototype.drawNavMeshNodes=function(e){var t=this._debugDrawerUtils.drawNavMeshNodes(e);this.drawPrimitives(t)},e.prototype.drawNavMeshBVTree=function(e){var t=this._debugDrawerUtils.drawNavMeshBVTree(e);this.drawPrimitives(t)},e.prototype.drawNavMeshPortals=function(e){var t=this._debugDrawerUtils.drawNavMeshPortals(e);this.drawPrimitives(t)},e.prototype.drawNavMeshPolysWithFlags=function(e,t,i){var n=this._debugDrawerUtils.drawNavMeshPolysWithFlags(e,t,i);this.drawPrimitives(n)},e.prototype.drawNavMeshPoly=function(e,t,i){var n=this._debugDrawerUtils.drawNavMeshPoly(e,t,i);this.drawPrimitives(n)},e.prototype.draw=function(e,t,i,n){this.clear();var r=this.getIntermediates(t),a=r.heightfieldList,o=r.compactHeightfieldList,s=r.contourSetList,l=r.polyMeshList,c=r.polyMeshDetailList;if(n===mt.HEIGHTFIELD_SOLID)for(var u=0,d=a;u<d.length;u++){var p=d[u];this.drawHeightfieldSolid(p)}else if(n===mt.HEIGHTFIELD_WALKABLE)for(var h=0,m=a;h<m.length;h++)p=m[h],this.drawHeightfieldWalkable(p);else if(n===mt.COMPACT_HEIGHTFIELD_SOLID)for(var f=0,g=o;f<g.length;f++){var v=g[f];this.drawCompactHeightfieldSolid(v)}else if(n===mt.COMPACT_HEIGHTFIELD_REGIONS)for(var _=0,y=o;_<y.length;_++)v=y[_],this.drawCompactHeightfieldRegions(v);else if(n===mt.COMPACT_HEIGHTFIELD_DISTANCE)for(var S=0,T=o;S<T.length;S++)v=T[S],this.drawCompactHeightfieldDistance(v);else if(n===mt.RAW_CONTOURS)for(var P=0,A=s;P<A.length;P++){var L=A[P];this.drawRawContours(L)}else if(n===mt.CONTOURS)for(var b=0,R=s;b<R.length;b++)L=R[b],this.drawContours(L);else if(n===mt.POLY_MESH)for(var E=0,C=l;E<C.length;E++){var x=C[E];this.drawPolyMesh(x)}else if(n===mt.POLY_MESH_DETAIL)for(var M=0,w=c;M<w.length;M++){var I=w[M];this.drawPolyMeshDetail(I)}else n===mt.NAVMESH?this.drawNavMesh(e):n===mt.NAVMESH_BV_TREE&&this.drawNavMeshBVTree(e)},e.prototype._drawPoints=function(e){if(0!==e.vertices.length){for(var t=new Float32Array(16*e.vertices.length),i=new Float32Array(4*e.vertices.length),n=0;n<e.vertices.length;n++){var r=e.vertices[n],a=r[0],o=r[1],s=r[2],l=r[3],c=r[4],u=r[5],d=r[6];i[4*n]=l,i[4*n+1]=c,i[4*n+2]=u,i[4*n+3]=d,h.Matrix.Translation(a,o,s).copyToArray(t,16*n)}this._pointMesh.thinInstanceSetBuffer("matrix",t,16),this._pointMesh.thinInstanceSetBuffer("color",i,4),this._pointMesh.parent=this.debugDrawerParentNode}},e.prototype._drawLines=function(t,i){if(0===t.vertices.length)return null;for(var n=[],r=[],a=0;a<t.vertices.length;a+=2){var o=t.vertices[a],s=o[0],c=o[1],u=o[2],d=o[3],p=o[4],m=o[5],f=t.vertices[a+1],g=f[0],v=f[1],_=f[2],y=f[3],S=f[4],T=f[5];n.push([s,c,u,g,v,_]),r.push(new h.Color3(d,p,m)),r.push(new h.Color3(y,S,T))}var P=l(l({},this._lineMaterialOptions.greasedLineMeshOptions),{points:n,instance:null!=i?i:void 0}),A=l(l({},this._lineMaterialOptions.greasedLineMaterialOptions),{colors:r}),L=(0,h.CreateGreasedLine)(e.NAV_MESH_DEBUG_NAME_LINES,P,A);return L.parent=this.debugDrawerParentNode,this.lineMaterials.push(L.material),L},e.prototype._drawTris=function(t){if(0!==t.vertices.length){for(var i=new Float32Array(3*t.vertices.length),n=new Float32Array(4*t.vertices.length),r=0;r<t.vertices.length;r++){var a=t.vertices[r],o=a[0],s=a[1],l=a[2],c=a[3],u=a[4],d=a[5];i[3*r+0]=o,i[3*r+1]=s,i[3*r+2]=l,n[4*r+0]=c,n[4*r+1]=u,n[4*r+2]=d,n[4*r+3]=1}var p=new h.VertexData;p.positions=i,p.colors=n;var m=new h.Mesh(e.NAV_MESH_DEBUG_NAME_TRIS);m.isUnIndexed=!0,p.applyToMesh(m),m.material=this.triMaterial,m.parent=this.debugDrawerParentNode}},e.prototype._drawQuads=function(t){if(0!==t.vertices.length){for(var i=[],n=[],r=0;r<t.vertices.length;r+=4)for(var a=0,o=[t.vertices[r],t.vertices[r+1],t.vertices[r+2],t.vertices[r],t.vertices[r+2],t.vertices[r+3]];a<o.length;a++){var s=o[a],l=s[0],c=s[1],u=s[2],d=s[3],p=s[4],m=s[5];i.push(l,c,u),n.push(d,p,m,1)}var f=new h.VertexData;f.positions=i,f.colors=n;var g=new h.Mesh(e.NAV_MESH_DEBUG_NAME_QUADS);g.isUnIndexed=!0,f.applyToMesh(g),g.material=this.triMaterial,g.parent=this.debugDrawerParentNode}},e.prototype._joinDebugMeshes=function(){var t=this,i=this._scene.meshes.filter((function(t){return t.name===e.NAV_MESH_DEBUG_NAME}));i.forEach((function(e){t._convertUnindexedToIndexed(e)}));var n=h.Mesh.MergeMeshes(i,!0);n&&(n.name=e.NAV_MESH_DEBUG_NAME,n.parent=this.debugDrawerParentNode)},e.prototype._convertUnindexedToIndexed=function(e){var t=h.VertexData.ExtractFromMesh(e).positions;if(t&&t.length%9==0){var i=t.length/3,n=Array.from({length:i},(function(e,t){return t})),r=new h.VertexData;r.positions=t,r.indices=n,r.applyToMesh(e,!0)}else h.Logger.Warn("Mesh must be fully unindexed with triangles.")},e.NAV_MESH_DEBUG_NAME="nav-mesh-debug",e.NAV_MESH_DEBUG_NAME_POINTS="nav-mesh-debug-points",e.NAV_MESH_DEBUG_NAME_TRIS="nav-mesh-debug-tris",e.NAV_MESH_DEBUG_NAME_QUADS="nav-mesh-debug-quads",e.NAV_MESH_DEBUG_NAME_LINES="nav-mesh-debug-lines",e}();const gt=a;return r.default})()));
//# sourceMappingURL=babylonjs.addons.min.js.map